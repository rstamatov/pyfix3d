(self.webpackChunkk3d=self.webpackChunkk3d||[]).push([[321],{7723:(e,t,n)=>{const r=n(4260),o=n(7360),a=n(1724),{viewModes:i}=n(7861),s=n(5843),{cameraModes:l}=n(7996),c=n(4061),d=n(5251),p=n(3949),u=n(52),h=n(7602),m=n(6860),g=n(5399),{viewModeGUI:f}=n(7861),{cameraModeGUI:v}=n(7996),y=n(1847),{getColorLegend:b}=n(4744),x=n(9513),_=n(500),w=n(227),{base64ToArrayBuffer:M}=n(5321),C=o.createCodec({preset:!0});function E(e,t,S){const A=this;let P=null,D=1;const z=t.ownerDocument.defaultView||t.ownerDocument.parentWindow,T={ObjectsListJson:{},ObjectsById:{},chunkList:{},targetDOMNode:t,overlayDOMNode:null};let O={},j=0;const L={controls:null,objects:null};let k;function I(e,t){return!!O[e]&&(Object.keys(O[e]).forEach((n=>{O[e][n](t)})),!0)}function F(e,t){I(A.events.PARAMETERS_CHANGE,{key:e,value:t})}function V(){A.gui=new a.GUI({width:220,autoPlace:!1,scrollable:!0,closeOnTop:!0}),k.appendChild(A.gui.domElement),L.controls=A.gui.addFolder("Controls"),L.objects=A.gui.addFolder("Objects"),L.info=A.gui.addFolder("Info"),p.screenshotGUI(L.controls,A),u.snapshotGUI(L.controls,A),h(L.controls,A),z===window&&(m(L.controls,A),g.isAvailable()&&g.initialize(T.targetDOMNode,L.controls,z)),L.controls.add(A.parameters,"cameraAutoFit").onChange(F.bind(A,"camera_auto_fit")),L.controls.add(A.parameters,"gridAutoFit").onChange((e=>{A.setGridAutoFit(e),F.call(A,"grid_auto_fit",e)})),L.controls.add(A.parameters,"gridVisible").onChange((e=>{A.setGridVisible(e),F.call(A,"grid_visible",e)})),L.controls.add(A.parameters,"fpsMeter").onChange((e=>{A.setFpsMeter(e),F.call(A,"fps_meter",e)})),f(L.controls,A),v(L.controls,A),y.manipulateGUI(L.controls,A,F),L.controls.add(A.parameters,"camera_fov").step(.1).min(1).max(179).name("FOV").onChange((e=>{A.setCameraFOV(e),F.call(A,"camera_fov",e)})),L.controls.add(A.parameters,"voxelPaintColor").step(1).min(0).max(255).name("voxelColor").onChange(F.bind(A,"voxel_paint_color")),L.controls.add(A.parameters,"lighting").step(.01).min(0).max(4).name("lighting").onChange((e=>{A.setDirectionalLightingIntensity(e),F.call(A,"lighting",e)})),w.timeSeriesGUI(L.controls,A,F),L.clippingPlanes=L.controls.addFolder("Clipping planes"),L.info.add(A.parameters,"guiVersion").name("Js version:"),L.info.__controllers[0].__input.readOnly=!0,A.parameters.backendVersion&&(L.info.add({version:A.parameters.backendVersion},"version").name("Python version:"),L.info.__controllers[1].__input.readOnly=!0),Object.keys(T.ObjectsListJson).forEach((e=>{x.update(A,T.ObjectsListJson[e],L.objects,null)}))}function R(e){let t=A.Provider.Helpers.getObjectById(T,e);t&&(T.K3DObjects.remove(t),delete T.ObjectsById[e],t.onRemove&&t.onRemove(),t.geometry&&(t.geometry.dispose(),t.geometry=void 0),t.material&&t.material.map&&(t.material.map.dispose(),t.material.map=void 0),t.material&&(t.material.dispose(),t.material=void 0),t.mesh&&(t.mesh.dispose(),t.mesh=void 0),t=void 0)}if(n(1552),!(this instanceof E))return new E(e,t,S);if("object"!=typeof e)throw new Error("Provider should be an object (a key-value map following convention)");this.refreshAfterObjectsChange=function(e,t){return!(!A.parameters.autoRendering&&!t)&&(e||A.getWorld().setCameraToFitScene(),L.controls&&w.refreshTimeScale(A,L),e?A.render(!0):A.rebuildSceneData(t).then(A.render.bind(null,!0)))},this.render=function(e){T.render(e)},this.resizeHelper=function(){A.disabling||(A.gui&&(A.gui.domElement.parentNode.style["max-height"]=`${T.targetDOMNode.offsetHeight}px`),A.Provider.Helpers.resizeListener(T),I(A.events.RESIZED),A.render())},T.overlayDOMNode=z.document.createElement("div"),T.overlayDOMNode.style.cssText=["position: absolute","width: 100%","height: 100%","top: 0","right: 0","pointer-events: none","overflow: hidden"].join(";"),this.GUI=L,this.parameters=s.assignWith({viewMode:i.view,cameraMode:l.trackball,manipulateMode:y.manipulateModes.translate,voxelPaintColor:0,snapshotIncludeJs:!0,menuVisibility:!0,cameraAutoFit:!0,gridAutoFit:!0,gridVisible:!0,grid:[-1,-1,-1,1,1,1],gridColor:15132390,labelColor:4473924,antialias:1,screenshotScale:5,renderingSteps:1,clearColor:16777215,clippingPlanes:[],fpsMeter:!1,lighting:1.5,time:0,colorbarObjectId:-1,colorbarScientific:!1,fps:25,axes:["x","y","z"],cameraNoRotate:!1,cameraNoZoom:!1,cameraNoPan:!1,cameraRotateSpeed:1,cameraZoomSpeed:1.2,cameraPanSpeed:.3,cameraDampingFactor:0,name:null,camera_fov:60,cameraAnimation:{},autoRendering:!0,axesHelper:1,guiVersion:n(8008).version},S||{},((e,t)=>void 0===t?e:t)),this.autoRendering=!1,this.startAutoPlay=function(){w.startAutoPlay(A,F)},this.stopAutoPlay=function(){w.stopAutoPlay(A)},this.setFps=function(e){A.parameters.fps=e,L.controls&&L.controls.__controllers.forEach((e=>{"fps"===e.property&&e.updateDisplay()}))},this.setFpsMeter=function(e){let t;if(e){if(P)return;t=n(6548),P=new t,P.dom.style.position="absolute",T.targetDOMNode.appendChild(P.dom),requestAnimationFrame((function e(){P&&(P.update(),requestAnimationFrame(e))}))}else P&&(P.domElement.remove(),P=null);A.parameters.fpsMeter=e,L.controls&&L.controls.__controllers.forEach((e=>{"fpsMeter"===e.property&&e.updateDisplay()}))},this.refreshAutoRenderingState=function(){let e=0;Object.keys(A.frameUpdateHandlers).forEach((t=>{e+=A.frameUpdateHandlers[t].length})),A.autoRendering=e>0},this.dispatch=I,this.Provider=e,this.setDirectionalLightingIntensity=function(e){A.parameters.lighting=Math.min(Math.max(e,0),4),A.getWorld().recalculateLights(A.parameters.lighting),A.render(),L.controls&&L.controls.__controllers.forEach((e=>{"lighting"===e.property&&e.updateDisplay()}))},this.setViewMode=function(e){A.parameters.viewMode=e,I(A.events.VIEW_MODE_CHANGE,e)&&A.render(),L.controls&&(L.controls.__controllers.forEach((e=>{"viewMode"===e.property&&e.updateDisplay()})),y.refreshManipulateGUI(A,L)),T.targetDOMNode.style.cursor="auto"},this.setCameraMode=function(e){A.parameters.cameraMode=e,A.getWorld().changeControls(),A.getWorld().setCameraToFitScene(!0),I(A.events.CAMERA_MODE_CHANGE,e),A.render(),L.controls&&L.controls.__controllers.forEach((e=>{"cameraMode"===e.property&&e.updateDisplay()}))},this.setManipulateMode=function(e){A.parameters.manipulateMode=e,I(A.events.MANIPULATE_MODE_CHANGE,e)&&A.render(),L.controls&&L.controls.__controllers.forEach((e=>{"manipulateMode"===e.property&&e.updateDisplay()}))},this.setAutoRendering=function(e){A.parameters.autoRendering=e},this.setMenuVisibility=function(e){A.parameters.menuVisibility=e,e?A.gui||V():A.gui&&(A.gui_map={},A.gui_counts={},A.gui.destroy(),A.gui.domElement.remove(),A.gui=null)},this.setClippingPlanes=function(e){const t=s.cloneDeep(e);A.parameters.clippingPlanes.length=0,t.forEach((e=>{A.parameters.clippingPlanes.push(e)})),L.clippingPlanes&&_(A,L.clippingPlanes),A.render()},this.setColorbarScientific=function(e){A.parameters.colorbarScientific=e,A.render()},this.setColorMapLegend=function(e){const t=e.id||e;A.parameters.colorbarObjectId!==t&&(A.parameters.colorbarObjectId=t,F("colorbar_object_id",A.parameters.colorbarObjectId),Object.keys(T.ObjectsListJson).forEach((e=>{T.ObjectsListJson[e].colorLegend&&(T.ObjectsListJson[e].colorLegend=!1)})),t>0&&void 0!==T.ObjectsListJson[t]&&(T.ObjectsListJson[t].colorLegend=!0),L.objects&&Object.keys(L.objects.__folders).forEach((e=>{L.objects.__folders[e].__controllers.forEach((e=>{"colorLegend"===e.property&&e.updateDisplay()}))}))),b(A,T.ObjectsListJson[A.parameters.colorbarObjectId]||e)},this.setCameraAutoFit=function(e){A.parameters.cameraAutoFit=e,L.controls&&L.controls.__controllers.forEach((e=>{"cameraAutoFit"===e.property&&e.updateDisplay()})),e&&A.getWorld().setCameraToFitScene()},this.setRenderingSteps=function(e){A.parameters.renderingSteps=e},this.setAxes=function(e){A.parameters.axes=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setName=function(e){A.parameters.name=e},this.setAxesHelper=function(e){A.parameters.axesHelper=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setGridAutoFit=function(e){A.parameters.gridAutoFit=e,L.controls&&L.controls.__controllers.forEach((e=>{"gridAutoFit"===e.property&&e.updateDisplay()}))},this.setCameraLock=function(e,t,n){A.parameters.cameraNoRotate=e,A.parameters.cameraNoZoom=t,A.parameters.cameraNoPan=n,T.controls.noRotate=e,T.controls.noZoom=t,T.controls.noPan=n},this.setCameraSpeeds=function(e,t,n){A.parameters.cameraRotateSpeed=e,A.parameters.cameraZoomSpeed=t,A.parameters.cameraPanSpeed=n,T.controls.rotateSpeed=e,T.controls.zoomSpeed=t,T.controls.panSpeed=n},this.setCameraFOV=function(e){A.parameters.camera_fov=e,T.setupCamera(null,e),L.controls&&L.controls.__controllers.forEach((e=>{"camera_fov"===e.property&&e.updateDisplay()})),A.rebuildSceneData(!1).then((()=>{A.render()}))},this.setCameraDampingFactor=function(e){A.parameters.cameraDampingFactor=e,A.getWorld().changeControls(!0),L.controls&&L.controls.__controllers.forEach((e=>{"damping_factor"===e.property&&e.updateDisplay()}))},this.setGridVisible=function(e){A.parameters.gridVisible=e,L.controls&&L.controls.__controllers.forEach((e=>{"gridVisible"===e.property&&e.updateDisplay()})),A.refreshGrid(),A.render()},this.setGridColor=function(e){A.parameters.gridColor=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setLabelColor=function(e){A.parameters.labelColor=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setScreenshotScale=function(e){A.parameters.screenshotScale=e},this.setSnapshotType=function(e){A.parameters.snapshotType=e},this.setGrid=function(e){A.parameters.grid=e,A.rebuildSceneData(!0).then((()=>{A.refreshGrid(),A.render()}))},this.setCamera=function(e){e.length>0&&T.setupCamera(e)},this.setCameraAnimation=function(e){A.parameters.cameraAnimation=e,L.controls&&w.refreshTimeScale(A,L)},this.resetCamera=function(e){T.setCameraToFitScene(!0,e),T.render()},this.setVoxelPaint=function(e){A.parameters.voxelPaintColor=e,L.controls&&L.controls.__controllers.forEach((e=>{"voxelPaintColor"===e.property&&e.updateDisplay()}))},this.setClearColor=function(e){if(A.parameters.clearColor=e,e>=0){const t=parseInt(e,10)+16777216;T.targetDOMNode.style.backgroundColor=`#${t.toString(16).substr(1)}`}else T.targetDOMNode.style.backgroundColor="#fff"},this.on=function(e,t){return O[e]=O[e]||{},O[e][j]=t,j+=1,j-1},this.off=function(e,t){O[e]=O[e]||{},delete O[e][t]},this.getScene=function(){return T.scene},this.addOrUpdateObject=function(e,t){try{R(e.id)}catch(e){}return!1!==e.visible&&T.K3DObjects.add(t),D+=1,D},this.getObjectById=function(e){return A.Provider.Helpers.getObjectById(T,e)},this.setChunkList=function(e){T.chunkList=e},this.removeObject=function(e){return R(e),delete T.ObjectsListJson[e],e===A.parameters.colorbarObjectId&&A.setColorMapLegend(-1),I(A.events.OBJECT_REMOVED,e),A.refreshAfterObjectsChange(!1),Promise.resolve(!0)},this.setTime=function(e){const t=w.getObjectsWithTimeSeriesAndMinMax(A);A.parameters.time=Math.min(Math.max(e,t.min),t.max);const n=t.objects.reduce(((e,t)=>(e.push(A.reload(t,null,!0)),e)),[]);if(Object.keys(A.parameters.cameraAnimation).length>0){const t={camera:A.parameters.cameraAnimation};t.camera.timeSeries=!0;const n=w.interpolateTimeSeries(t,e);T.setupCamera(n.json.camera)}return L.controls&&L.controls.__controllers.forEach((e=>{"time"===e.property&&e.updateDisplay()})),Promise.all(n).then((()=>{A.refreshAfterObjectsChange(!0)}))},this.load=function(e){return c(A,e).then((e=>(e.forEach((e=>{x.update(A,e.json,L.objects,null),T.ObjectsListJson[e.json.id]=e.json,T.ObjectsById[e.json.id]=e.obj,(-1===A.parameters.colorbarObjectId&&e.json.color_range&&2===e.json.color_range.length||A.parameters.colorbarObjectId===e.json.id)&&A.setColorMapLegend(e.json)})),I(A.events.OBJECT_LOADED),A.refreshAfterObjectsChange(!1),e)))},this.reload=function(e,t,n){if(!1===e.visible){!0!==n&&(A.refreshAfterObjectsChange(!0),x.update(A,e,L.objects,t));try{R(e.id)}catch(e){}return Promise.resolve(!0)}const r={objects:[e]};return null!==t&&(r.changes=[t]),c(A,r).then((e=>(e.forEach((e=>{!0!==n&&x.update(A,e.json,L.objects,t),T.ObjectsListJson[e.json.id]=e.json,T.ObjectsById[e.json.id]=e.obj,(-1===A.parameters.colorbarObjectId&&e.json.color_range&&2===e.json.color_range.length||A.parameters.colorbarObjectId===e.json.id)&&A.setColorMapLegend(e.json)})),I(A.events.OBJECT_LOADED),!0!==n&&A.refreshAfterObjectsChange(!0),e)))},this.getWorld=function(){return T},this.getScreenshot=function(e,t){return p.getScreenshot(this,e,t)},this.getHTMLSnapshot=function(e){return u.getHTMLSnapshot(this,e)},this.getSnapshot=function(e){const t=Object.keys(T.chunkList).reduce(((e,t)=>{let n=T.chunkList[t].attributes;return e[t]=Object.keys(n).reduce(((e,t)=>(e[t]=d.serialize(n[t]),e)),{}),e}),{}),n=s.values(T.ObjectsListJson).map((e=>Object.keys(e).reduce(((t,n)=>(t[n]=d.serialize(e[n]),t)),{})));let a=s.cloneDeep(A.parameters);return a.camera=A.getWorld().controls.getCameraArray(),r.deflate(o.encode({objects:n,chunkList:t,plot:a},{codec:C}),{level:e})},this.setSnapshot=function(e){return"string"==typeof e&&(e=r.inflate(new Uint8Array(M(e)))),e instanceof Uint8Array&&(e=o.decode(e,{codec:C})),Object.keys(e.chunkList).forEach((t=>{let n=e.chunkList[t];T.chunkList[n.id]={attributes:Object.keys(n).reduce((function(e,t){return e[t]=d.deserialize(n[t]),e}),{})}})),e.objects.forEach((e=>{Object.keys(e).forEach((t=>{e[t]=d.deserialize(e[t])}))})),A.load({objects:e.objects}).then((()=>A.refreshAfterObjectsChange(!1,!0)))},this.extractSnapshot=function(e){return e.match(/var data = '(.+)';/im)},this.disable=function(){this.disabling=!0,this.frameUpdateHandlers.before=[],this.frameUpdateHandlers.after=[],this.gui&&this.gui.destroy(),this.autoRendering=!1,T.K3DObjects.children.forEach((e=>{R(e.K3DIdentifier),delete T.ObjectsListJson[e.K3DIdentifier]})),T.cleanup(),P&&P.domElement.remove(),O={},z.removeEventListener("resize",this.resizeHelper),T.renderer.removeContextLossListener(),T.renderer.forceContextLoss()},T.targetDOMNode.appendChild(T.overlayDOMNode),this.Provider.Initializers.Renderer.call(T,this),this.Provider.Initializers.Setup.call(T,this),this.Provider.Initializers.Camera.call(T,this),this.Provider.Initializers.Canvas.call(T,this),this.Provider.Initializers.Scene.call(T,this),this.Provider.Initializers.Manipulate.call(T,this),z.addEventListener("resize",this.resizeHelper,!1),k=z.document.createElement("div"),k.className="dg",k.style.cssText=["position: absolute","color: black","top: 0","right: 0","z-index: 16777271",`max-height: ${t.clientHeight}px`].join(";"),T.targetDOMNode.appendChild(k),A.parameters.menuVisibility&&V(),this.resizeHelper(),A.setScreenshotScale(A.parameters.screenshotScale),A.setClearColor(A.parameters.clearColor),A.setMenuVisibility(A.parameters.menuVisibility),A.setTime(A.parameters.time),A.setGridAutoFit(A.parameters.gridAutoFit),A.setGridVisible(A.parameters.gridVisible),A.setCameraAutoFit(A.parameters.cameraAutoFit),A.setCameraDampingFactor(A.parameters.cameraDampingFactor),A.setClippingPlanes(A.parameters.clippingPlanes),A.setDirectionalLightingIntensity(A.parameters.lighting),A.setColorMapLegend(A.parameters.colorbarObjectId),A.setColorbarScientific(A.parameters.colorbarScientific),A.setAutoRendering(A.parameters.autoRendering),A.setCameraLock(A.parameters.cameraNoRotate,A.parameters.cameraNoZoom,A.parameters.cameraNoPan),A.setCameraSpeeds(A.parameters.cameraRotateSpeed,A.parameters.cameraZoomSpeed,A.parameters.cameraPanSpeed),A.setCameraFOV(A.parameters.camera_fov),A.setFps(A.parameters.fps),A.setViewMode(A.parameters.viewMode),A.setFpsMeter(A.parameters.fpsMeter),A.MsgpackCodec=C,A.msgpack=o,A.serialize=d,A.render(),T.targetDOMNode.className+=" k3d-target"}function S(e){return e in{before:!0,after:!0}}window.Float16Array=n(1020),C.addExtPacker(32,Float16Array,(e=>e)),C.addExtUnpacker(32,(e=>Float16Array(e.buffer))),E.prototype.frameUpdateHandlers={before:[],after:[]},E.prototype.events={VIEW_MODE_CHANGE:"viewModeChange",CAMERA_MODE_CHANGE:"cameraModeChange",MANIPULATE_MODE_CHANGE:"manipulateModeChange",RENDERED:"rendered",BEFORE_RENDER:"before_render",RESIZED:"resized",CAMERA_CHANGE:"cameraChange",OBJECT_LOADED:"objectLoaded",OBJECT_REMOVED:"objectRemoved",OBJECT_CHANGE:"objectChange",OBJECT_HOVERED:"objectHovered",OBJECT_CLICKED:"objectClicked",PARAMETERS_CHANGE:"parametersChange",VOXELS_CALLBACK:"voxelsCallback",MOUSE_MOVE:"mouseMove",MOUSE_CLICK:"mouseClick"},E.prototype.addFrameUpdateListener=function(e,t,n){e=S(e)?e:"before",t.callOnce=!!n,this.frameUpdateHandlers[e].push(t),this.refreshAutoRenderingState()},E.prototype.removeFrameUpdateListener=function(e,t){e=S(e)?e:"before",this.frameUpdateHandlers[e]=this.frameUpdateHandlers[e].filter((e=>e!==t&&e)),this.refreshAutoRenderingState()},e.exports=E},6482:e=>{let t;e.exports={error:function(e,n,r){t instanceof Node||(t=document.createElement("ul"),t.id="K3D-error-console",t.style.cssText=["font: 12px sans-serif","color: #FFFFFF","position: absolute","top: 0px","left: 0px","padding: 0px","z-index: 999","margin: 0px","list-style: none outside none"].join(";"),document.body.appendChild(t));const o=function(){const e=document.createElement("li");return e.style.cssText=["background-color: #B50F0F","padding: 5px","margin-bottom: 1px"].join(";"),t.appendChild(e),e}();o.innerHTML=["<b>",e||"Error","</b>: ",n].join(""),r||setTimeout((()=>{t.removeChild(o)}),5e3)},defaultTimeout:5e3}},4061:(e,t,n)=>{const r=n(2809),o=n(5843),a=n(227),{error:i}=n(6482);e.exports=function(e,t){let n,s;const l=[];let c;try{return t.objects.forEach(((d,p)=>{if(c=!1,r(e,d),n=d&&e.Provider.Objects[d.type],void 0===n)return void i("Loader Error",`Unsupported object type ${d.type}`);s=(new Date).getTime();const u=a.interpolateTimeSeries(d,e.parameters.time),h=t.changes&&t.changes[p]||u.changes||{};if(n.update&&!o.isEmpty(h)){const t=e.getObjectById(u.json.id);void 0!==t&&(c=n.update(d,h,t,e))}c||(Object.keys(h).forEach((e=>{u.json[e]=h[e]})),c=n.create(u.json,e).then((t=>{const n=e.addOrUpdateObject(d,t);return t.K3DIdentifier=d.id||`K3DAutoIncrement_${n}`,d.id=t.K3DIdentifier,console.log(`K3D: Object type "${d.type}" loaded in: `,((new Date).getTime()-s)/1e3,"s"),{json:d,obj:t}})).catch((e=>{console.error(e),i("Loader Error",`Object of type "${d.type}" was not loaded.`)}))),l.push(c)})),Promise.all(l)}catch(e){throw i("Loader Error","K3D Loader failed, please consult browser error console!",!1),e}}},7996:e=>{const t={trackball:"trackball",fly:"fly",orbit:"orbit"};e.exports={cameraModeGUI:function(e,n){e.add(n.parameters,"cameraMode",{Trackball:t.trackball,Orbit:t.orbit,Fly:t.fly}).name("Camera").onChange((e=>{n.setCameraMode(e),n.dispatch(n.events.PARAMETERS_CHANGE,{key:"camera_mode",value:e})}))},cameraModes:t}},500:(e,t,n)=>{const r=n(8348);e.exports=function(e,t){r.init(e,t,e.parameters.clippingPlanes,"clippingPlanes",(function(){e.dispatch(e.events.PARAMETERS_CHANGE,{key:"clipping_planes",value:e.parameters.clippingPlanes})}))}},4744:(e,t,n)=>{const r=n(984),o=n(5103);e.exports={getColorLegend:function(e,t){let n,a,i,s,l,c;const d=[],p=[],u=[];let h,m,g=0,f=0,v=null;if(e.colorMapNode&&(e.getWorld().targetDOMNode.removeChild(e.colorMapNode),e.colorMapNode=null),"object"!=typeof t)return;const y=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=y.namespaceURI,x=document.createElementNS(b,"rect");y.setAttribute("viewBox","0 0 100 100"),y.style.cssText=["position: absolute","bottom: 10px","left: 10px","width: 30vh","height: 30vh","max-width: 250px","max-height: 250px","min-width: 150px","min-height: 150px","z-index: 16777271","pointer-events: none","font-family: KaTeX_Main"].join(";"),o.createSVGGradient(y,`colormap${t.id}`,t.color_map.data),x.setAttribute("stroke-width",.5.toString(10)),x.setAttribute("stroke-linecap","square"),x.setAttribute("stroke","black"),x.setAttribute("fill",`url(#colormap${t.id})`),x.setAttribute("width",10..toString(10)),x.setAttribute("height",90..toString(10)),x.setAttribute("x",5..toString(10)),x.setAttribute("y",5..toString(10)),y.appendChild(x),d[0]=Math.min(t.color_range[0],t.color_range[1]),d[1]=Math.max(t.color_range[0],t.color_range[1]);const _=d[1]-d[0];for(c=r.pow10ceil(Math.abs(_))/10;f<4;)h=r.fmod(d[0],c),h=h>0?c-h:0,f=Math.floor((Math.abs(_)-h+.001*c)/c),f<4&&(c/=2);for(m=0;m<=f;m++)p.push(d[0]+h+m*c);p.forEach((t=>{s=document.createElementNS(b,"g"),n=document.createElementNS(b,"line"),a=document.createElementNS(b,"text"),i=document.createElementNS(b,"text");const r=5+90*(1-(t-d[0])/_);l=e.parameters.colorbarScientific?t.toPrecision(4):t.toFixed((c.toString(10).split(".")[1]||"").length),n.setAttribute("x1","13"),n.setAttribute("y1",r.toString(10)),n.setAttribute("x2","17"),n.setAttribute("y2",r.toString(10)),n.setAttribute("stroke-width",.5.toString(10)),n.setAttribute("stroke","black"),y.appendChild(n),a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("alignment-baseline","middle"),a.setAttribute("text-anchor","end"),a.setAttribute("font-size","0.5em"),a.setAttribute("fill","rgb(68, 68, 68)"),a.innerHTML=l,i.setAttribute("x","0.5"),i.setAttribute("y","0.5"),i.setAttribute("alignment-baseline","middle"),i.setAttribute("text-anchor","end"),i.setAttribute("font-size","0.5em"),i.setAttribute("fill","rgb(255, 255, 255)"),i.innerHTML=l,s.setAttribute("pos_y",r.toString(10)),s.appendChild(i),s.appendChild(a),u.push(s),y.appendChild(s)})),e.getWorld().targetDOMNode.appendChild(y),function t(){e.getWorld().width<10||e.getWorld().height<10?null===v&&(v=e.on(e.events.RESIZED,(()=>{t()}))):(null!==v&&(e.off(e.events.RESIZED,v),v=null),g=u.reduce(((e,t)=>Math.max(e,t.getBBox().width)),0),u.forEach((e=>{const t=(g+20).toString(10),n=e.getAttribute("pos_y");e.setAttribute("transform",`translate(${t}, ${n})`)})))}(),e.colorMapNode=y}}},6860:(e,t,n)=>{const r=n(5843);e.exports=function(e,t){let o,a;const i=t.getWorld().targetDOMNode,s=document.createElement("div");function l(e,t){const n=e.getElementsByTagName(t);for(;n[0];)n[0].parentNode.removeChild(n[0])}function c(e){const n=t.getWorld(),o=new t.constructor(t.Provider,e,t.parameters),a=n.K3DObjects.children.reduce(((e,t)=>(e.push(n.ObjectsListJson[t.K3DIdentifier]),e)),[]);t.disable(),o.load({objects:a}),o.setCamera(t.getWorld().controls.getCameraArray()),r.assign(t,o)}function d(){o&&(o.close(),o=null,i.removeChild(s),c(i))}function p(){o&&o.closed&&(clearInterval(a),d())}s.className="detachedInfo",s.innerHTML="K3D works in detached mode. Please close window or click on this text to attach it here.",s.style.cssText=["cursor: pointer","padding: 2em"].join(";");const u={detachWidget(){o=window.open("","_blank","width=800,height=600,resizable=1"),o.document.body.innerHTML=n(7529);let e=document.getElementsByTagName("style");for(let t=0;t<e.length;t++)o.document.body.appendChild(e[t].cloneNode(!0));setTimeout((()=>{c(o.document.getElementById("canvasTarget")),l(i,"canvas"),l(i,"div"),l(i,"svg"),i.appendChild(s)}),100),o.opener.addEventListener("unload",(()=>{o&&o.close()}),!1),a=setInterval(p,500)}};e.add(u,"detachWidget").name("Detach widget"),s.addEventListener("click",(()=>{d()}),!1)}},5399:(e,t,n)=>{const r=n(9486);e.exports={isAvailable:()=>r.isEnabled,initialize:function(e,t,n){const o={fullscreen:!1},a=t.add(o,"fullscreen").name("Full screen").onChange((t=>{t?r.request(e):r.exit()}));n.addEventListener(r.raw.fullscreenchange,(()=>{o.fullscreen=r.isFullscreen,a.updateDisplay(),n.dispatchEvent(new Event("resize"))}))}}},5321:e=>{function t(e){const t=e.length,n=new Uint8Array(t);let r;for(r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}e.exports={colorsToFloat32Array:function(e){const t=new Float32Array(3*e.length);return e.forEach(((e,n)=>{t[3*n]=(e>>16&255)/255,t[3*n+1]=(e>>8&255)/255,t[3*n+2]=(255&e)/255})),t},bufferToBase64:function(e){const t=new Uint8Array(e);let n,r="";for(n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return window.btoa(r)},base64ToArrayBuffer:function(e){return t(window.atob(e))},arrayBufferToBase64:function(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)},stringToArrayBuffer:t}},5103:e=>{function t(e){return e>1&&(e=1),e<0&&(e=0),Math.round(255*e)}function n(e,t){const n={};let r,o;function a(e,t){const o=function(e,t){const o=r.indexOf(e);let a=o,i=o;for(;void 0===n[r[a]][t]&&a>0;)a-=1;for(;void 0===n[r[i]][t]&&i<r.length-1;)i+=1;return[r[a],r[i]]}(e,t),a=(e-o[0])/(o[1]-o[0]);let i,s;return i=void 0!==n[o[0]][t]?n[o[0]][t]:0,s=void 0!==n[o[1]][t]?n[o[1]][t]:1,i*(1-a)+s*a}for(o=0;o<e.length;o+=4)n[e[o]]={r:e[o+1],g:e[o+2],b:e[o+3]};for(t||(r=Object.keys(n).map(parseFloat).sort(((e,t)=>e-t)),t=[r[0],1,r[r.length-1],1]),o=0;o<t.length;o+=2)n[t[o]]||(n[t[o]]={}),n[t[o]].a=t[o+1];return r=Object.keys(n).map(parseFloat).sort(((e,t)=>e-t)),r.forEach((e=>{void 0===n[e].a&&(n[e].a=a(e,"a")),void 0===n[e].r&&(n[e].r=a(e,"r"),n[e].g=a(e,"g"),n[e].b=a(e,"b"))})),r.reduce(((e,t)=>e.concat([parseFloat(t),n[t].r,n[t].g,n[t].b,n[t].a])),[])}e.exports={createCanvasGradient:function(e,r,o){const a=document.createElement("canvas"),i=a.getContext("2d");let s,l;const c=n(e,o);a.height=1,a.width=r;const d=i.createLinearGradient(0,0,a.width,a.height),p=c[0],u=c[c.length-5];for(l=0;l<c.length/5;l++)s=c.slice(5*l,5*l+5),d.addColorStop((s[0]-p)/(u-p),`rgba(${t(s[1])}, ${t(s[2])}, ${t(s[3])}, ${s[4]})`);return i.fillStyle=d,i.fillRect(0,0,a.width,a.height),a},createCanvasColorList:function(e){const t=document.createElement("canvas"),n=t.getContext("2d");let r;t.height=1,t.width=256;const o=n.getImageData(0,0,t.width,t.height);for(r=0;r<e.length;r++)o.data[4*r+3]=255,o.data[4*r]=e[r]>>16&255,o.data[4*r+1]=e[r]>>8&255,o.data[4*r+2]=255&e[r];return n.putImageData(o,0,0),t},createSVGGradient:function(e,r,o,a,i){const s=e.namespaceURI,l=document.createElementNS(s,"linearGradient");e.getElementById(r)&&e.getElementById(r).remove(),l.setAttribute("id",r),i?(l.setAttribute("x1","0"),l.setAttribute("x2","1"),l.setAttribute("y1","0"),l.setAttribute("y2","0")):(l.setAttribute("x1","0"),l.setAttribute("x2","0"),l.setAttribute("y1","1"),l.setAttribute("y2","0"));const c=n(o,a),d=c[0],p=c[c.length-5];for(let e=0;e<c.length;e+=5){const n=document.createElementNS(s,"stop"),r=c.slice(e,e+5);n.setAttribute("offset",((r[0]-d)/(p-d)).toString(10)),n.setAttribute("stop-color",`rgb(${t(r[1])},${t(r[2])},${t(r[3])})`),n.setAttribute("stop-opacity",r[4]),l.appendChild(n)}return(e.querySelector("defs")||e.insertBefore(document.createElementNS(s,"defs"),e.firstChild)).appendChild(l)},mergeColorMapWithOpacity:n}},7529:e=>{e.exports='<style>body { margin: 0;}</style><div id="canvasTarget" style="width: 100%; height: 100%;"></div>'},6150:e=>{e.exports=function(e,t){const n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&t(n.response)},n.send(null)}},1020:e=>{e.exports=function e(t){const n=new Uint16Array(t);return n.constructor=e,n}},2518:e=>{e.exports={edgeTable:new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triangleTable:new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}},2314:(e,t,n)=>{const r=new Float32Array(36),o=new Float32Array(8),{edgeTable:a}=n(2518),{triangleTable:i}=n(2518);e.exports=function(e,t,n,s,l,c,d,p,u,h,m,g,f,v,y){let b=0;const x=u*s*l+p*s+d;let _=0;for(o[0]=t[x],o[1]=t[x+1],o[2]=t[x+s*l+1],o[3]=t[x+s*l],o[4]=t[x+s],o[5]=t[x+s+1],o[6]=t[x+s+s*l+1],o[7]=t[x+s+s*l],d=0;d<8;d++)o[d]<n&&(b|=1<<d);const w=a[b];if(0!==w)for(1&w&&(r[0]=h+f*(n-o[0])/(o[1]-o[0]),r[1]=m,r[2]=g),2&w&&(r[3]=h+f,r[4]=m,r[5]=g+y*(n-o[1])/(o[2]-o[1])),4&w&&(r[6]=h+f*(n-o[3])/(o[2]-o[3]),r[7]=m,r[8]=g+y),8&w&&(r[9]=h,r[10]=m,r[11]=g+y*(n-o[0])/(o[3]-o[0])),16&w&&(r[12]=h+f*(n-o[4])/(o[5]-o[4]),r[13]=m+v,r[14]=g),32&w&&(r[15]=h+f,r[16]=m+v,r[17]=g+y*(n-o[5])/(o[6]-o[5])),64&w&&(r[18]=h+f*(n-o[7])/(o[6]-o[7]),r[19]=m+v,r[20]=g+y),128&w&&(r[21]=h,r[22]=m+v,r[23]=g+y*(n-o[4])/(o[7]-o[4])),256&w&&(r[24]=h,r[25]=m+v*(n-o[0])/(o[4]-o[0]),r[26]=g),512&w&&(r[27]=h+f,r[28]=m+v*(n-o[1])/(o[5]-o[1]),r[29]=g),1024&w&&(r[30]=h+f,r[31]=m+v*(n-o[2])/(o[6]-o[2]),r[32]=g+y),2048&w&&(r[33]=h,r[34]=m+v*(n-o[3])/(o[7]-o[3]),r[35]=g+y),b<<=4,d=0;-1!==i[b+d];d++)_=3*i[b+d],e.push(r[_]),e.push(r[_+1]),e.push(r[_+2])}},984:e=>{e.exports={pow10ceil:e=>Math.pow(10,Math.ceil(Math.log10(e))),fmod:(e,t)=>Number((e-Math.floor(e/t)*t).toPrecision(8))}},2809:e=>{e.exports=function(e,t){const n="object"==typeof t,r=n&&t.hasOwnProperty("type"),o=r&&e.Provider.hasOwnProperty("Objects")&&e.Provider.Objects.hasOwnProperty(t.type);if(!n)throw new Error("Object definition should be a valid javascript object!");if(!r)throw new Error("Object definition should have a `type` attribute set!");if(!o)throw new Error(`Unknown object type (${t.type}) passed, no loader supporting it found!`);return t}},8348:(e,t,n)=>{const r=n(6788);e.exports={init:function e(t,n,o,a,i){function s(e){o.length=0,Object.keys(n[a].map).forEach((e=>{if("addNew"!==e){const t=n[a].map[e].obj;o.push([t.x,t.y,t.z,t.constant])}})),e&&t.render(),i(o)}function l(e,n){const{camera:o}=t.getWorld();o.updateMatrixWorld();const a=(new r.Plane).setFromCoplanarPoints(new r.Vector3(-1,-1,-1).unproject(o),new r.Vector3(1,1,-1).unproject(o),new r.Vector3(1,-1,-1).unproject(o));a.constant-=e.obj.camDist,e.obj.x=a.normal.x,e.obj.y=a.normal.y,e.obj.z=a.normal.z,e.obj.constant=a.constant,e.folder.__controllers.forEach((e=>{e.updateDisplay()})),s(n)}for(void 0===n[a]&&(n[a]={}),void 0===n[a].count&&(n[a].count=1),void 0===n[a].map&&(n[a].map={},n[a].map.addNew=n.add({addPlane(){o.push([1,0,0,0]),e(t,n,o,a,i),t.render(),i(o)}},"addPlane").name("Add new"));o.length<Object.keys(n[a].map).length-1;){const e=Object.keys(n[a].map).length-1,t=n[a].map[e-1].folder.__controllers;t[t.length-1].object.delete(!0)}let c=0;Object.keys(n[a].map).sort().forEach((e=>{"addNew"!==e&&(parseInt(e,10)!==c&&(n[a].map[c]=n[a].map[e],delete n[a].map[e]),c+=1)})),o.forEach((function(e,r){if(void 0===n[a].map[r]){const o={folder:n.addFolder("Plane #"+n[a].count++),obj:{x:e[0],y:e[1],z:e[2],camDist:5e3*t.getWorld().camera.near,constant:e[3]}};n[a].map[r]=o,o.folder.add(o.obj,"x").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"y").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"z").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"constant").step(.001).onChange(s.bind(this,!0)),o.folder.add({fromCamera(){o.eventId?(o.folder.__controllers[4].name("From camera [start]"),t.off(t.events.CAMERA_CHANGE,o.eventId),o.eventId=null):(o.folder.__controllers[4].name("From camera [stop]"),o.eventId=t.on(t.events.CAMERA_CHANGE,l.bind(this,o)),l(o,!0))}},"fromCamera").name("From camera [start]"),o.folder.add(o.obj,"camDist").name("Distance").onChange((()=>{o.eventId&&l(o,!0)})),o.folder.__controllers[4].domElement.previousSibling.style.width="100%",o.folder.add({delete(e){Object.keys(n[a].map).forEach((e=>{if(o.obj===n[a].map[e].obj){const{folder:r}=n[a].map[e];r.close(),n.__ul.removeChild(r.domElement.parentNode),delete n.__folders[r.name],n.onResize(),o.eventId&&(t.off(t.events.CAMERA_CHANGE,o.eventId),o.eventId=null),delete n[a].map[e]}})),e||s(!0)}},"delete").name("Delete")}else n[a].map[r].obj.x=e[0],n[a].map[r].obj.y=e[1],n[a].map[r].obj.z=e[2],n[a].map[r].obj.constant=e[3],n[a].map[r].folder.__controllers.forEach((e=>{e.updateDisplay()}))}))}}},5251:(e,t,n)=>{const r=n(4260),o=n(5843),a=n(1020),i={int8:Int8Array,int16:Int16Array,int32:Int32Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,float16:a,float32:Float32Array,float64:Float64Array};e.exports={deserialize:function e(t,n){if(null==t)return null;if("string"==typeof t||"boolean"==typeof t)return t;if(o.isNumber(t))return t;if(void 0!==t.shape)return function(e){let t;return void 0!==e.data?{data:new i[e.dtype](e.data.buffer),shape:e.shape}:void 0!==e.compressed_data?(t=new i[e.dtype](r.inflate(new Uint8Array(e.compressed_data.buffer)).buffer),console.log(`K3D: Receive: ${t.byteLength} bytes compressed to ${e.compressed_data.byteLength} bytes`),{data:t,shape:e.shape}):e}(t);if(Array.isArray(t))return t.reduce(((t,r)=>(t.push(e(r,n)),t)),[]);let a=!0;const s=Object.keys(t).reduce(((r,o)=>{var i;return i=o,(Number.isNaN(parseFloat(i))||!Number.isFinite(parseFloat(i)))&&(a=!1),r[o]=e(t[o],n),r}),{});return a&&(s.timeSeries=!0),s},serialize:function e(t){return o.isNumber(t)||"string"==typeof t||"boolean"==typeof t?t:null!==t?void 0!==t.data&&void 0!==t.shape&&void 0!==t.data?function(e){return e.compression_level&&e.compression_level>0?{dtype:o.invert(i)[e.data.constructor],compressed_data:r.deflate(e.data.buffer,{level:e.compression_level}),shape:e.shape}:{dtype:o.invert(i)[e.data.constructor],data:e.data,shape:e.shape}}(t):Array.isArray(t)?t.reduce(((t,n)=>(t.push(e(n)),t)),[]):Object.keys(t).reduce(((n,r)=>(n[r]=e(t[r]),n)),{}):null}}},2960:e=>{function t(e,t){if(Array.isArray(t)){const n=3*(Math.abs(t[0])-1),r=3*(Math.abs(t[1])-1);return[(e[n]+e[r])/2,(e[n+1]+e[r+1])/2,(e[n+2]+e[r+2])/2]}const n=3*(Math.abs(t)-1);return[e[n],e[n+1],e[n+2]]}function n(e,t,n,r,o){const a=18*o;t[a]=e[0][0],t[a+1]=e[0][1],t[a+2]=e[0][2],t[a+3]=e[3][0],t[a+4]=e[3][1],t[a+5]=e[3][2],t[a+6]=e[1][0],t[a+7]=e[1][1],t[a+8]=e[1][2],t[a+9]=e[1][0],t[a+10]=e[1][1],t[a+11]=e[1][2],t[a+12]=e[3][0],t[a+13]=e[3][1],t[a+14]=e[3][2],t[a+15]=e[2][0],t[a+16]=e[2][1],t[a+17]=e[2][2];for(let e=0;e<18;e+=3)n[a+e]=r[0],n[a+e+1]=r[1],n[a+e+2]=r[2]}function r(e,r,o,a,i){const s=[],l=[],c=[];let d=0,p=0;const{width:u}=o,{height:h}=o,{length:m}=o,g=[u,h,m],f=e.voxels instanceof Uint8Array,v=Math.max.apply(null,e.size),y=new Array((v+1)*(v+1)).fill(0);let b,x,_,w,M,C,E,S,A,P,D,z,T,O,j,L,k;const I=[e.offset[0]+e.size[0],e.offset[1]+e.size[1],e.offset[2]+e.size[2]],F=[Math.min(I[0]+1,u),Math.min(I[1]+1,h),Math.min(I[2]+1,m)];function V(t,n,r){return[[(t[0]-e.offset[0])/u,(t[1]-e.offset[1])/h,(t[2]-e.offset[2])/m],[(t[0]-e.offset[0]+r[0])/u,(t[1]-e.offset[1]+r[1])/h,(t[2]-e.offset[2]+r[2])/m],[(t[0]-e.offset[0]+n[0]+r[0])/u,(t[1]-e.offset[1]+n[1]+r[1])/h,(t[2]-e.offset[2]+n[2]+r[2])/m],[(t[0]-e.offset[0]+n[0])/u,(t[1]-e.offset[1]+n[1])/h,(t[2]-e.offset[2]+n[2])/m]]}function R(t,n,r,o,a,i,s,l,c){let d,p,u=o;for(d=1;r+d<s[i];d++)for(u+=l[a]-e.offset[a],p=0;p<t;p++)if(n!==c[p+u])return d;return d}function B(t,n,r,o){const a=6*o,i=[0,0,0];i[r]=1,t[a]=(n[0]-e.offset[0])/u,t[a+1]=(n[1]-e.offset[1])/h,t[a+2]=(n[2]-e.offset[2])/m,t[a+3]=(n[0]-e.offset[0]+i[0])/u,t[a+4]=(n[1]-e.offset[1]+i[1])/h,t[a+5]=(n[2]-e.offset[2]+i[2])/m}const N=[1,u,u*h],U=[[1,0,0],[0,1,0],[0,0,1]];for(b=0;b<3;b++)for(x=[0,0,0],_=(b+1)%3,w=(b+2)%3,x[b]=-1+e.offset[b];x[b]<I[b];){let o=!1;for(x[w]=e.offset[w],O=0;x[w]<F[w];x[w]++)for(x[_]=e.offset[_],L=x[0]+u*(x[1]+h*x[2]);x[_]<F[_];x[_]++,O++,L+=N[_])f?(M=x[b]>=0?e.voxels[L]:-1,C=x[b]<g[b]-1?e.voxels[L+N[b]]:-1):(M=x[b]>=0?e.voxels.get(x[0],x[1],x[2]):-1,C=x[b]<g[b]-1?e.voxels.get(x[0]+U[b][0],x[1]+U[b][1],x[2]+U[b][2]):-1),M===C||M>0&&C>0&&!i?y[O]=0:M>0?(y[O]=i&&C>0?[M,C]:M,o=!0):(y[O]=C>0?-C:0,o|=C>0);if(x[b]+=1,o){if(a)for(S=e.offset[w],O=0;S<I[w];S++){for(x[_]=e.offset[_],x[w]=S,0===e.offset[_]&&0!==y[O]&&B(c,x,w,p++),E=e.offset[_];E<F[_]-1;E++,O++)x[_]=E+1,y[O]!==y[O+1]&&B(c,x,w,p++);x[_]=I[_],E===g[_]-1&&0!==y[O]&&B(c,x,w,p++),O+=1}for(S=e.offset[w],O=0;S<I[w];S++){for(E=e.offset[_];E<I[_];)if(j=y[O],j){for(P=1;j===y[O+P]&&E+P<I[_];)P+=1;D=R(P,j,S,O,_,w,I,F,y),x[_]=E,x[w]=S,z=[0,0,0],T=[0,0,0],j>0?(T[w]=D,z[_]=P):(z[w]=D,T[_]=P),n(V(x,z,T),s,l,t(r,y[O]),d++),k=O;for(let t=0;t<D;t++){for(A=0;A<P;A++)y[k+A]=0;k+=F[_]-e.offset[_]}E+=P,O+=P}else E+=1,O+=1;I[_]!==F[_]&&(O+=1)}}}return{offset:e.offset,vertices:s,colors:l,outlines:c}}e.exports={initializeGreedyVoxelMesh:function(e,t,n,o,a){return r.bind(null,e,t,n,o,a)},generateGreedyVoxelMesh:r}},7290:e=>{e.exports=function(e,t,n,r){let o=0;!function a(){const i=Math.min(o+t,e);for(;o<i;++o)n.call(null,o);o<e?setTimeout(a,0):void 0!==r&&r.call(null)}()}},1847:(e,t,n)=>{const{viewModes:r}=n(7861),o={translate:"translate",scale:"scale",rotate:"rotate"};e.exports={refreshManipulateGUI(e,t){t.controls.__controllers.forEach((t=>{"manipulateMode"===t.property&&(t.__li.hidden=e.parameters.viewMode!==r.manipulate,t.updateDisplay())}))},manipulateGUI(e,t,n){e.add(t.parameters,"manipulateMode",{Translate:o.translate,Rotate:o.rotate,Scale:o.scale}).name("Manipulate mode").onChange((e=>{t.setManipulateMode(e),n("manipulate_mode",e)}))},manipulateModes:o}},9513:e=>{function t(e,t,n,r,o){const a={};a[n]=r,"name"!==n&&e.reload(t,a,o),e.dispatch(e.events.OBJECT_CHANGE,{id:t.id,key:n,value:r})}e.exports={update:function(e,n,r,o){function a(e,t,n,r,o,a){const i=e.add(t,n,r,o,a);return e.controllersMap[n]=i,i}function i(e,t,n){const r=e.addColor(t,n);return e.controllersMap[n]=r,r}function s(t){const r=e.gui_map[n.id];let o,a,i;if("color_range"===t){if(a=r.controllersMap[`_${t}_low`],i=r.controllersMap[`_${t}_high`],void 0!==a)return[a,i]}else if(o=r.controllersMap[t],void 0!==o)return[o];return[]}if(!r)return;void 0===e.gui_map&&(e.gui_map={}),void 0===e.gui_counts&&(e.gui_counts={}),void 0===e.gui_map[n.id]&&(e.gui_counts[n.type]=e.gui_counts[n.type]+1||1,e.gui_map[n.id]=r.addFolder(`${n.type} #${e.gui_counts[n.type]}`),e.gui_map[n.id].controllersMap={},e.gui_map[n.id].listenersId=e.on(e.events.OBJECT_REMOVED,(t=>{if(t===n.id){const{listenersId:t}=e.gui_map[n.id],o=e.gui_map[n.id];o.close(),r.__ul.removeChild(o.domElement.parentNode),delete r.__folders[o.name],r.onResize(),delete e.gui_map[n.id],e.off(e.events.OBJECT_REMOVED,t)}})));const l=["visible","outlines","wireframe","flat_shading","use_head","head_size","line_width","scale","font_size","font_weight","size","point_size","level","samples","alpha_coef","gradient_step","shadow_delay","focal_length","focal_plane","on_top","max_length","label_box","is_html"],c=l.concat(["color","origin_color","origin_color","head_color","outlines_color","text","shader","shadow_res","shadow","ray_samples_count","width","radial_segments","mesh_detail","opacity","color_range","name","color_map","mode"]);if((o&&Object.keys(o)||Object.keys(n)).forEach((function(r){let o,d;if(-1!==c.indexOf(r)&&("name"===r&&(null===n.name?(n.name=`${n.type} #${e.gui_counts[n.type]}`,e.gui_map[n.id].name=n.name,t(e,n,"name",n.name)):e.gui_map[n.id].name=n.name),"color_range"===r&&2===n[r].length&&(n[`_${r}_low`]=n[r][0],n[`_${r}_high`]=n[r][1],o=s("colorLegend"),0===o.length&&(n.colorLegend=e.parameters.colorbarObjectId===n.id,a(e.gui_map[n.id],n,"colorLegend").onChange((t=>{n.colorLegend=t,t?e.setColorMapLegend(n):e.setColorMapLegend(0)})))),n.colorLegend=e.parameters.colorbarObjectId===n.id,"color_map"!==r&&"color_range"!==r||n.colorLegend&&e.setColorMapLegend(n),!function(e){const t=s(e);return t.forEach((e=>{e.object=n,e.updateDisplay()})),t.length>0}(r)&&(-1===l.indexOf(r)||n[r].timeSeries||a(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r)),"color"===r&&(-1===["Line","Points","VectorField","Vectors"].indexOf(n.type)?i(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r)):-1!==["Points","VectorField","Vectors"].indexOf(n.type)?void 0!==n.colors&&0!==n.colors.length||i(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r)):"Line"===n.type&&(void 0!==n.colors&&0!==n.colors.length||void 0!==n.attribute&&0!==n.attribute.length||void 0!==n.color_range&&0!==n.colors.color_range||void 0!==n.color_map&&0!==n.colors.color_map||i(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r)))),null===n[r]||!n[r].timeSeries)))switch(r){case"origin_color":case"head_color":void 0===n.colors&&i(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r));break;case"outlines_color":i(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r));break;case"text":"STL"!==n.type&&a(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r));break;case"shader":"Points"===n.type&&a(e.gui_map[n.id],n,r,["3dSpecular","3d","flat","mesh","dot"]).onChange(t.bind(this,e,n,r));break;case"mode":"Label"===n.type&&a(e.gui_map[n.id],n,r,["dynamic","local","side"]).onChange(t.bind(this,e,n,r));break;case"shadow_res":"Volume"===n.type&&a(e.gui_map[n.id],n,r,[32,64,128,256,512]).onChange(t.bind(this,e,n,r));break;case"shadow":"Volume"===n.type&&a(e.gui_map[n.id],n,r,["off","on_demand","dynamic"]).onChange(t.bind(this,e,n,r));break;case"ray_samples_count":"Volume"===n.type&&a(e.gui_map[n.id],n,r,[8,16,32,64]).onChange(t.bind(this,e,n,r));break;case"width":"Line"===n.type&&"mesh"===n.shader&&a(e.gui_map[n.id],n,r).onChange(t.bind(this,e,n,r));break;case"radial_segments":"mesh"===n.shader&&a(e.gui_map[n.id],n,r,0,64,1).name("radialSeg").onChange(t.bind(this,e,n,r));break;case"mesh_detail":"mesh"===n.shader&&a(e.gui_map[n.id],n,r,0,8,1).name("meshDetail").onChange(t.bind(this,e,n,r));break;case"opacity":n[r].timeSeries||a(e.gui_map[n.id],n,r,0,1).name("opacity").onChange(t.bind(this,e,n,r));break;case"color_range":2===n[r].length&&(d=a(e.gui_map[n.id],n,`_${r}_low`).name("vmin").onChange((r=>{n.color_range[0]=r,t(e,n,"color_range",n.color_range)})),0===d.__precision&&d.initialValue<20&&(d.__precision=2,d.__impliedStep=.1),d=a(e.gui_map[n.id],n,`_${r}_high`).name("vmax").onChange((r=>{n.color_range[1]=r,t(e,n,"color_range",n.color_range)})),0===d.__precision&&d.initialValue<20&&(d.__precision=2,d.__impliedStep=.1))}})),"Volume"===n.type&&0===s("refreshLightMap").length){const t={refreshLightMap(){e.getObjectById(n.id).refreshLightMap(),e.render()}};a(e.gui_map[n.id],t,"refreshLightMap").name("Refresh light map")}},changeParameter:t}},7602:e=>{e.exports=function(e,t){const n={resetCamera(){t.getWorld().setCameraToFitScene(!0),t.getWorld().render()}};e.add(n,"resetCamera").name("Reset camera")}},3949:(e,t,n)=>{const r=n(4126),o=n(5398);function a(e,t,n){return new Promise(((r,a)=>{const i=document.createElement("canvas"),s=i.getContext("2d"),l=document.createElement("canvas"),{clearColor:c}=e.parameters,d=e.getWorld(),p=d.renderer.domElement;let u,h;if(h=(new Date).getTime(),i.width=Math.floor(p.width*t),l.width=Math.floor(p.width*t),i.height=Math.floor(p.height*t),l.height=Math.floor(p.height*t),e.labels=[],e.dispatch(e.events.BEFORE_RENDER),c>=0&&(s.fillStyle=`rgb(${(16711680&c)>>16},${(65280&c)>>8},${255&c})`,s.fillRect(0,0,i.width,i.height)),n)u=Promise.resolve();else{let n=document.getElementsByTagName("style"),r="";for(let e=0;e<n.length;e++)r+=n[e].outerHTML;u=o.drawHTML(`<style>body{margin:0;}</style>\n                ${r}\n                ${d.overlayDOMNode.outerHTML}\n                ${e.colorMapNode?e.colorMapNode.outerHTML:""}`,l,{zoom:t})}u.then((e=>{console.log("K3D: Screenshot [html]: "+((new Date).getTime()-h)/1e3,"s"),h=(new Date).getTime(),d.renderOffScreen(i.width,i.height).then((t=>{console.log("K3D: Screenshot [canvas]: "+((new Date).getTime()-h)/1e3,"s"),h=(new Date).getTime(),s.scale(1,-1),t.forEach((e=>{const t=new ImageData(e,i.width,i.height),n=document.createElement("canvas"),r=n.getContext("2d");n.width=t.width,n.height=t.height,r.putImageData(t,0,0),s.drawImage(n,0,0,i.width,-i.height)})),e&&(s.scale(1,-1),s.drawImage(l,0,0)),r(i)}))}),(e=>{a(e)}))}))}e.exports={screenshotGUI:function(e,t){const n={screenshot(){a(t,t.parameters.screenshotScale).then((e=>{e.toBlob((e=>{let n=`K3D-${Date.now()}.png`;t.parameters.name&&(n=`${t.parameters.name}.png`),r.saveAs(e,n)}))}),(()=>{console.error("Failed to render screenshot.")}))}};e.add(n,"screenshot").name("Screenshot")},getScreenshot:a}},52:(e,t,n)=>{const r=n(4126),o=n(4260),a=n(6150),i=n(7546),s=n(2656),l=n(2497),c=n(5927),d=n(1348),p=n(5527).version,u=n(5321);let h=window.k3dCompressed;const m=document.getElementsByTagName("script");let g;if(void 0===h){h="";for(let e=0;e<m.length;e++)m[e].getAttribute("src")&&m[e].getAttribute("src").includes("k3d")&&m[e].getAttribute("src").includes(".js")&&(g=m[e].getAttribute("src"));g=void 0!==g?g.replace("k3d.js","standalone.js").replace("index.js","standalone.js"):`https://unpkg.com/k3d@${p}/dist/standalone.js`,a(g,(e=>{h=u.arrayBufferToBase64(o.deflate(e))}))}function f(e,t){const n=u.arrayBufferToBase64(e.getSnapshot(t));let r;const o=(new Date).toUTCString();return"all"===e.parameters.snapshotType?(r=i,r=r.split("[REQUIRE_JS]").join(c),r=r.split("[PAKO_JS]").join(d),r=r.split("[K3D_SOURCE]").join(h)):"online"===e.parameters.snapshotType?(r=s,r=r.split("[VERSION]").join(e.parameters.guiVersion)):"inline"===e.parameters.snapshotType&&(r=l,r=r.split("[ID]").join(Math.floor(1e9*Math.random())),r=r.split("[HEIGHT]").join(e.parameters.height||512),r=r.split("[VERSION]").join(e.parameters.guiVersion)),r=r.split("[DATA]").join(n),r=r.split("[TIMESTAMP]").join(o),r=r.split("[ADDITIONAL]").join("//[ADDITIONAL]"),r}function v(e,t){const{files:n}=t.dataTransfer,r=new FileReader,a=new FileReader,i=new FileReader;if(t.stopPropagation(),t.preventDefault(),r.onload=function(t){const n=e.extractSnapshot(t.target.result);n[1]&&e.setSnapshot(n[1])},a.onload=function(t){e.setSnapshot(o.inflate(t.target.result))},i.onload=function(t){const n=t.target.result;e.load({objects:[{type:"STL",model_matrix:{data:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},binary:n,visible:!0,color:255,wireframe:!1,flat_shading:!1}]})},n.length>0){if("html"===n[0].name.substr(-4).toLowerCase())return void r.readAsText(n[0]);if("stl"===n[0].name.substr(-3).toLowerCase())return void i.readAsArrayBuffer(n[0]);a.readAsArrayBuffer(n[0])}}function y(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}e.exports={snapshotGUI:function(e,t){const n={snapshot(){let e=f(t,9),n=`K3D-snapshot-${Date.now()}.html`;t.parameters.name&&(n=`${t.parameters.name}.html`),e=new Blob([e],{type:"text/plain;charset=utf-8"}),r.saveAs(e,n)}};e.add(n,"snapshot").name("Snapshot HTML");const o=t.getWorld().targetDOMNode;o.addEventListener("dragover",y,!1),o.addEventListener("drop",v.bind(null,t),!1)},getHTMLSnapshot:f}},227:(e,t,n)=>{const r=n(6788),o=n(5843),{pow10ceil:a}=n(984);function i(e){let t=0,n=0;const r=e.getWorld(),o=[];return Object.keys(r.ObjectsListJson).forEach((e=>{const a=r.ObjectsListJson[e];let i=!1;Object.keys(a).forEach((e=>{a[e]&&void 0!==a[e].timeSeries&&(i=!0,Object.keys(a[e]).forEach((e=>{Number.isNaN(parseFloat(e))||(t=Math.min(t,parseFloat(e)),n=Math.max(n,parseFloat(e)))})))})),i&&o.push(a)})),Object.keys(e.parameters.cameraAnimation).forEach((e=>{Number.isNaN(parseFloat(e))||(t=Math.min(t,parseFloat(e)),n=Math.max(n,parseFloat(e)))})),{min:t,max:n,objects:o}}function s(e,t,n,a){let i,s,l,c;if("model_matrix"===a){const o=new r.Matrix4,a=new r.Vector3,i=new r.Quaternion,s=new r.Vector3,l=new r.Vector3,c=new r.Quaternion,d=new r.Vector3;o.set.apply(o,e.data),o.decompose(a,i,s),o.set.apply(o,t.data),o.decompose(l,c,d),a.lerp(l,n),i.slerp(c,n),s.lerp(d,n),o.compose(a,i,s);const p=o.toArray();return{data:new Float32Array([p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]),shape:e.shape}}if("string"==typeof e)return n>.5?t:e;if("boolean"==typeof e)return n>.5?t:e;if(o.isNumber(e))return e+n*(t-e);if(e.data){for(l=Math.min(e.data.length,t.data.length),c=Math.max(e.data.length,t.data.length),s=new e.data.constructor(c),i=0;i<l;i++)s[i]=e.data[i]+n*(t.data[i]-e.data[i]);if(l!==c)for(i=l;i<c;i++)s[i]=e.data[i]||t.data[i];return{data:s,shape:e.shape}}for(l=Math.min(e.length,t.length),c=Math.max(e.length,t.length),s=Array(c),i=0;i<s.length;i++)s[i]=e[i]+n*(t[i]-e[i]);if(l!==c)for(i=l;i<c;i++)s[i]=e[i]||t[i];return s}function l(e,t){e.autoPlayedHandler||(e.autoPlayedFps=e.parameters.fps,e.autoPlayedHandler=setInterval((()=>{if(e.autoPlayedFps!==e.parameters.fps)return clearInterval(e.autoPlayedHandler),e.autoPlayedHandler=!1,void l(e,t);let n=e.parameters.time+1/e.parameters.fps;n>e.GUI.controls.controllersMap.time.__max&&(n-=e.GUI.controls.controllersMap.time.__max),e.setTime(n),t("time",n)}),1e3/e.parameters.fps),e.GUI.controls.controllersMap.autoPlay.name("Stop loop"))}function c(e){e.autoPlayedHandler&&(clearInterval(e.autoPlayedHandler),e.autoPlayedHandler=!1,e.GUI.controls.controllersMap.autoPlay.name("Play loop"))}e.exports={refreshTimeScale(e,t){const n=i(e);t.controls.__controllers.forEach((e=>{"time"===e.property&&e.min(n.min).max(n.max).step(a(n.max-n.min)/1e4),-1!==["togglePlay","fps","time"].indexOf(e.property)&&(e.__li.hidden=n.min===n.max,e.updateDisplay())}))},interpolateTimeSeries(e,t){const n={},r={};return Object.keys(e).forEach((a=>{let i,l,c,d,p;if(e[a]&&void 0!==e[a].timeSeries){if(i=Object.keys(e[a]).reduce(((e,t)=>(Number.isNaN(parseFloat(t))||e.push({v:parseFloat(t),k:t}),e)),[]).sort(((e,t)=>e.v-t.v)),t<=i[0].v)n[a]=e[a][i[0].k];else if(t>=i[i.length-1].v)n[a]=e[a][i[i.length-1].k];else for(d=0;d<i.length;d++){if(Math.abs(i[d].v-t)<.001){n[a]="object"==typeof(u=e[a][i[d].k])?u.data?{data:u.data.slice(0),shape:u.shape}:o.cloneDeep(u):u;break}if(i[d].v>t&&d>0){l=i[d-1].v,c=i[d].v,p=(t-l)/(c-l),n[a]=s(e[a][i[d-1].k],e[a][i[d].k],p,a);break}}r[a]=n[a]}else n[a]=e[a];var u})),{json:n,changes:r}},getObjectsWithTimeSeriesAndMinMax:i,timeSeriesGUI(e,t,n){const r={togglePlay(){t.autoPlayedHandler?c(t):l(t,n)}};e.controllersMap=e.controllersMap||{},e.controllersMap.time=e.add(t.parameters,"time").min(0).max(1).name("time").onChange((e=>{t.setTime(e),n("time",e)})),e.controllersMap.fps=e.add(t.parameters,"fps").min(0).max(120).name("fps").onChange((e=>{n("fps",e)})),e.controllersMap.autoPlay=e.add(r,"togglePlay").name("Play loop")},startAutoPlay:l,stopAutoPlay:c}},7861:e=>{const t={view:"view",add:"add",change:"change",callback:"callback",manipulate:"manipulate"};e.exports={viewModeGUI:function(e,n){e.add(n.parameters,"viewMode",{View:t.view,Add:t.add,Change:t.change,Callback:t.callback,Manipulate:t.manipulate}).name("Mode").onChange((e=>{n.setViewMode(e),n.dispatch(n.events.PARAMETERS_CHANGE,{key:"mode",value:e})}))},viewModes:t}},1772:(e,t,n)=>{const r=n(5843);e.exports=r.extend({},n(6215)),e.exports.version=n(5527).version},6215:(e,t,n)=>{const r=n(829),o=n(5843),a=n(7723),i=n(4872),s=n(5251),l=n(7203),c=n(9452).CreateK3DAndLoadBinarySnapshot,d=n(5527).version,p={},u={},h=[];function m(e,t){h.forEach((n=>{-1!==n.model.get("object_ids").indexOf(e)&&t(n,n.K3DInstance.getObjectById(e))}))}n(4954);const g=r.WidgetModel.extend({defaults:o.extend(o.result({},"widgets.WidgetModel.prototype.defaults"),{_model_name:"ChunkModel",_model_module:"k3d",_model_module_version:d}),initialize(){const e=arguments[0];r.WidgetModel.prototype.initialize.apply(this,arguments),this.on("change",this._change,this),u[e.id]=this},_change(){const e=this.attributes;Object.keys(p).forEach((t=>{"VoxelsGroup"===p[t].attributes.type&&m(p[t].attributes.id,((t,n)=>{n.updateChunk(e)}))}))}},{serializers:o.extend({voxels:s,coord:s},r.WidgetModel.serializers)}),f=r.WidgetModel.extend({defaults:o.extend(o.result({},"widgets.WidgetModel.prototype.defaults"),{_model_name:"ObjectModel",_view_name:"ObjectView",_model_module:"k3d",_view_module:"k3d",_model_module_version:d,_view_module_version:d}),initialize(){const e=arguments[0];r.WidgetModel.prototype.initialize.apply(this,arguments),this.on("change",this._change,this),this.on("msg:custom",(function(e){let t;"fetch"===e.msg_type&&(t=this.get(e.field),o.isObject(t)&&(t.t=Math.random()),t.data&&t.shape&&(t.compression_level=this.attributes.compression_level),this.save(e.field,t)),"shadow_map_update"===e.msg_type&&"Volume"===this.get("type")&&m(this.get("id"),((t,n)=>{n.refreshLightMap(e.direction),t.K3DInstance.render()}))}),this),p[e.id]=this},_change(e){h.forEach((function(t){t.refreshObject(this,e.changed)}),this)}},{serializers:o.extend({model_matrix:s,positions:s,scalar_field:s,alpha_coef:s,shadow:s,shadow_res:s,shadow_delay:s,ray_samples_count:s,focal_plane:s,focal_length:s,gradient_step:s,color_map:s,samples:s,color_range:s,attribute:s,triangles_attribute:s,vertices:s,indices:s,colors:s,origins:s,vectors:s,opacity:s,opacities:s,point_sizes:s,point_size:s,width:s,shader:s,wireframe:s,radial_segments:s,color:s,flat_shading:s,heights:s,mesh_detail:s,voxels:s,voxels_group:s,sparse_voxels:s,space_size:s,volume:s,opacity_function:s,text:s,texture:s,binary:s,size:s,position:s,puv:s,visible:s,uvs:s,volume_bounds:s,spacings_x:s,spacings_y:s,spacings_z:s},r.WidgetModel.serializers)}),v=r.WidgetView.extend({}),y=r.DOMWidgetModel.extend({defaults:o.extend(o.result({},"widgets.DOMWidgetModel.prototype.defaults"),{_model_name:"PlotModel",_view_name:"PlotView",_model_module:"k3d",_view_module:"k3d",_model_module_version:d,_view_module_version:d})}),b=r.DOMWidgetView.extend({render(){const e=window.document.createElement("div"),t=window.document.createElement("div");e.style.cssText=[`height:${this.model.get("height")}px`,"position: relative"].join(";"),t.style.cssText=["width: 100%","height: 100%","position: relative"].join(";"),e.appendChild(t),this.el.appendChild(e),this.container=t,this.on("displayed",this._init,this)},remove(){o.pull(h,this),this.K3DInstance.off(this.K3DInstance.events.CAMERA_CHANGE,this.cameraChangeId),this.K3DInstance.off(this.K3DInstance.events.OBJECT_CHANGE,this.GUIObjectChanges),this.K3DInstance.off(this.K3DInstance.events.PARAMETERS_CHANGE,this.GUIParametersChanges),this.K3DInstance.off(this.K3DInstance.events.VOXELS_CALLBACK,this.voxelsCallback),this.K3DInstance.off(this.K3DInstance.events.OBJECT_HOVERED,this.objectHoverCallback),this.K3DInstance.off(this.K3DInstance.events.OBJECT_CLICKED,this.objectClickCallback)},_init(){const e=this;this.renderPromises=[],h.push(this),this.model.lastCameraSync=(new Date).getTime(),this.model.on("msg:custom",(function(t){const{model:n}=this;"fetch_screenshot"===t.msg_type&&this.K3DInstance.getScreenshot(this.K3DInstance.parameters.screenshotScale,t.only_canvas).then((e=>{const t=e.toDataURL().split(",")[1];n.save("screenshot",t,{patch:!0})})),"fetch_snapshot"===t.msg_type&&n.save("snapshot",this.K3DInstance.getHTMLSnapshot(t.compression_level),{patch:!0}),"start_auto_play"===t.msg_type&&this.K3DInstance.startAutoPlay(),"stop_auto_play"===t.msg_type&&this.K3DInstance.stopAutoPlay(),"reset_camera"===t.msg_type&&this.K3DInstance.resetCamera(t.factor),"render"===t.msg_type&&(0===e.renderPromises.length?e.K3DInstance.refreshAfterObjectsChange(!1,!0):Promise.all(e.renderPromises).then((t=>{e.K3DInstance.refreshAfterObjectsChange(!1,!0),t.length===e.renderPromises.length&&(e.renderPromises=[])})))}),this),this.model.on("change:camera_auto_fit",this._setCameraAutoFit,this),this.model.on("change:lighting",this._setDirectionalLightingIntensity,this),this.model.on("change:time",this._setTime,this),this.model.on("change:grid_auto_fit",this._setGridAutoFit,this),this.model.on("change:grid_visible",this._setGridVisible,this),this.model.on("change:grid_color",this._setGridColor,this),this.model.on("change:label_color",this._setLabelColor,this),this.model.on("change:fps_meter",this._setFpsMeter,this),this.model.on("change:fps",this._setFps,this),this.model.on("change:screenshot_scale",this._setScreenshotScale,this),this.model.on("change:voxel_paint_color",this._setVoxelPaintColor,this),this.model.on("change:background_color",this._setBackgroundColor,this),this.model.on("change:grid",this._setGrid,this),this.model.on("change:auto_rendering",this._setAutoRendering,this),this.model.on("change:camera",this._setCamera,this),this.model.on("change:camera_animation",this._setCameraAnimation,this),this.model.on("change:clipping_planes",this._setClippingPlanes,this),this.model.on("change:object_ids",this._onObjectsListChange,this),this.model.on("change:menu_visibility",this._setMenuVisibility,this),this.model.on("change:colorbar_object_id",this._setColorMapLegend,this),this.model.on("change:colorbar_scientific",this._setColorbarScientific,this),this.model.on("change:rendering_steps",this._setRenderingSteps,this),this.model.on("change:axes",this._setAxes,this),this.model.on("change:camera_no_rotate",this._setCameraLock,this),this.model.on("change:camera_no_zoom",this._setCameraLock,this),this.model.on("change:camera_no_pan",this._setCameraLock,this),this.model.on("change:camera_rotate_speed",this._setCameraSpeeds,this),this.model.on("change:camera_zoom_speed",this._setCameraSpeeds,this),this.model.on("change:camera_pan_speed",this._setCameraSpeeds,this),this.model.on("change:camera_fov",this._setCameraFOV,this),this.model.on("change:camera_damping_factor",this._setCameraDampingFactor,this),this.model.on("change:axes_helper",this._setAxesHelper,this),this.model.on("change:snapshot_type",this._setSnapshotType,this),this.model.on("change:name",this._setName,this),this.model.on("change:mode",this._setViewMode,this),this.model.on("change:camera_mode",this._setCameraMode,this),this.model.on("change:manipulate_mode",this._setManipulateMode,this);try{this.K3DInstance=new a(l,this.container,{antialias:this.model.get("antialias"),lighting:this.model.get("lighting"),cameraMode:this.model.get("camera_mode"),snapshotType:this.model.get("snapshot_type"),backendVersion:this.model.get("_backend_version"),screenshotScale:this.model.get("screenshot_scale"),menuVisibility:this.model.get("menu_visibility"),cameraNoRotate:this.model.get("camera_no_rotate"),cameraNoZoom:this.model.get("camera_no_zoom"),cameraNoPan:this.model.get("camera_no_pan"),cameraRotateSpeed:this.model.get("camera_rotate_speed"),cameraZoomSpeed:this.model.get("camera_zoom_speed"),cameraPanSpeed:this.model.get("camera_pan_speed"),cameraDampingFactor:this.model.get("camera_damping_factor"),colorbarObjectId:this.model.get("colorbar_object_id"),cameraAnimation:this.model.get("camera_animation"),name:this.model.get("name"),axes:this.model.get("axes"),axesHelper:this.model.get("axes_helper"),grid:this.model.get("grid"),fps:this.model.get("fps"),autoRendering:this.model.get("auto_rendering"),gridVisible:this.model.get("grid_visible"),gridColor:this.model.get("grid_color"),clippingPlanes:this.model.get("clipping_planes"),labelColor:this.model.get("label_color")}),!1===this.model.get("camera_auto_fit")&&this.K3DInstance.setCamera(this.model.get("camera"))}catch(e){return void console.log(e)}this.K3DInstance.setClearColor(this.model.get("background_color")),this.K3DInstance.setChunkList(u),this._setCameraAutoFit(),this._setGridAutoFit(),this._setMenuVisibility(),this._setVoxelPaintColor(),this.model.get("object_ids").forEach((function(e){this.renderPromises.push(this.K3DInstance.load({objects:[p[e].attributes]}))}),this),this.cameraChangeId=this.K3DInstance.on(this.K3DInstance.events.CAMERA_CHANGE,(t=>{(new Date).getTime()-e.model.lastCameraSync>200&&(e.model.lastCameraSync=(new Date).getTime(),e.model.save("camera",t,{patch:!0}))})),this.GUIObjectChanges=this.K3DInstance.on(this.K3DInstance.events.OBJECT_CHANGE,(t=>{e.model._comm_live&&(t.value.data&&t.value.shape&&(t.value.compression_level=p[t.id].attributes.compression_level),p[t.id]&&p[t.id].save(t.key,t.value,{patch:!0}))})),this.GUIParametersChanges=this.K3DInstance.on(this.K3DInstance.events.PARAMETERS_CHANGE,(t=>{e.model.save(t.key,t.value,{patch:!0})})),this.voxelsCallback=this.K3DInstance.on(this.K3DInstance.events.VOXELS_CALLBACK,(e=>{p[e.object.K3DIdentifier]&&p[e.object.K3DIdentifier].send({msg_type:"click_callback",coord:e.coord})})),this.objectHoverCallback=this.K3DInstance.on(this.K3DInstance.events.OBJECT_HOVERED,(e=>{p[e.object.K3DIdentifier]&&p[e.object.K3DIdentifier].send({msg_type:"hover_callback",position:e.point.toArray(),normal:e.face.normal.toArray(),distance:e.distance,face_index:e.faceIndex,face:[e.face.a,e.face.b,e.face.c],uv:e.uv})})),this.objectClickCallback=this.K3DInstance.on(this.K3DInstance.events.OBJECT_CLICKED,(e=>{p[e.object.K3DIdentifier]&&p[e.object.K3DIdentifier].send({msg_type:"click_callback",position:e.point.toArray(),normal:e.face.normal.toArray(),distance:e.distance,face_index:e.faceIndex,face:[e.face.a,e.face.b,e.face.c],uv:e.uv})}))},_setDirectionalLightingIntensity(){this.K3DInstance.setDirectionalLightingIntensity(this.model.get("lighting"))},_setTime(){this.K3DInstance.parameters.time!==this.model.get("time")&&this.renderPromises.push(this.K3DInstance.setTime(this.model.get("time")))},_setCameraAutoFit(){this.K3DInstance.setCameraAutoFit(this.model.get("camera_auto_fit"))},_setGridAutoFit(){this.K3DInstance.setGridAutoFit(this.model.get("grid_auto_fit"))},_setGridVisible(){this.K3DInstance.setGridVisible(this.model.get("grid_visible"))},_setGridColor(){this.K3DInstance.setGridColor(this.model.get("grid_color"))},_setLabelColor(){this.K3DInstance.setLabelColor(this.model.get("label_color"))},_setFps(){this.K3DInstance.setFps(this.model.get("fps"))},_setFpsMeter(){this.K3DInstance.setFpsMeter(this.model.get("fps_meter"))},_setScreenshotScale(){this.K3DInstance.setScreenshotScale(this.model.get("screenshot_scale"))},_setVoxelPaintColor(){this.K3DInstance.setVoxelPaint(this.model.get("voxel_paint_color"))},_setBackgroundColor(){this.K3DInstance.setClearColor(this.model.get("background_color"))},_setGrid(){this.K3DInstance.setGrid(this.model.get("grid"))},_setAutoRendering(){this.K3DInstance.setAutoRendering(this.model.get("auto_rendering"))},_setMenuVisibility(){this.K3DInstance.setMenuVisibility(this.model.get("menu_visibility"))},_setColorMapLegend(){this.K3DInstance.setColorMapLegend(this.model.get("colorbar_object_id"))},_setColorbarScientific(){this.K3DInstance.setColorbarScientific(this.model.get("colorbar_scientific"))},_setCamera(){this.K3DInstance.setCamera(this.model.get("camera"))},_setCameraAnimation(){this.K3DInstance.setCameraAnimation(this.model.get("camera_animation"))},_setRenderingSteps(){this.K3DInstance.setRenderingSteps(this.model.get("rendering_steps"))},_setAxes(){this.K3DInstance.setAxes(this.model.get("axes"))},_setName(){this.K3DInstance.setName(this.model.get("name"))},_setViewMode(){this.K3DInstance.setViewMode(this.model.get("mode"))},_setCameraMode(){this.K3DInstance.setCameraMode(this.model.get("camera_mode"))},_setManipulateMode(){this.K3DInstance.setManipulateMode(this.model.get("manipulate_mode"))},_setAxesHelper(){this.K3DInstance.setAxesHelper(this.model.get("axes_helper"))},_setSnapshotType(){this.K3DInstance.setSnapshotType(this.model.get("snapshot_type"))},_setCameraLock(){this.K3DInstance.setCameraLock(this.model.get("camera_no_rotate"),this.model.get("camera_no_zoom"),this.model.get("camera_no_pan"))},_setCameraSpeeds(){this.K3DInstance.setCameraSpeeds(this.model.get("camera_rotate_speed"),this.model.get("camera_zoom_speed"),this.model.get("camera_pan_speed"))},_setCameraFOV(){this.K3DInstance.setCameraFOV(this.model.get("camera_fov"))},_setCameraDampingFactor(){this.K3DInstance.setCameraDampingFactor(this.model.get("camera_damping_factor"))},_setClippingPlanes(){this.K3DInstance.setClippingPlanes(this.model.get("clipping_planes"))},_onObjectsListChange(){const e=this.model.previous("object_ids"),t=this.model.get("object_ids");o.difference(e,t).forEach((function(e){this.renderPromises.push(this.K3DInstance.removeObject(e))}),this),o.difference(t,e).forEach((function(e){this.renderPromises.push(this.K3DInstance.load({objects:[p[e].attributes]}))}),this)},refreshObject(e,t){-1!==this.model.get("object_ids").indexOf(e.get("id"))&&this.renderPromises.push(this.K3DInstance.reload(p[e.get("id")].attributes,t))},processPhosphorMessage(e){switch(r.DOMWidgetView.prototype.processPhosphorMessage.call(this,e),e.type){case"after-attach":this.el.addEventListener("contextmenu",this,!0);break;case"before-detach":this.el.removeEventListener("contextmenu",this,!0);break;case"resize":this.handleResize(e)}},handleEvent(e){switch(e.type){case"contextmenu":this.handleContextMenu(e);break;default:r.DOMWidgetView.prototype.handleEvent.call(this,e)}},handleContextMenu(e){this.container.contains(e.target)&&(e.preventDefault(),e.stopPropagation())},handleResize(){this.K3DInstance&&this.K3DInstance.resizeHelper()}});e.exports={ChunkModel:g,PlotModel:y,PlotView:b,ObjectModel:f,ObjectView:v,ThreeJsProvider:l,CreateK3DAndLoadBinarySnapshot:c,TransferFunctionEditor:i.transferFunctionEditor,TransferFunctionModel:i.transferFunctionModel,TransferFunctionView:i.transferFunctionView,K3D:a}},1026:(e,t,n)=>{const r=n(829),o=n(1772),{version:a}=n(5527);e.exports={id:"jupyter.extensions.k3d",requires:[r.IJupyterWidgetRegistry],activate(e,t){n(2876),n(4316),t.registerWidget({name:"k3d",version:a,exports:o})},autoStart:!0}},5843:(e,t,n)=>{e.exports={extend:n(4925),result:n(6080),pull:n(2092),difference:n(8288),assign:n(9530),assignWith:n(8395),eq:n(5173),cloneDeep:n(543),clone:n(8802),values:n(9792),keys:n(6066),invert:n(560),isNumber:n(2591),intersection:n(8130),range:n(4237),merge:n(9085),isObject:n(6283),isEmpty:n(8795)}},9724:(e,t,n)=>{const r=n(6788),{createCanvasGradient:o}=n(5103),a=n(1020);function i(e){return[e.targetDOMNode.offsetWidth,e.targetDOMNode.offsetHeight]}e.exports={closestPowOfTwo:e=>Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))),getObjectById:(e,t)=>e.ObjectsById[t],getSpaceDimensionsFromTargetElement:i,resizeListener(e){const t=i(e);e.width=t[0],e.height=t[1],e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.width,e.height)},getColorsArray(e,t){const n=new Float32Array(3*t);let r;for(r=0;r<n.length;r+=3)n[r]=e.r,n[r+1]=e.g,n[r+2]=e.b;return n},getTwoColorsArray(e,t,n){const r=new Float32Array(3*n);let o;for(o=0;o<r.length;o+=6)r[o]=e.r,r[o+1]=e.g,r[o+2]=e.b,r[o+3]=t.r,r[o+4]=t.g,r[o+5]=t.b;return r},expandBoundingBox(e,t){e.min.x-=t,e.max.x+=t,e.min.y-=t,e.max.y+=t,e.min.z-=t,e.max.z+=t},generateArrow(e,t,n,o,a,i,s){const l=new r.Vector3,c=(new r.Vector3).subVectors(a,o),d=c.length(),p=[];let u,h,m=new r.Quaternion;if(c.normalize(),t.push(o.x,o.y,o.z),null!==e){for(e=e.clone(),h=(new r.Vector3).copy(o).add(c.clone().multiplyScalar(d-s)),t.push(h.x,h.y,h.z),u=0;u<e.attributes.position.count;u++)p.push(i.r),p.push(i.g),p.push(i.b);e.setAttribute("color",new r.Float32BufferAttribute(p,3)),c.y>.99999?m.set(0,0,0,1):c.y<-.99999?m.set(1,0,0,0):(l.set(c.z,0,-c.x).normalize(),m=(new r.Quaternion).setFromAxisAngle(l,Math.acos(c.y))),e.applyMatrix4((new r.Matrix4).makeRotationFromQuaternion(m)),e.translate(a.x,a.y,a.z),n?n.push(e):n=[e]}else t.push(a.x,a.y,a.z);return n},handleColorMap(e,t,n,a,i){let s,l;const c=o(t,1024),d=new r.CanvasTexture(c,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);if(d.needsUpdate=!0,i.setValues({map:d,color:16777215}),a){for(s=new Float32Array(a.length),l=0;l<a.length;l++)s[l]=(a[l]-n[0])/(n[1]-n[0]);e.setAttribute("uv",new r.BufferAttribute(s,1))}},typedArrayToThree:e=>e===Int16Array?r.ShortType:e===Int32Array?r.IntType:e===a?r.HalfFloatType:e===Float32Array?r.FloatType:null,areAllChangesResolve:(e,t)=>Object.keys(e).every((e=>void 0!==t[e])),recalculateFrustum(e){e.frustum.setFromProjectionMatrix((new r.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))},commonUpdate(e,t,n,o){if(void 0!==t.model_matrix&&!t.model_matrix.timeSeries){const e=new r.Matrix4;e.set.apply(e,t.model_matrix.data),o.initialPosition?o.position.copy(o.initialPosition):o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),o.applyMatrix4(e),o.updateMatrixWorld(),o.transformControls&&o.transformControls.updateMatrixWorld(),n.model_matrix=null}void 0===t.visible||t.visible.timeSeries||(o.visible=t.visible,n.visible=null)},getSide(e){const t={front:r.FrontSide,back:r.BackSide,double:r.DoubleSide};return e.opacity<1?t.double:e.side&&t[e.side]||t.front}}},1854:(e,t,n)=>{const r=n(5735),o=n(6154);e.exports={init(e,t,n){t.startInteraction=function(){t.interactions||(t.geometry.boundsTree=new r.MeshBVH(t.geometry),t.interactions=o(t,n))},t.stopInteraction=function(){t.interactions&&(t.geometry.boundsTree=null,t.interactions=null)},(e.click_callback||e.hover_callback)&&t.startInteraction()},update(e,t,n,r){void 0===t.click_callback&&void 0===t.hover_callback||((t.click_callback||t.hover_callback)&&r.startInteraction(),t.click_callback||t.hover_callback||r.stopInteraction(),n.click_callback=null,n.hover_callback=null)}}},6841:(e,t,n)=>{const r=n(6788),o=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];e.exports=function(e,t,n,a,i,s,l,c,d){return new Promise((p=>{const u=o[Math.max(0,Math.min(c,5))],{autoClear:h}=e,m=r.CopyShader,g=r.UniformsUtils.clone(m.uniforms),f=new r.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1}),v=new r.WebGLRenderTarget(a.width,a.height,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat}),y=new r.OrthographicCamera(-1,1,1,-1,0,1),b=new r.Scene,x=new r.Mesh(new r.PlaneBufferGeometry(2,2),f);x.frustumCulled=!1,b.add(x),e.autoClear=!1;let _=new r.Color;e.getClearColor(_),_=_.getHex();const w=e.getClearAlpha(),M=1/u.length;g.tDiffuse.value=v.texture;const C=new Uint8ClampedArray(i*s*4);let E=Promise.resolve();l.forEach((r=>{E=E.then((()=>{const{width:o}=a,l=r[1];for(let c=0;c<u.length;c++){const p=u[c];n.setViewOffset(i,s,.0625*p[0],.0625*p[1]+r[0],o,l);let h=M;h+=.03125*((c+.5)/u.length-.5),g.opacity.value=h,e.setClearColor(0,0),e.setRenderTarget(v),e.clear(),d(t,n,v),e.setRenderTarget(a),0===c&&(e.setClearColor(0,0),e.clear()),e.render(b,y)}C.set(function(e,t){const n=new Float32Array(t.width*t.height*4),r=new Uint8ClampedArray(t.width*t.height*4);let o;for(e.readRenderTargetPixels(t,0,0,t.width,t.height,n),o=0;o<n.length;o++)r[o]=Math.floor(256*n[o]);return r}(e,a).subarray(0,o*l*4),(s-l-r[0])*o*4)})),E=E.then((()=>new Promise((e=>{setTimeout(e,100)}))))})),E=E.then((()=>{n.clearViewOffset&&n.clearViewOffset(),e.autoClear=h,e.setClearColor(_,w),v.dispose(),p(C)}))}))}},7241:(e,t,n)=>{const r=n(6788);e.exports=function(e,t,n,o,a,i,s){const l=new r.BufferGeometry,c=[],d=[],p=[],u=[],h=[];let m=null,g=null;const f=new r.Vector3;let v,y,b,x,_,w,M,C,E,S,A,P=0;function D(e){let t,n,r,a,i;for(let s=e;s<e+P-1;s++)for(i=0;i<o;i++)t=o*s+i,n=o*(s+1)+i,r=o*(s+1)+(i+1)%o,a=o*s+(i+1)%o,h.push(t,n,a),h.push(n,r,a)}function z(e,l,h,m){const v=new r.Vector3,y=new r.Vector3,b=new r.Vector3,x=l.clone().sub(e).normalize();let _,w,M,C,E,S,A;null===g?(_=Number.MAX_VALUE,w=Math.abs(x.x),M=Math.abs(x.y),C=Math.abs(x.z),w<=_&&(_=w,v.set(1,0,0)),M<=_&&(_=M,v.set(0,1,0)),C<=_&&v.set(0,0,1),y.crossVectors(x,v).normalize(),g=new r.Vector3,g.crossVectors(x,y)):m&&g.applyMatrix4(m),b.crossVectors(x,g);for(let r=0;r<o;r++)E=r/o*(2*Math.PI),S=Math.sin(E),A=-Math.cos(E),v.x=A*g.x+S*b.x,v.y=A*g.y+S*b.y,v.z=A*g.z+S*b.z,v.normalize(),d.push(v.x,v.y,v.z),f.x=e.x+n*v.x,f.y=e.y+n*v.y,f.z=e.z+n*v.z,c.push(f.x,f.y,f.z),null!==t&&t.length>0?p.push((t[h]-s[0])/(s[1]-s[0]),r/o):null!==i&&i.length>0?u.push(i[3*h],i[3*h+1],i[3*h+2]):u.push(a.r,a.g,a.b);P++}A=0;for(let t=0;t<e.length/3;t++)x=null,t!==e.length/3-1?(v=(new r.Vector3).fromArray(e,3*t),y=(new r.Vector3).fromArray(e,3*t+3),b=y.clone().sub(v).normalize()):(v=(new r.Vector3).fromArray(e,3*t),y=(new r.Vector3).fromArray(e,3*t-3),y.add(v.clone().sub(y).multiplyScalar(2))),Number.isNaN(v.x)||Number.isNaN(v.y)||Number.isNaN(v.z)||Number.isNaN(y.x)||Number.isNaN(y.y)||Number.isNaN(y.z)?(D(A),m=null,g=null,A+=P,P=0):(m&&b&&(_=(new r.Vector3).crossVectors(m,b),w=_.length(),w>Number.EPSILON&&(w>.3&&(C=Math.min(n,y.clone().sub(v).length()/5),E=v.clone(),S=y.clone(),v.sub(m.clone().multiplyScalar(C)),y.copy(E).add(m.clone().multiplyScalar(C)),z(v,y,t),v.copy(E).add(b.clone().multiplyScalar(C)),y.copy(S)),_=_.divideScalar(w),M=Math.acos(r.Math.clamp(m.clone().dot(b),-1,1)),x=(new r.Matrix4).makeRotationAxis(_,M))),z(v,y,t,x),m=b.clone());return D(A),l.setIndex(h),l.setAttribute("position",new r.Float32BufferAttribute(c,3)),l.setAttribute("normal",new r.Float32BufferAttribute(d,3)),null!==t&&t.length>0?l.setAttribute("uv",new r.Float32BufferAttribute(p,2)):l.setAttribute("color",new r.Float32BufferAttribute(u,3)),l}},8117:e=>{e.exports=function(e){e.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}}},2460:e=>{e.exports=function(e){function t(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new e.BufferGeometry}function n(t){let n;function r(e,t){return void 0===e?t:e}return e.Material.call(this),t=t||{},this.lineWidth=r(t.lineWidth,1),this.map=r(t.map,null),this.useMap=r(t.useMap,0),this.color=r(t.color,new e.Color(16777215)),this.opacity=r(t.opacity,1),this.resolution=r(t.resolution,new e.Vector2(1,1)),this.sizeAttenuation=r(t.sizeAttenuation,1),this.near=r(t.near,1),this.far=r(t.far,1),this.visibility=r(t.visibility,1),n=new e.ShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},visibility:{type:"f",value:this.visibility}},vertexShader:["precision highp float;","","attribute vec3 previous;","attribute vec3 next;","attribute vec3 colors;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","#include <clipping_planes_pars_vertex>","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","    vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color * colors, opacity );","    vUV = uv;","","    vec3 mvPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;","    #include <clipping_planes_vertex>","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = max(1.8 * pixelWidth * 2.0, 1.8 * lineWidth * width);","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","","    gl_Position = finalPosition;","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform float useMap;","uniform float visibility;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","#include <clipping_planes_pars_fragment>","","void main() {",""," #include <clipping_planes_fragment>","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV);","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","}"].join("\r\n"),clipping:!0}),delete t.lineWidth,delete t.map,delete t.useMap,delete t.color,delete t.opacity,delete t.resolution,delete t.sizeAttenuation,delete t.near,delete t.far,delete t.visibility,n.type="MeshLineMaterial",n.setValues(t),n}return t.prototype.setGeometry=function(e,t,n,r,o){let a,i,s;if(e instanceof Float32Array||e instanceof Array)for(this.positions=new Float32Array(2*e.length),this.counters=new Float32Array(2*e.length/3),a=0;a<e.length;a+=3)i=a/e.length,this.positions[2*a]=this.positions[2*a+3]=e[a],this.positions[2*a+1]=this.positions[2*a+4]=e[a+1],this.positions[2*a+2]=this.positions[2*a+5]=e[a+2],this.counters[2*a]=this.counters[2*a+1]=i;for(s=this.positions.length/6,this.width=new Float32Array(2*s),this.colors=new Float32Array(6*s),this.uvs=new Float32Array(4*s),a=0;a<s;a++)this.width[2*a]=this.width[2*a+1]=n?n[a]:1,r?(this.colors[6*a]=this.colors[6*a+3]=r[3*a],this.colors[6*a+1]=this.colors[6*a+4]=r[3*a+1],this.colors[6*a+2]=this.colors[6*a+5]=r[3*a+2]):this.colors[6*a]=this.colors[6*a+1]=this.colors[6*a+2]=this.colors[6*a+3]=this.colors[6*a+4]=this.colors[6*a+5]=1,o?(this.uvs[4*a]=this.uvs[4*a+2]=o[a],this.uvs[4*a+1]=0,this.uvs[4*a+3]=1):(this.uvs[4*a]=this.uvs[4*a+2]=a/(s-1),this.uvs[4*a+1]=0,this.uvs[4*a+3]=1);this.process(t)},t.prototype.compareV3=function(e,t){const n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]},t.prototype.copyV3=function(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},t.prototype.process=function(t){const n=this.positions.length/6;let r,o,a,i,s;for(this.previous=new Float32Array(12*n/2),this.next=new Float32Array(12*n/2),this.side=new Float32Array(2*n),this.indices_array=new Uint32Array(6*(Math.max(n,1)-1)),r=0;r<n;r++)this.side[2*r]=1,this.side[2*r+1]=-1;if(t){for(r=0;r<n;r+=2)s=r/2*12,this.previous[s]=this.previous[s+3]=this.previous[s+6]=this.previous[s+9]=this.positions[6*r],this.previous[s+1]=this.previous[s+4]=this.previous[s+7]=this.previous[s+10]=this.positions[6*r+1],this.previous[s+2]=this.previous[s+5]=this.previous[s+8]=this.previous[s+11]=this.positions[6*r+2];for(r=0;r<n;r+=2)a=r+1,s=r/2*12,this.next[s]=this.next[s+3]=this.next[s+6]=this.next[s+9]=this.positions[6*a],this.next[s+1]=this.next[s+4]=this.next[s+7]=this.next[s+10]=this.positions[6*a+1],this.next[s+2]=this.next[s+5]=this.next[s+8]=this.next[s+11]=this.positions[6*a+2];for(r=0;r<n-1;r+=2)o=2*r,this.indices_array[6*r]=o,this.indices_array[6*r+1]=o+1,this.indices_array[6*r+2]=o+2,this.indices_array[6*r+3]=o+2,this.indices_array[6*r+4]=o+1,this.indices_array[6*r+5]=o+3}else{for(i=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous[0]=this.previous[3]=i[0],this.previous[1]=this.previous[4]=i[1],this.previous[2]=this.previous[5]=i[2],r=0;r<n-1;r++)i=this.copyV3(r),this.previous[6+6*r]=this.previous[6+6*r+3]=i[0],this.previous[6+6*r+1]=this.previous[6+6*r+4]=i[1],this.previous[6+6*r+2]=this.previous[6+6*r+5]=i[2];for(r=1;r<n;r++)i=this.copyV3(r),this.next[6*(r-1)]=this.next[6*(r-1)+3]=i[0],this.next[6*(r-1)+1]=this.next[6*(r-1)+4]=i[1],this.next[6*(r-1)+2]=this.next[6*(r-1)+5]=i[2];for(i=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next[6*(n-1)]=this.next[6*(n-1)+3]=i[0],this.next[6*(n-1)+1]=this.next[6*(n-1)+4]=i[1],this.next[6*(n-1)+2]=this.next[6*(n-1)+5]=i[2],r=0;r<n-1;r++)o=2*r,this.indices_array[6*r]=o,this.indices_array[6*r+1]=o+1,this.indices_array[6*r+2]=o+2,this.indices_array[6*r+3]=o+2,this.indices_array[6*r+4]=o+1,this.indices_array[6*r+5]=o+3}this.attributes?(this.attributes.position.copyArray(this.positions),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(this.previous),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(this.next),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(this.side),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(this.width),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(this.uvs),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(this.indices_array),this.attributes.index.needsUpdate=!0,this.attributes.colors.copyArray(this.colors),this.attributes.colors.needsUpdate=!0):this.attributes={position:new e.BufferAttribute(this.positions,3),previous:new e.BufferAttribute(this.previous,3),next:new e.BufferAttribute(this.next,3),side:new e.BufferAttribute(this.side,1),width:new e.BufferAttribute(this.width,1),uv:new e.BufferAttribute(this.uvs,2),index:new e.BufferAttribute(this.indices_array,1),counters:new e.BufferAttribute(this.counters,1),colors:new e.BufferAttribute(this.colors,3)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setAttribute("colors",this.attributes.colors),this.geometry.setIndex(this.attributes.index)},n.prototype=Object.create(e.Material.prototype),n.prototype.constructor=n,n.prototype.copy=function(t){return e.Material.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.near=t.near,this.far=t.far,this.visibility=t.visibility,this},{MeshLine:t,MeshLineMaterial:n}}},9209:e=>{e.exports=function(e){e.OrbitControls=function(t,n){let r,o;void 0!==n?(r=n.ownerDocument.defaultView||n.ownerDocument.parentWindow,this.domElement=n,o=n.ownerDocument):(r=window,this.domElement=o=r.document),this.object=t,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object.zoom},this.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a.dispatchEvent(i),a.update(),d=c.NONE},this.update=function(){const n=new e.Vector3,r=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),o=r.clone().inverse(),s=new e.Vector3,l=new e.Quaternion;return function(){const{position:e}=a.object;return n.copy(e).sub(a.target),n.applyQuaternion(r),u.setFromVector3(n),a.autoRotate&&d===c.NONE&&A(2*Math.PI/60/60*a.autoRotateSpeed),a.enableDamping?(u.theta+=h.theta*a.dampingFactor,u.phi+=h.phi*a.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(a.minAzimuthAngle,Math.min(a.maxAzimuthAngle,u.theta)),u.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=m,u.radius=Math.max(a.minDistance,Math.min(a.maxDistance,u.radius)),!0===a.enableDamping?a.target.addScaledVector(g,a.dampingFactor):a.target.add(g),n.setFromSpherical(u),n.applyQuaternion(o),e.copy(a.target).add(n),a.object.lookAt(a.target),!0===a.enableDamping?(h.theta*=1-a.dampingFactor,h.phi*=1-a.dampingFactor,g.multiplyScalar(1-a.dampingFactor)):(h.set(0,0,0),g.set(0,0,0)),m=1,!!(f||s.distanceToSquared(a.object.position)>p||8*(1-l.dot(a.object.quaternion))>p)&&(s.copy(a.object.position),l.copy(a.object.quaternion),f=!1,a.dispatchEvent(i),!0)}}(),this.dispose=function(){a.domElement.removeEventListener("contextmenu",$,!1),a.domElement.removeEventListener("mousedown",U,!1),a.domElement.removeEventListener("wheel",H,!1),a.domElement.removeEventListener("touchstart",Y,!1),a.domElement.removeEventListener("touchend",Z,!1),a.domElement.removeEventListener("touchmove",X,!1),o.removeEventListener("mousemove",W,!1),o.removeEventListener("mouseup",G,!1),a.domElement.removeEventListener("keydown",K,!1)};var a=this,i={type:"change"};const s={type:"start"},l={type:"end"};var c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=c.NONE,p=1e-6,u=new e.Spherical,h=new e.Spherical,m=1,g=new e.Vector3,f=!1;const v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2,_=new e.Vector2,w=new e.Vector2,M=new e.Vector2,C=new e.Vector2,E=new e.Vector2;function S(){return Math.pow(.95,a.zoomSpeed)}function A(e){h.theta-=e}function P(e){h.phi-=e}const D=function(){const t=new e.Vector3;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),g.add(t)}}(),z=function(){const t=new e.Vector3;return function(e,n){!0===a.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(a.object.up,t)),t.multiplyScalar(e),g.add(t)}}(),T=function(){const t=new e.Vector3;return function(e,n){const r=a.domElement;if(a.object.isPerspectiveCamera){const{position:o}=a.object;t.copy(o).sub(a.target);let i=t.length();i*=Math.tan(a.object.fov/2*Math.PI/180),D(2*e*i/r.clientHeight,a.object.matrix),z(2*n*i/r.clientHeight,a.object.matrix)}else a.object.isOrthographicCamera?(D(e*(a.object.right-a.object.left)/a.object.zoom/r.clientWidth,a.object.matrix),z(n*(a.object.top-a.object.bottom)/a.object.zoom/r.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function O(e){a.object.isPerspectiveCamera?m/=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function j(e){a.object.isPerspectiveCamera?m*=e:a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function L(e){v.set(e.clientX,e.clientY)}function k(e){x.set(e.clientX,e.clientY)}function I(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,n)}}function F(e){if(1==e.touches.length)x.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(t,n)}}function V(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);M.set(0,r)}function R(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,n)}b.subVectors(y,v).multiplyScalar(a.rotateSpeed);const t=a.domElement;A(2*Math.PI*b.x/t.clientHeight),P(2*Math.PI*b.y/t.clientHeight),v.copy(y)}function B(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,n)}w.subVectors(_,x).multiplyScalar(a.panSpeed),T(w.x,w.y),x.copy(_)}function N(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);C.set(0,r),E.set(0,Math.pow(C.y/M.y,a.zoomSpeed)),O(E.y),M.copy(C)}function U(t){if(!1!==a.enabled){switch(t.preventDefault(),a.domElement.focus?a.domElement.focus():r.focus(),t.button){case 0:switch(a.mouseButtons.LEFT){case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===a.enablePan)return;k(t),d=c.PAN}else{if(!1===a.enableRotate)return;L(t),d=c.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===a.enableRotate)return;L(t),d=c.ROTATE}else{if(!1===a.enablePan)return;k(t),d=c.PAN}break;default:d=c.NONE}break;case 1:switch(a.mouseButtons.MIDDLE){case e.MOUSE.DOLLY:if(!1===a.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(t),d=c.DOLLY;break;default:d=c.NONE}break;case 2:switch(a.mouseButtons.RIGHT){case e.MOUSE.ROTATE:if(!1===a.enableRotate)return;L(t),d=c.ROTATE;break;case e.MOUSE.PAN:if(!1===a.enablePan)return;k(t),d=c.PAN;break;default:d=c.NONE}}d!==c.NONE&&(o.addEventListener("mousemove",W,!1),o.addEventListener("mouseup",G,!1),a.dispatchEvent(s))}}function W(e){if(!1!==a.enabled)switch(e.preventDefault(),d){case c.ROTATE:if(!1===a.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,v).multiplyScalar(a.rotateSpeed);const t=a.domElement;A(2*Math.PI*b.x/t.clientHeight),P(2*Math.PI*b.y/t.clientHeight),v.copy(y),a.update()}(e);break;case c.DOLLY:if(!1===a.enableZoom)return;!function(e){C.set(e.clientX,e.clientY),E.subVectors(C,M),E.y>0?O(S()):E.y<0&&j(S()),M.copy(C),a.update()}(e);break;case c.PAN:if(!1===a.enablePan)return;!function(e){_.set(e.clientX,e.clientY),w.subVectors(_,x).multiplyScalar(a.panSpeed),T(w.x,w.y),x.copy(_),a.update()}(e)}}function G(e){!1!==a.enabled&&(o.removeEventListener("mousemove",W,!1),o.removeEventListener("mouseup",G,!1),a.dispatchEvent(l),d=c.NONE)}function H(e){!1===a.enabled||!1===a.enableZoom||d!==c.NONE&&d!==c.ROTATE||(e.preventDefault(),e.stopPropagation(),a.dispatchEvent(s),function(e){e.deltaY<0?j(S()):e.deltaY>0&&O(S()),a.update()}(e),a.dispatchEvent(l))}function K(e){!1!==a.enabled&&!1!==a.enableKeys&&!1!==a.enablePan&&function(e){let t=!1;switch(e.keyCode){case a.keys.UP:T(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:T(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:T(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:T(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}(e)}function Y(e){if(!1!==a.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(a.touches.ONE){case TOUCH.ROTATE:if(!1===a.enableRotate)return;I(e),d=c.TOUCH_ROTATE;break;case TOUCH.PAN:if(!1===a.enablePan)return;F(e),d=c.TOUCH_PAN;break;default:d=c.NONE}break;case 2:switch(a.touches.TWO){case TOUCH.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&V(e),a.enablePan&&F(e)}(e),d=c.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&V(e),a.enableRotate&&I(e)}(e),d=c.TOUCH_DOLLY_ROTATE;break;default:d=c.NONE}break;default:d=c.NONE}d!==c.NONE&&a.dispatchEvent(s)}}function X(e){if(!1!==a.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case c.TOUCH_ROTATE:if(!1===a.enableRotate)return;R(e),a.update();break;case c.TOUCH_PAN:if(!1===a.enablePan)return;B(e),a.update();break;case c.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&N(e),a.enablePan&&B(e)}(e),a.update();break;case c.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&N(e),a.enableRotate&&R(e)}(e),a.update();break;default:d=c.NONE}}function Z(e){!1!==a.enabled&&(a.dispatchEvent(l),d=c.NONE)}function $(e){!1!==a.enabled&&e.preventDefault()}a.domElement.addEventListener("contextmenu",$,!1),a.domElement.addEventListener("mousedown",U,!1),a.domElement.addEventListener("wheel",H,!1),a.domElement.addEventListener("touchstart",Y,!1),a.domElement.addEventListener("touchend",Z,!1),a.domElement.addEventListener("touchmove",X,!1),a.domElement.addEventListener("keydown",K,!1),-1===a.domElement.tabIndex&&(a.domElement.tabIndex=0),this.update()},e.OrbitControls.prototype=Object.create(e.EventDispatcher.prototype),e.OrbitControls.prototype.constructor=e.OrbitControls}},9806:e=>{e.exports=function(e){e.STLLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.STLLoader.prototype={constructor:e.STLLoader,load(t,n,r,o){const a=this,i=new e.FileLoader(a.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.load(t,(e=>{try{n(a.parse(e))}catch(e){o&&o(e)}}),r,o)},setPath(e){return this.path=e,this},parse(t){function n(e,t,n){for(let r=0,o=e.length;r<o;r++)if(e[r]!==t.getUint8(n+r,!1))return!1;return!0}const r=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}return e}(t);return function(e){let t,r,o,a;if(a=new DataView(e),r=50,o=a.getUint32(80,!0),t=84+50*o,t===a.byteLength)return!0;const i=[115,111,108,105,100];for(let e=0;e<5;e++)if(n(i,a,e))return!1;return!0}(r)?function(t){const n=new DataView(t),r=n.getUint32(80,!0);let o,a,i,s,l,c,d,p,u=!1;for(let e=0;e<70;e++)1129270351==n.getUint32(e,!1)&&82==n.getUint8(e+4)&&61==n.getUint8(e+5)&&(u=!0,s=[],l=n.getUint8(e+6)/255,c=n.getUint8(e+7)/255,d=n.getUint8(e+8)/255,p=n.getUint8(e+9)/255);const h=new e.BufferGeometry,m=[],g=[];for(let e=0;e<r;e++){const t=84+50*e,r=n.getFloat32(t,!0),p=n.getFloat32(t+4,!0),h=n.getFloat32(t+8,!0);if(u){const e=n.getUint16(t+48,!0);0==(32768&e)?(o=(31&e)/31,a=(e>>5&31)/31,i=(e>>10&31)/31):(o=l,a=c,i=d)}for(let e=1;e<=3;e++){const l=t+12*e;m.push(n.getFloat32(l,!0)),m.push(n.getFloat32(l+4,!0)),m.push(n.getFloat32(l+8,!0)),g.push(r,p,h),u&&s.push(o,a,i)}}return h.setAttribute("position",new e.BufferAttribute(new Float32Array(m),3)),h.setAttribute("normal",new e.BufferAttribute(new Float32Array(g),3)),u&&(h.setAttribute("color",new e.BufferAttribute(new Float32Array(s),3)),h.hasColors=!0,h.alpha=p),h}(r):function(t){const n=new e.BufferGeometry,r=/facet([\s\S]*?)endfacet/g;let o=0;const a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp(`vertex${a}${a}${a}`,"g"),s=new RegExp(`normal${a}${a}${a}`,"g"),l=[],c=[],d=new e.Vector3;let p;for(;null!==(p=r.exec(t));){let e=0,t=0;const n=p[0];for(;null!==(p=s.exec(n));)d.x=parseFloat(p[1]),d.y=parseFloat(p[2]),d.z=parseFloat(p[3]),t++;for(;null!==(p=i.exec(n));)l.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),c.push(d.x,d.y,d.z),e++;1!==t&&console.error(`THREE.STLLoader: Something isn't right with the normal of face number ${o}`),3!==e&&console.error(`THREE.STLLoader: Something isn't right with the vertices of face number ${o}`),o++}return n.setAttribute("position",new e.Float32BufferAttribute(l,3)),n.setAttribute("normal",new e.Float32BufferAttribute(c,3)),n}("string"!=typeof(o=t)?e.LoaderUtils.decodeText(new Uint8Array(o)):o);var o}}}},3866:e=>{e.exports=function(e){e.TrackballControls=function(t,n){const r=this,o=-1;let a,i;void 0!==n?(a=n.ownerDocument.defaultView||n.ownerDocument.parentWindow,this.domElement=n,i=n.ownerDocument):(a=window,this.domElement=a.document,i=a.document),this.object=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.flyMode=!1,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.target=new e.Vector3;const s=1e-10,l=new e.Vector3,c=new e.Vector3;let d=1,p=o,u=o,h=0,m=0,g=0;const f=new e.Vector3,v=new e.Vector2,y=new e.Vector2,b=new e.Vector3,x=new e.Vector2,_=new e.Vector2,w=new e.Vector2,M=new e.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;const C={type:"change"},E={type:"start"},S={type:"end"};this.handleResize=function(){if(this.domElement===i)this.screen.left=0,this.screen.top=0,this.screen.width=a.innerWidth,this.screen.height=a.innerHeight;else{const e=r.domElement.getBoundingClientRect(),t=r.domElement.ownerDocument.documentElement;this.screen.left=e.left+a.pageXOffset-t.clientLeft,this.screen.top=e.top+a.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};const A=function(){const t=new e.Vector2;return function(e,n){return t.set((e-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),t}}(),P=function(){const t=new e.Vector2;return function(e,n){return t.set((e-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),t}}();function D(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(e.preventDefault(),p===o)switch(e.button){case r.mouseButtons.LEFT:p=0;break;case r.mouseButtons.MIDDLE:p=1;break;case r.mouseButtons.RIGHT:p=2;break;default:p=o}const t=u!==o?u:p;0!==t||r.noRotate?1!==t||r.noZoom?2!==t||r.noPan||(w.copy(A(e.pageX,e.pageY)),M.copy(w)):(x.copy(A(e.pageX,e.pageY)),_.copy(x)):(y.copy(P(e.pageX,e.pageY)),v.copy(y)),i.addEventListener("pointermove",z),i.addEventListener("pointerup",T),r.dispatchEvent(E)}(e)}}function z(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(e.preventDefault(),!1===r.enabled)return;const t=u!==o?u:p;0!==t||r.noRotate?1!==t||r.noZoom?2!==t||r.noPan||M.copy(A(e.pageX,e.pageY)):_.copy(A(e.pageX,e.pageY)):(v.copy(y),y.copy(P(e.pageX,e.pageY)))}(e)}}function T(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){e.preventDefault(),!1!==r.enabled&&(p=o,i.removeEventListener("pointermove",z),i.removeEventListener("pointerup",T),r.dispatchEvent(S))}(e)}}function O(e){!1!==r.enabled&&(a.removeEventListener("keydown",O),u!==o||(e.ctrlKey&&!r.noRotate?u=0:e.altKey&&!r.noZoom?u=1:e.shiftKey&&!r.noPan&&(u=2)))}function j(){!1!==r.enabled&&(u=o,a.addEventListener("keydown",O))}function L(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:x.y-=.025*e.deltaY;break;case 1:x.y-=.01*e.deltaY;break;default:x.y-=25e-5*e.deltaY}r.dispatchEvent(E),r.dispatchEvent(S)}}function k(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:p=3,y.copy(P(e.touches[0].pageX,e.touches[0].pageY)),v.copy(y);break;default:{p=4;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;h=Math.sqrt(t*t+n*n),m=h;const r=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;w.copy(A(r,o)),M.copy(w);break}}r.dispatchEvent(E)}}function I(e){if(!1!==r.enabled)switch(e.preventDefault(),e.touches.length){case 1:v.copy(y),y.copy(P(e.touches[0].pageX,e.touches[0].pageY));break;default:{const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;m=Math.sqrt(t*t+n*n);const r=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(A(r,o));break}}}function F(e){if(!1!==r.enabled){switch(e.touches.length){case 0:p=o;break;case 1:p=3,y.copy(P(e.touches[0].pageX,e.touches[0].pageY)),v.copy(y)}r.dispatchEvent(S)}}function V(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=function(){const t=new e.Vector3,n=new e.Quaternion,o=new e.Vector3,a=new e.Vector3,i=new e.Vector3,s=new e.Vector3;return function(){s.set(y.x-v.x,y.y-v.y,0);let e=s.length();e?(f.copy(r.object.position).sub(r.target),o.copy(f).normalize(),a.copy(r.object.up).normalize(),i.crossVectors(a,o).normalize(),a.setLength(y.y-v.y),i.setLength(y.x-v.x),s.copy(a.add(i)),t.crossVectors(s,f).normalize(),e*=r.rotateSpeed,n.setFromAxisAngle(t,e),f.applyQuaternion(n),r.object.up.applyQuaternion(n),b.copy(t),g=e):!r.staticMoving&&g&&(g*=Math.sqrt(1-r.dynamicDampingFactor),f.copy(r.object.position).sub(r.target),n.setFromAxisAngle(b,g),f.applyQuaternion(n),r.object.up.applyQuaternion(n)),v.copy(y)}}(),this.zoomCamera=function(){let e;if(4===p)e=h/m,h=m,r.object.isPerspectiveCamera?f.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom*=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(r.flyMode||2===p||2===u)return;e=1+(_.y-x.y)*r.zoomSpeed,1!==e&&e>0&&(r.object.isPerspectiveCamera?f.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom/=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),r.staticMoving?x.copy(_):x.y+=(_.y-x.y)*r.dynamicDampingFactor}},this.panCamera=function(){const t=new e.Vector3,n=new e.Vector3,o=new e.Vector3,a=new e.Vector3;return function(){if(t.copy(M).sub(w),t.z=0,(r.flyMode||2===p||2===u)&&(t.z=(_.y-x.y)*r.panSpeed*10,r.staticMoving?x.copy(_):x.y+=(_.y-x.y)*r.dynamicDampingFactor),t.lengthSq()){if(r.object.isOrthographicCamera){const e=(r.object.right-r.object.left)/r.object.zoom/r.domElement.clientWidth,n=(r.object.top-r.object.bottom)/r.object.zoom/r.domElement.clientWidth;t.x*=e,t.y*=n}t.multiplyScalar(f.length()*r.panSpeed),a.copy(f).cross(r.object.up).setLength(t.x),a.add(n.copy(r.object.up).setLength(t.y)),a.add(o.copy(f).setLength(t.z)),r.object.position.add(a),r.target.add(a),r.staticMoving?w.copy(M):w.add(t.subVectors(M,w).multiplyScalar(r.dynamicDampingFactor))}}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(f.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,f.setLength(r.maxDistance)),x.copy(_)),f.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,f.setLength(r.minDistance)),x.copy(_)))},this.update=function(){f.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,f),r.object.isPerspectiveCamera?(r.checkDistances(),r.object.lookAt(r.target),(l.distanceToSquared(r.object.position)>s||c.distanceToSquared(r.object.up)>s)&&(l.copy(r.object.position),c.copy(r.object.up),r.dispatchEvent(C))):r.object.isOrthographicCamera?(r.object.lookAt(r.target),(l.distanceToSquared(r.object.position)>s||d!==r.object.zoom)&&(r.dispatchEvent(C),l.copy(r.object.position),d=r.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){p=o,u=o,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),f.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(C),l.copy(r.object.position),c.copy(r.object.up),d=r.object.zoom},this.dispose=function(){r.domElement.removeEventListener("contextmenu",V),r.domElement.removeEventListener("pointerdown",D),r.domElement.removeEventListener("wheel",L),r.domElement.removeEventListener("touchstart",k),r.domElement.removeEventListener("touchend",F),r.domElement.removeEventListener("touchmove",I),i.removeEventListener("pointermove",z),i.removeEventListener("pointerup",T),a.removeEventListener("keydown",O),a.removeEventListener("keyup",j)},this.domElement.addEventListener("contextmenu",V),this.domElement.addEventListener("pointerdown",D),this.domElement.addEventListener("wheel",L,{passive:!1}),this.domElement.addEventListener("touchstart",k,{passive:!1}),this.domElement.addEventListener("touchend",F),this.domElement.addEventListener("touchmove",I,{passive:!1}),this.domElement.ownerDocument.addEventListener("pointermove",z),this.domElement.ownerDocument.addEventListener("pointerup",T),a.addEventListener("keydown",O),a.addEventListener("keyup",j),this.handleResize(),this.update()},e.TrackballControls.prototype=Object.create(e.EventDispatcher.prototype),e.TrackballControls.prototype.constructor=e.TrackballControls}},903:e=>{e.exports=function(e){e.TransformControls=function(t,n){void 0===n&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),e.Object3D.call(this),this.visible=!1,this.domElement=n;const r=new e.TransformControlsGizmo;this.add(r);const o=new e.TransformControlsPlane;this.add(o);const a=this;B("camera",t),B("object",void 0),B("enabled",!0),B("axis",null),B("mode","translate"),B("translationSnap",null),B("rotationSnap",null),B("scaleSnap",null),B("space","world"),B("size",1),B("dragging",!1),B("showX",!0),B("showY",!0),B("showZ",!0);const i={type:"change"},s={type:"mouseDown"},l={type:"mouseUp",mode:a.mode},c={type:"objectChange"},d=new e.Raycaster,p=new e.Vector3,u=new e.Vector3,h=new e.Quaternion,m={X:new e.Vector3(1,0,0),Y:new e.Vector3(0,1,0),Z:new e.Vector3(0,0,1)},g=new e.Vector3,f=new e.Vector3,v=new e.Vector3,y=new e.Vector3,b=new e.Vector3,x=new e.Vector3;let _=0;const w=new e.Vector3,M=new e.Quaternion,C=new e.Vector3,E=new e.Vector3,S=new e.Quaternion,A=new e.Quaternion,P=new e.Vector3,D=new e.Vector3,z=new e.Quaternion,T=new e.Vector3,O=new e.Vector3,j=new e.Quaternion,L=new e.Quaternion,k=new e.Vector3,I=new e.Vector3,F=new e.Vector3,V=new e.Quaternion,R=new e.Vector3;function B(e,t){let n=t;Object.defineProperty(a,e,{get:()=>void 0!==n?n:t,set(t){n!==t&&(n=t,o[e]=t,r[e]=t,a.dispatchEvent({type:`${e}-changed`,value:t}),a.dispatchEvent(i))}}),a[e]=t,o[e]=t,r[e]=t}function N(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};const t=e.changedTouches?e.changedTouches[0]:e,r=n.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}function U(e){a.enabled&&a.pointerHover(N(e))}function W(e){a.enabled&&(document.addEventListener("mousemove",G,!1),a.pointerHover(N(e)),a.pointerDown(N(e)))}function G(e){a.enabled&&a.pointerMove(N(e))}function H(e){a.enabled&&(document.removeEventListener("mousemove",G,!1),a.pointerUp(N(e)))}B("worldPosition",O),B("worldPositionStart",D),B("worldQuaternion",j),B("worldQuaternionStart",z),B("cameraPosition",w),B("cameraQuaternion",M),B("pointStart",g),B("pointEnd",f),B("rotationAxis",y),B("rotationAngle",_),B("eye",I),n.addEventListener("mousedown",W,!1),n.addEventListener("touchstart",W,!1),n.addEventListener("mousemove",U,!1),n.addEventListener("touchmove",U,!1),n.addEventListener("touchmove",G,!1),document.addEventListener("mouseup",H,!1),n.addEventListener("touchend",H,!1),n.addEventListener("touchcancel",H,!1),n.addEventListener("touchleave",H,!1),this.dispose=function(){n.removeEventListener("mousedown",W),n.removeEventListener("touchstart",W),n.removeEventListener("mousemove",U),document.removeEventListener("mousemove",G),n.removeEventListener("touchmove",U),n.removeEventListener("touchmove",G),document.removeEventListener("mouseup",H),n.removeEventListener("touchend",H),n.removeEventListener("touchcancel",H),n.removeEventListener("touchleave",H),this.traverse((e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(E,S,P),this.object.matrixWorld.decompose(O,j,k),A.copy(S).inverse(),L.copy(j).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(w,M,C),I.copy(w).sub(O).normalize(),e.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button)return;d.setFromCamera(e,this.camera);const t=d.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){d.setFromCamera(e,this.camera);const t=d.intersectObjects([o],!0)[0]||!1;if(t){let{space:e}=this;if("scale"===this.mode?e="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(e="world"),"local"===e&&"rotate"===this.mode){const e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),F.copy(this.object.position),V.copy(this.object.quaternion),R.copy(this.object.scale),this.object.matrixWorld.decompose(D,z,T),g.copy(t.point).sub(D)}this.dragging=!0,s.mode=this.mode,this.dispatchEvent(s)}},this.pointerMove=function(e){const{axis:t}=this,{mode:n}=this,{object:r}=this;let{space:a}=this;if("scale"===n?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0===r||null===t||!1===this.dragging||void 0!==e.button&&0!==e.button)return;d.setFromCamera(e,this.camera);const s=d.intersectObjects([o],!0)[0]||!1;if(!1!==s){if(f.copy(s.point).sub(D),"translate"===n)v.copy(f).sub(g),"local"===a&&"XYZ"!==t&&v.applyQuaternion(L),-1===t.indexOf("X")&&(v.x=0),-1===t.indexOf("Y")&&(v.y=0),-1===t.indexOf("Z")&&(v.z=0),"local"===a&&"XYZ"!==t?v.applyQuaternion(V).divide(P):v.applyQuaternion(A).divide(P),r.position.copy(v).add(F),this.translationSnap&&("local"===a&&(r.position.applyQuaternion(h.copy(V).inverse()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(V)),"world"===a&&(r.parent&&r.position.add(p.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(p.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=f.length()/g.length();f.dot(g)<0&&(e*=-1),u.set(e,e,e)}else p.copy(g),u.copy(f),p.applyQuaternion(L),u.applyQuaternion(L),u.divide(p),-1===t.search("X")&&(u.x=1),-1===t.search("Y")&&(u.y=1),-1===t.search("Z")&&(u.z=1);r.scale.copy(R).multiply(u),this.scaleSnap&&(-1!==t.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){v.copy(f).sub(g);const e=20/O.distanceTo(p.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(y.copy(I),_=f.angleTo(g),b.copy(g).normalize(),x.copy(f).normalize(),_*=x.cross(b).dot(I)<0?1:-1):"XYZE"===t?(y.copy(v).cross(I).normalize(),_=v.dot(p.copy(y).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(y.copy(m[t]),p.copy(m[t]),"local"===a&&p.applyQuaternion(j),_=v.dot(p.cross(I).normalize())*e),this.rotationSnap&&(_=Math.round(_/this.rotationSnap)*this.rotationSnap),this.rotationAngle=_,"local"===a&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(V),r.quaternion.multiply(h.setFromAxisAngle(y,_)).normalize()):(y.applyQuaternion(A),r.quaternion.copy(h.setFromAxisAngle(y,_)),r.quaternion.multiply(V).normalize())}this.dispatchEvent(i),this.dispatchEvent(c)}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(l.mode=this.mode,this.dispatchEvent(l)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return a.mode},this.setMode=function(e){a.mode=e},this.setTranslationSnap=function(e){a.translationSnap=e},this.setRotationSnap=function(e){a.rotationSnap=e},this.setScaleSnap=function(e){a.scaleSnap=e},this.setSize=function(e){a.size=e},this.setSpace=function(e){a.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}},e.TransformControls.prototype=Object.assign(Object.create(e.Object3D.prototype),{constructor:e.TransformControls,isTransformControls:!0}),e.TransformControlsGizmo=function(){e.Object3D.call(this),this.type="TransformControlsGizmo";const t=new e.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:e.DoubleSide,fog:!1}),n=new e.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=t.clone();r.opacity=.15;const o=t.clone();o.opacity=.33;const a=t.clone();a.color.set(16711680);const i=t.clone();i.color.set(65280);const s=t.clone();s.color.set(255);const l=t.clone();l.opacity=.25;const c=l.clone();c.color.set(16776960);const d=l.clone();d.color.set(65535);const p=l.clone();p.color.set(16711935),t.clone().color.set(16776960);const u=n.clone();u.color.set(16711680);const h=n.clone();h.color.set(65280);const m=n.clone();m.color.set(255);const g=n.clone();g.color.set(65535);const f=n.clone();f.color.set(16711935);const v=n.clone();v.color.set(16776960);const y=n.clone();y.color.set(7895160);const b=v.clone();b.opacity=.25;const x=new e.CylinderBufferGeometry(0,.05,.2,12,1,!1),_=new e.BoxBufferGeometry(.125,.125,.125),w=new e.BufferGeometry;w.setAttribute("position",new e.Float32BufferAttribute([0,0,0,1,0,0],3));const M=function(t,n){const r=new e.BufferGeometry,o=[];for(let e=0;e<=64*n;++e)o.push(0,Math.cos(e/32*Math.PI)*t,Math.sin(e/32*Math.PI)*t);return r.setAttribute("position",new e.Float32BufferAttribute(o,3)),r},C={X:[[new e.Mesh(x,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new e.Mesh(x,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new e.Line(w,u)]],Y:[[new e.Mesh(x,i),[0,1,0],null,null,"fwd"],[new e.Mesh(x,i),[0,1,0],[Math.PI,0,0],null,"bwd"],[new e.Line(w,h),null,[0,0,Math.PI/2]]],Z:[[new e.Mesh(x,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new e.Mesh(x,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new e.Line(w,m),null,[0,-Math.PI/2,0]]],XYZ:[[new e.Mesh(new e.OctahedronBufferGeometry(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),c.clone()),[.15,.15,0]],[new e.Line(w,v),[.18,.3,0],null,[.125,1,1]],[new e.Line(w,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),d.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new e.Line(w,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new e.Line(w,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new e.Mesh(new e.PlaneBufferGeometry(.295,.295),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new e.Line(w,f),[.18,0,.3],null,[.125,1,1]],[new e.Line(w,f),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},E={X:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new e.Mesh(new e.OctahedronBufferGeometry(.2,0),r)]],XY:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new e.Mesh(new e.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new e.Mesh(new e.OctahedronBufferGeometry(.01,2),o),null,null,null,"helper"]],END:[[new e.Mesh(new e.OctahedronBufferGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new e.Line(function(){const t=new e.BufferGeometry;return t.setAttribute("position",new e.Float32BufferAttribute([0,0,0,1,1,1],3)),t}(),o),null,null,null,"helper"]],X:[[new e.Line(w,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new e.Line(w,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new e.Line(w,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={X:[[new e.Line(M(1,.5),u)],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new e.Line(M(1,.5),h),null,[0,0,-Math.PI/2]],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[3,1,1]]],Z:[[new e.Line(M(1,.5),m),null,[0,Math.PI/2,0]],[new e.Mesh(new e.OctahedronBufferGeometry(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new e.Line(M(1.25,1),b),null,[0,Math.PI/2,0]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new e.Mesh(new e.CylinderBufferGeometry(.03,0,.15,4,1,!1),b),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new e.Line(M(1,1),y),null,[0,Math.PI/2,0]]]},P={AXIS:[[new e.Line(w,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={X:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new e.Mesh(new e.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new e.Mesh(new e.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new e.Mesh(new e.SphereBufferGeometry(.7,10,8),r)]]},z={X:[[new e.Mesh(_,a),[.8,0,0],[0,0,-Math.PI/2]],[new e.Line(w,u),null,null,[.8,1,1]]],Y:[[new e.Mesh(_,i),[0,.8,0]],[new e.Line(w,h),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new e.Mesh(_,s),[0,0,.8],[Math.PI/2,0,0]],[new e.Line(w,m),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new e.Mesh(_,c),[.85,.85,0],null,[2,2,.2]],[new e.Line(w,v),[.855,.98,0],null,[.125,1,1]],[new e.Line(w,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new e.Mesh(_,d),[0,.85,.85],null,[.2,2,2]],[new e.Line(w,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new e.Line(w,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new e.Mesh(_,p),[.85,0,.85],null,[2,.2,2]],[new e.Line(w,f),[.855,0,.98],null,[.125,1,1]],[new e.Line(w,f),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new e.Mesh(new e.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,0,1.1]]]},T={X:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new e.Mesh(new e.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new e.Mesh(_,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new e.Mesh(_,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new e.Mesh(_,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new e.Mesh(new e.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},O={X:[[new e.Line(w,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new e.Line(w,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new e.Line(w,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j=function(t){const n=new e.Object3D;return Object.keys(t).forEach((e=>{for(let r=t[e].length;r--;){const o=t[e][r][0].clone(),a=t[e][r][1],i=t[e][r][2],s=t[e][r][3],l=t[e][r][4];o.name=e,o.tag=l,a&&o.position.set(a[0],a[1],a[2]),i&&o.rotation.set(i[0],i[1],i[2]),s&&o.scale.set(s[0],s[1],s[2]),o.updateMatrix();const c=o.geometry.clone();c.applyMatrix4(o.matrix),o.geometry=c,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),n.add(o)}})),n},L=new e.Vector3(0,0,0),k=new e.Euler,I=new e.Vector3(0,1,0),F=new e.Vector3(0,0,0),V=new e.Matrix4,R=new e.Quaternion,B=new e.Quaternion,N=new e.Quaternion,U=new e.Vector3(1,0,0),W=new e.Vector3(0,1,0),G=new e.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(C)),this.add(this.gizmo.rotate=j(A)),this.add(this.gizmo.scale=j(z)),this.add(this.picker.translate=j(E)),this.add(this.picker.rotate=j(D)),this.add(this.picker.scale=j(T)),this.add(this.helper.translate=j(S)),this.add(this.helper.rotate=j(P)),this.add(this.helper.scale=j(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){let{space:t}=this;"scale"===this.mode&&(t="local");const n="local"===t?this.worldQuaternion:N;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let t=0;t<r.length;t++){const o=r[t];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);const a=this.worldPosition.distanceTo(this.cameraPosition);if(o.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==o.tag){if(o.quaternion.copy(n),"translate"===this.mode||"scale"===this.mode){const e=.99,t=.2,r=0;"X"!==o.name&&"XYZX"!==o.name||Math.abs(I.copy(U).applyQuaternion(n).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"!==o.name&&"XYZY"!==o.name||Math.abs(I.copy(W).applyQuaternion(n).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"!==o.name&&"XYZZ"!==o.name||Math.abs(I.copy(G).applyQuaternion(n).dot(this.eye))>e&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs(I.copy(G).applyQuaternion(n).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs(I.copy(U).applyQuaternion(n).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs(I.copy(W).applyQuaternion(n).dot(this.eye))<t&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),-1!==o.name.search("X")&&(I.copy(U).applyQuaternion(n).dot(this.eye)<r?"fwd"===o.tag?o.visible=!1:o.scale.x*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Y")&&(I.copy(W).applyQuaternion(n).dot(this.eye)<r?"fwd"===o.tag?o.visible=!1:o.scale.y*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Z")&&(I.copy(G).applyQuaternion(n).dot(this.eye)<r?"fwd"===o.tag?o.visible=!1:o.scale.z*=-1:"bwd"===o.tag&&(o.visible=!1))}else"rotate"===this.mode&&(B.copy(n),I.copy(this.eye).applyQuaternion(R.copy(n).inverse()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix(V.lookAt(this.eye,F,W)),"X"===o.name&&(R.setFromAxisAngle(U,Math.atan2(-I.y,I.z)),R.multiplyQuaternions(B,R),o.quaternion.copy(R)),"Y"===o.name&&(R.setFromAxisAngle(W,Math.atan2(I.x,I.z)),R.multiplyQuaternions(B,R),o.quaternion.copy(R)),"Z"===o.name&&(R.setFromAxisAngle(G,Math.atan2(I.y,I.x)),R.multiplyQuaternions(B,R),o.quaternion.copy(R)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._opacity=o.material._opacity||o.material.opacity,o.material._color=o.material._color||o.material.color.clone(),o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled?this.axis&&(o.name===this.axis||this.axis.split("").some((e=>o.name===e))?(o.material.opacity=1,o.material.color.lerp(new e.Color(1,1,1),.5)):(o.material.opacity*=.25,o.material.color.lerp(new e.Color(1,1,1),.5))):(o.material.opacity*=.5,o.material.color.lerp(new e.Color(1,1,1),.5))}else o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&(R.setFromEuler(k.set(0,0,0)),o.quaternion.copy(n).multiply(R),Math.abs(I.copy(U).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),"Y"===this.axis&&(R.setFromEuler(k.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(R),Math.abs(I.copy(W).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),"Z"===this.axis&&(R.setFromEuler(k.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(R),Math.abs(I.copy(G).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),"XYZE"===this.axis&&(R.setFromEuler(k.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(V.lookAt(F,I,W)),o.quaternion.multiply(R),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),L.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),L.applyQuaternion(this.worldQuaternionStart.clone().inverse()),o.scale.copy(L),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)))}e.Object3D.prototype.updateMatrixWorld.call(this)}},e.TransformControlsGizmo.prototype=Object.assign(Object.create(e.Object3D.prototype),{constructor:e.TransformControlsGizmo,isTransformControlsGizmo:!0}),e.TransformControlsPlane=function(){e.Mesh.call(this,new e.PlaneBufferGeometry(1e5,1e5,2,2),new e.MeshBasicMaterial({visible:!1,wireframe:!0,side:e.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";const t=new e.Vector3(1,0,0),n=new e.Vector3(0,1,0),r=new e.Vector3(0,0,1),o=new e.Vector3,a=new e.Vector3,i=new e.Vector3,s=new e.Matrix4,l=new e.Quaternion;this.updateMatrixWorld=function(){let{space:c}=this;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(c="local"),t.set(1,0,0).applyQuaternion("local"===c?this.worldQuaternion:l),n.set(0,1,0).applyQuaternion("local"===c?this.worldQuaternion:l),r.set(0,0,1).applyQuaternion("local"===c?this.worldQuaternion:l),i.copy(n),this.mode){case"translate":case"scale":switch(this.axis){case"X":i.copy(this.eye).cross(t),a.copy(t).cross(i);break;case"Y":i.copy(this.eye).cross(n),a.copy(n).cross(i);break;case"Z":i.copy(this.eye).cross(r),a.copy(r).cross(i);break;case"XY":a.copy(r);break;case"YZ":a.copy(t);break;case"XZ":i.copy(r),a.copy(n);break;case"XYZ":case"E":a.set(0,0,0)}break;case"rotate":default:a.set(0,0,0)}0===a.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(o.set(0,0,0),a,i),this.quaternion.setFromRotationMatrix(s)),e.Object3D.prototype.updateMatrixWorld.call(this)}},e.TransformControlsPlane.prototype=Object.assign(Object.create(e.Mesh.prototype),{constructor:e.TransformControlsPlane,isTransformControlsPlane:!0})}},2976:(e,t,n)=>{const r=n(6788),o=n(5735),a=n(2460)(r),i=n(7290),s=n(2960),l=n(9034),c=n(5321);function d(e,t,n,o){const i=new r.BufferGeometry,s=new r.Object3D,l=t.wireframe?r.MeshBasicMaterial:r.MeshPhongMaterial;let c,d,p;return s.position.set(o.offset[0]/n.width,o.offset[1]/n.height,o.offset[2]/n.length),s.updateMatrix(),i.setAttribute("position",new r.BufferAttribute(new Float32Array(o.vertices),3)),i.setAttribute("color",new r.BufferAttribute(new Float32Array(o.colors),3)),i.computeBoundingSphere(),i.computeBoundingBox(),s.add(new r.Mesh(i,new l({vertexColors:r.VertexColors,flatShading:!0,opacity:t.opacity,depthWrite:1===t.opacity,transparent:1!==t.opacity,side:r.DoubleSide,wireframe:t.wireframe}))),t.outlines&&!t.wireframe&&(c=(new r.Matrix4).fromArray(t.model_matrix.data).getMaxScaleOnAxis()/(10*Math.max(n.width,n.height,n.length)),d=new a.MeshLine,p=new a.MeshLineMaterial({color:new r.Color(t.outlines_color),opacity:.75*t.opacity,sizeAttenuation:!0,depthWrite:!1,transparent:!0,lineWidth:c,resolution:new r.Vector2(e.getWorld().width,e.getWorld().height),side:r.DoubleSide}),p.userData={outline:!0},d.setGeometry(new Float32Array(o.outlines),!0),d.geometry.computeBoundingSphere(),d.geometry.computeBoundingBox(),s.add(new r.Mesh(d.geometry,p))),s}e.exports={create(e,t,n,a){const p=new Set;return new Promise((u=>{let h;const m=new r.Group;let g;const f=new r.Mesh(new r.BoxGeometry(1.2/n[0],1.2/n[1],1.2/n[2]).translate(.5/n[0],.5/n[1],.5/n[2]),new r.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0})),{colorsToFloat32Array:v}=c;let y,b;e.opacity=void 0!==e.opacity?e.opacity:1,e.visible=void 0===e.visible||e.visible,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.outlines=void 0===e.outlines||e.outlines,e.outlines_color=void 0!==e.outlines_color?e.outlines_color:0;const x=(new r.Matrix4).fromArray(e.model_matrix.data);h=e.color_map.data||[16711680,65280,255,16776960,16711935,65535],h=v(h),m.holdRemeshing=e._hold_remeshing||!1,m.voxelSize={width:n[0],height:n[1],length:n[2]},m.rebuildChunk=function(){!function(e,t){const n={};console.log(`K3D.Voxels rebuildChunk Count:${t.size}`),e.children.forEach((e=>{e.voxel&&(n[e.voxel.chunk.id]=e)})),t.forEach((e=>{const t=n[e];let r;if(t){r=t.voxel.getVoxelChunkObject(t.voxel.generate());for(let e=0;e<t.children.length;e++)t.children[e].geometry.dispose(),t.children[e].geometry=r.children[e].geometry}})),t.clear()}(m,p),a.render()},m.updateChunk=function(e,t){m.children.some((n=>!(!n.voxel||n.voxel.chunk.id!==e.id||(n.voxel.chunk.voxels.data=e.voxels.data,p.add(e.id),t||n.voxel.chunk.voxels.neighbours.forEach((e=>{p.add(e.id)})),m.holdRemeshing||m.rebuildChunk(),0))))},m.voxelsChunks=t,m.addChunk=function(t){const n=s.initializeGreedyVoxelMesh(t,h,m.voxelSize,e.outlines,e.opacity<1);let r;return r=m.holdRemeshing?{offset:t.offset,vertices:[],colors:[],outlines:[]}:n(),g=d(a,e,m.voxelSize,r),g.voxel={generate:n,chunk:t,getVoxelChunkObject:d.bind(this,a,e,m.voxelSize)},r.vertices.length>0&&(g.children[0].geometry.boundsTree=new o.MeshBVH(g.children[0].geometry)),g.children[0].interactions=l(m,g,f,a),m.add(g),g},i(t.length,20,(e=>{m.addChunk(t[e])}),(()=>{m.position.set(-.5,-.5,-.5),m.initialPosition=m.position.clone(),m.updateMatrix(),x.set.apply(x,e.model_matrix.data),m.applyMatrix4(x),f.visible=!1,f.geometry.computeBoundingSphere(),f.geometry.computeBoundingBox(),m.add(f),m.updateMatrixWorld(),y=a.on(a.events.VIEW_MODE_CHANGE,(()=>{f.visible=!1})),b=a.on(a.events.RESIZED,(()=>{m.children.forEach((e=>{e.children[1]&&(e.children[1].material.uniforms.resolution.value.x=a.getWorld().width,e.children[1].material.uniforms.resolution.value.y=a.getWorld().height)}))})),m.onRemove=function(){a.off(a.events.VIEW_MODE_CHANGE,y),a.off(a.events.RESIZED,b)},u(m)}))}))},generateRegularChunks(e,t,n){const r=[],o=Math.ceil(t[2]/e),a=Math.ceil(t[1]/e),i=Math.ceil(t[0]/e);let s,l,c,d;for(s=0,d=0;s<o;s++)for(l=0;l<a;l++)for(c=0;c<i;c++,d++)r.push({voxels:n,size:[t[2]-(s+1)*e>0?e:t[2]-s*e,t[1]-(l+1)*e>0?e:t[1]-l*e,t[0]-(c+1)*e>0?e:t[0]-c*e],offset:[s*e,l*e,c*e],multiple:1,idx:d});return r}}},8175:(e,t,n)=>{const r=n(6788),{cameraModes:o}=n(7996),{recalculateFrustum:a}=n(9724);e.exports=function(e){this.camera=new r.PerspectiveCamera(e.parameters.camera_fov,this.width/this.height,.1,1e3),this.camera.position.set(2,-3,.2),this.camera.up.set(0,0,1),this.camera.frustum=new r.Frustum,this.axesHelper.camera=new r.PerspectiveCamera(e.parameters.camera_fov,this.axesHelper.width/this.axesHelper.height,.1,1e3),this.axesHelper.camera.position.set(2,.5,.5),this.axesHelper.camera.lookAt(.5,.5,.5),this.axesHelper.camera.up.copy(this.camera.up),this.setupCamera=function(e,t){t&&void 0!==this.camera.fov&&void 0!==this.axesHelper.camera.fov&&(this.camera.fov=t,this.axesHelper.camera.fov=t,this.controls.dispatchEvent({type:"change"})),e&&(this.controls.object.position.fromArray(e),9===e.length&&this.controls.object.up.fromArray(e,6),this.controls.target.fromArray(e,3)),this.camera.updateProjectionMatrix(),this.axesHelper.camera.updateProjectionMatrix(),a(this.camera),this.controls.update(!0)},this.setCameraToFitScene=function(t,n){let a=(new r.Box3).setFromArray(e.parameters.grid);if(!e.parameters.cameraAutoFit&&!t)return;this.K3DObjects.children.length>0&&(a=e.getSceneBoundingBox()||a),void 0===n&&(n=1.5);const i=a.getBoundingSphere(new r.Sphere),s=i.radius*n/Math.sin(r.Math.degToRad(e.parameters.camera_fov/2));this.camera.position.subVectors(i.center,this.camera.getWorldDirection(new r.Vector3).setLength(s)),e.parameters.cameraMode===o.fly?this.controls.target=this.camera.position.clone().add(this.camera.getWorldDirection(new r.Vector3).setLength(s/2)):this.controls.target=i.center,this.controls.update(!0)}}},2794:(e,t,n)=>{const r=n(6788),{cameraModes:o}=n(7996),{recalculateFrustum:a}=n(9724);function i(e,t,n){n.getCameraArray=function(){const t=[];return e.controls.object.position.toArray(t),e.controls.target.toArray(t,3),e.controls.object.up.toArray(t,6),t},n.addEventListener("change",(n=>{const o=n.target.getCameraArray();a(e.camera),t.dispatch(t.events.CAMERA_CHANGE,o);const i=1.5/Math.tan(r.Math.degToRad(t.parameters.camera_fov/2));e.axesHelper.camera.position.copy(e.camera.position.clone().sub(e.controls.target).normalize().multiplyScalar(i)),e.axesHelper.camera.lookAt(0,0,0),e.axesHelper.camera.up.copy(e.camera.up)})),n.addEventListener("change",(()=>{0===t.frameUpdateHandlers.before.length&&0===t.frameUpdateHandlers.after.length&&e.render()}))}function s(e,t){return t.parameters.cameraMode===o.trackball?function(e,t){const n=new r.TrackballControls(e.camera,e.renderer.domElement);return n.type=o.trackball,n.rotateSpeed=t.parameters.cameraRotateSpeed,n.zoomSpeed=t.parameters.cameraZoomSpeed,n.panSpeed=t.parameters.cameraPanSpeed,t.parameters.cameraDampingFactor>0?(n.staticMoving=!1,n.dynamicDampingFactor=t.parameters.cameraDampingFactor):n.staticMoving=!0,i(e,t,n),n}(e,t):t.parameters.cameraMode===o.orbit?function(e,t){const n=new r.OrbitControls(e.camera,e.renderer.domElement);return n.type=o.orbit,n.rotateSpeed=t.parameters.cameraRotateSpeed,t.parameters.cameraDampingFactor>0?(n.enableDamping=!0,n.dampingFactor=t.parameters.cameraDampingFactor):n.enableDamping=!1,n.screenSpacePanning=!1,n.maxPolarAngle=Math.PI,n.screenSpacePanning=!0,i(e,t,n),n}(e,t):t.parameters.cameraMode===o.fly?function(e,t){const n=new r.TrackballControls(e.camera,e.renderer.domElement);return n.type=o.fly,n.rotateSpeed=t.parameters.cameraRotateSpeed,n.zoomSpeed=t.parameters.cameraZoomSpeed,n.panSpeed=t.parameters.cameraPanSpeed,n.flyMode=!0,t.parameters.cameraDampingFactor>0?(n.staticMoving=!1,n.dynamicDampingFactor=t.parameters.cameraDampingFactor):n.staticMoving=!0,i(e,t,n),n}(e,t):null}e.exports=function(e){const t=this;let n;function r(t){return{x:t.offsetX/e.getWorld().targetDOMNode.offsetWidth*2-1,y:-t.offsetY/e.getWorld().targetDOMNode.offsetHeight*2+1}}function o(e){n=r(e)}function a(t){const o=r(t);n.x===o.x&&n.y===o.y&&e.dispatch(e.events.MOUSE_CLICK,o)}function i(t){e.dispatch(e.events.MOUSE_MOVE,r(t))}this.renderer.setSize(this.width,this.height),this.targetDOMNode.appendChild(this.renderer.domElement),this.renderer.domElement.addEventListener("pointermove",i,!1),this.renderer.domElement.addEventListener("pointerdown",o,!1),this.renderer.domElement.addEventListener("pointerup",a,!1),this.controls=s(t,e),e.on(e.events.RESIZED,(()=>{t.controls.handleResize&&t.controls.handleResize()})),this.changeControls=function(n){(t.controls.type!==e.parameters.cameraMode||n)&&(t.controls&&t.controls.dispose(),t.controls=s(t,e))},function n(){const{targetDOMNode:r}=e.getWorld();if(r.ownerDocument.contains(r)||e.disable(),e.disabling)return t.renderer.domElement.removeEventListener("pointermove",i),t.renderer.domElement.removeEventListener("pointerdown",o),t.renderer.domElement.removeEventListener("pointerup",a),void t.controls.dispose();t.controls.update(),requestAnimationFrame(n)}()}},6615:(e,t,n)=>{const r=n(6788),{viewModes:o}=n(7861);e.exports=function(e){const t=e.getWorld();let n=!1;e.on(e.events.VIEW_MODE_CHANGE,(a=>{a===o.manipulate?t.K3DObjects.children.forEach((o=>{if(!o.transformControls&&t.ObjectsListJson[o.K3DIdentifier].model_matrix){const a=new r.TransformControls(t.camera,t.renderer.domElement);a.addEventListener("change",(()=>{t.render()})),a.addEventListener("dragging-changed",(e=>{t.controls.enabled=!e.value,!1===n&&e.value&&(n=!0,t.K3DObjects.children.forEach((t=>{t.transformControls&&t.transformControls!==e.target&&(t.transformControls.enabled=!1)}))),!0!==n||e.value||(n=!1,t.K3DObjects.children.forEach((e=>{e.transformControls&&(e.transformControls.enabled=!0)})))})),a.setMode(e.parameters.manipulateMode),t.scene.add(a),a.attach(o),o.transformControls=a}})):t.K3DObjects.children.forEach((e=>{e.transformControls&&(e.transformControls.detach(),e.transformControls.dispose(),delete e.transformControls)}))})),e.on(e.events.MANIPULATE_MODE_CHANGE,(e=>{t.K3DObjects.children.forEach((t=>{t.transformControls&&-1!==["translate","rotate","scale"].indexOf(e)&&t.transformControls.setMode(e)}))}))}},5567:(e,t,n)=>{const r=n(6788),{error:o}=n(6482),a=n(6841);function i(e,t,n){n.call(e),n.callOnce&&e.removeFrameUpdateListener(t,n)}e.exports=function(e){const t=this;let n=null;const s=document.createElement("canvas"),l=s.getContext("webgl2",{antialias:e.parameters.antialias>0,preserveDrawingBuffer:!0,alpha:!0,powerPreference:"high-performance"});function c(t){t.preventDefault(),e.disable(),o("WEBGL Error","Context lost.",!1)}t.renderer=new r.WebGLRenderer({alpha:!0,antialias:e.parameters.antialias>0,canvas:s,context:l}),s.addEventListener("webglcontextlost",c,!1),t.renderer.removeContextLossListener=function(){s.removeEventListener("webglcontextlost",c)};const d=t.renderer.getContext(),p=d.getExtension("WEBGL_debug_renderer_info");function u(e,n,r){void 0===r&&(r=null),t.renderer.setRenderTarget(r),t.renderer.render(e,n)}function h(){const n=u;return new Promise((o=>{if(e.disabling)return null;const a=new r.Vector2;t.renderer.getSize(a),e.frameUpdateHandlers.before.forEach(i.bind(null,e,"before")),e.refreshGrid(),t.renderer.clippingPlanes=[],t.camera.updateMatrixWorld(),t.renderer.clear(),t.renderer.render(t.gridScene,t.camera),t.renderer.setViewport(a.x-t.axesHelper.width,0,t.axesHelper.width,t.axesHelper.height),t.renderer.render(t.axesHelper.scene,t.axesHelper.camera),t.renderer.setViewport(0,0,a.x,a.y),e.parameters.clippingPlanes.forEach((e=>{t.renderer.clippingPlanes.push(new r.Plane((new r.Vector3).fromArray(e),e[3]))})),e.dispatch(e.events.BEFORE_RENDER);let s=Promise.resolve();const l=t.controls.enabled;return function(r,o,i,l){const c=[];if(e.parameters.renderingSteps>1){const t=i/e.parameters.renderingSteps;for(let n=0;n<e.parameters.renderingSteps;n++){const e=Math.round(n*t),r=Math.min(Math.round((n+1)*t),i);c.push([e,r-e])}}e.parameters.renderingSteps>1?(t.controls.enabled=!1,t.controls.beforeRender&&(s=s.then((()=>{t.controls.beforeRender()}))),c.forEach((e=>{s=s.then((()=>{t.renderer.setViewport(0+e[0],0,e[1],l),t.camera.setViewOffset(a.x,a.y,e[0],0,e[1],a.y),n(t.scene,t.camera)})),s=s.then((()=>new Promise((e=>{setTimeout(e,50)}))))})),t.controls.afterRender&&(s=s.then((()=>{t.controls.afterRender()})))):s=s.then((()=>{t.controls.beforeRender&&t.controls.beforeRender(),t.renderer.setViewport(0,0,i,l),n(t.scene,t.camera),t.controls.afterRender&&t.controls.afterRender()}))}(0,0,a.x,a.y),s=s.then((()=>{t.controls.enabled=l,t.renderer.setViewport(0,0,a.x,a.y),t.camera.clearViewOffset(),e.frameUpdateHandlers.after.forEach(i.bind(null,e,"after")),e.dispatch(e.events.RENDERED),e.autoRendering?requestAnimationFrame(h):o(!0)})),null}))}console.log("K3D: (UNMASKED_VENDOR_WEBGL)",d.getParameter(p.UNMASKED_VENDOR_WEBGL)),console.log("K3D: (UNMASKED_RENDERER_WEBGL)",d.getParameter(p.UNMASKED_RENDERER_WEBGL)),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,this.render=function(t){if(e.labels=[],!e.autoRendering||t){if(null===n)return n=h().then((()=>{n=null})),n;t&&(n=n.then(h).then((()=>{n=null})))}return null},this.renderOffScreen=function(n,o){const i=[],s=Math.max(Math.min(128,e.parameters.renderingSteps),1),l=Math.max(Math.min(5,e.parameters.antialias),0),c=u,d=o/s,p=new r.Vector2;t.renderer.getSize(p);const h=Math.max(n/p.x,o/p.y);for(let e=0;e<s;e++){const t=Math.round(e*d),n=Math.min(Math.round((e+1)*d),o);i.push([t,n-t])}const m=new r.WebGLRenderTarget(n,Math.ceil(o/s),{type:r.FloatType}),g=new r.WebGLRenderTarget(t.axesHelper.width*h,t.axesHelper.height*h,{type:r.FloatType});return t.renderer.clippingPlanes=[],a(t.renderer,t.axesHelper.scene,t.axesHelper.camera,g,g.width,g.height,[[0,g.height]],l,u).then((s=>{const d=new Uint8ClampedArray(n*o*4);for(let e=0;e<g.height;e++)d.set(s.slice(e*g.width*4,(e+1)*g.width*4),4*(e*n+n-g.width));return a(t.renderer,t.gridScene,t.camera,m,n,o,[[0,o]],l,u).then((s=>(e.parameters.clippingPlanes.forEach((e=>{t.renderer.clippingPlanes.push(new r.Plane((new r.Vector3).fromArray(e),e[3]))})),a(t.renderer,t.scene,t.camera,m,n,o,i,l,c).then((e=>(m.dispose(),[d,s,e]))))))}))}}},404:(e,t,n)=>{const r=n(6788),o=n(5843),a=n(2932),i=n(860),s=n(2460)(r),{viewModes:l}=n(7861),{pow10ceil:c}=n(984);let d=null;function p(){const e=new r.Box3;let t;return this.K3DObjects.traverse((n=>{let r=!1,o=n;for(;o.parent;){if(o.K3DIdentifier){r=!0;break}o=o.parent}if(r&&void 0!==n.position.z&&(n.geometry||n.boundingBox)){if(n.geometry&&n.geometry.boundingBox)t=n.geometry.boundingBox.clone();else{if(!n.boundingBox)return void console.log("Object without bbox");t=n.boundingBox.clone()}t.applyMatrix4(n.matrixWorld),e.union(t)}})),e.isEmpty()?null:e}function u(e){return{"-x+z":[new r.Vector3(e.min.x,e.min.y,e.max.z),new r.Vector3(e.min.x,e.max.y,e.max.z)],"+y+z":[new r.Vector3(e.min.x,e.max.y,e.max.z),e.max],"+x+z":[new r.Vector3(e.max.x,e.min.y,e.max.z),e.max],"-y+z":[new r.Vector3(e.min.x,e.min.y,e.max.z),new r.Vector3(e.max.x,e.min.y,e.max.z)],"-x-z":[e.min,new r.Vector3(e.min.x,e.max.y,e.min.z)],"+y-z":[new r.Vector3(e.min.x,e.max.y,e.min.z),new r.Vector3(e.max.x,e.max.y,e.min.z)],"+x-z":[new r.Vector3(e.max.x,e.min.y,e.min.z),new r.Vector3(e.max.x,e.max.y,e.min.z)],"-y-z":[e.min,new r.Vector3(e.max.x,e.min.y,e.min.z)],"-x+y":[new r.Vector3(e.min.x,e.max.y,e.min.z),new r.Vector3(e.min.x,e.max.y,e.max.z)],"-x-y":[e.min,new r.Vector3(e.min.x,e.min.y,e.max.z)],"+x+y":[new r.Vector3(e.max.x,e.max.y,e.min.z),e.max],"+x-y":[new r.Vector3(e.max.x,e.min.y,e.min.z),new r.Vector3(e.max.x,e.min.y,e.max.z)]}}function h(e,t){Object.keys(e.planes).forEach((n=>{e.planes[n].forEach((e=>{t.remove(e.obj),delete e.obj}))})),Object.keys(e.labelsOnEdges).forEach((t=>{e.labelsOnEdges[t].labels.forEach((e=>{e.onRemove()}))}))}function m(e,t,n,l){const p=this;if(d)return Promise.all(d).then((()=>m.bind(p)(e,t,n,l)));const g=[];let f,v,y,b,x,_,w,M=(new r.Box3).setFromArray(e.parameters.grid);const C={x:new r.Vector3(1,0,0),y:new r.Vector3(0,1,0),z:new r.Vector3(0,0,1)},E=new r.Color(e.parameters.gridColor),S=new r.Color(e.parameters.labelColor);v=!e.parameters.axesHelper||e.parameters.axesHelper&&!n.x,n.x&&!v&&(v|=e.parameters.axes[0]!==n.x.text||e.parameters.axes[1]!==n.y.text||e.parameters.axes[2]!==n.z.text),v&&(["x","y","z"].forEach((e=>{n[e]&&(n[e].onRemove(),n.scene.remove(n[e]),n[e]=null)})),n.arrows&&(n.scene.remove(n.arrows),n.arrows=null)),v&&(e.parameters.axesHelper>1?(n.width=e.parameters.axesHelper,n.height=e.parameters.axesHelper):e.parameters.axesHelper>0&&(n.width=100,n.height=100),e.parameters.axesHelper>0&&function(e,t){const n=[],o=16711680,s={x:[1,0,0],y:[0,1,0],z:[0,0,1]},l={x:0,y:1,z:2},c=new r.Color(e.parameters.labelColor);["x","y","z"].forEach((o=>{const i=a.create({position:(new r.Vector3).fromArray(s[o]).multiplyScalar(1.1).toArray(),reference_point:"cc",color:c,text:e.parameters.axes[l[o]],size:.75},e,t);n.push(i.then((e=>{t[o]=e,t.scene.add(e)})))}));const d=i.create({colors:{data:[o,o,255,255,65280,65280]},origins:{data:[0,0,0,0,0,0,0,0,0]},vectors:{data:[].concat(s.x,s.y,s.z)},line_width:.05,head_size:2.5},e);return n.push(d.then((e=>{t.arrows=e,t.scene.add(e)}))),n}(e,n).forEach((e=>{g.push(e)}))),(e.parameters.gridAutoFit||l)&&(M=e.getSceneBoundingBox()||M,h(t,this.gridScene),b=M.getSize(new r.Vector3),x=c(Math.max(b.x,b.y,b.z))/10,_=x/10,function(e,t){const n=e.getSize(new r.Vector3);["x","y","z"].forEach((r=>{const o=n[r]/t;o<=2&&(e.min[r]-=(1-o/2+1e-4)*t,e.max[r]+=(1-o/2+1e-4)*t)}))}(M,x),M.min=new r.Vector3(Math.floor(M.min.x/x)*x,Math.floor(M.min.y/x)*x,Math.floor(M.min.z/x)*x),M.max=new r.Vector3(Math.ceil(M.max.x/x)*x,Math.ceil(M.max.y/x)*x,Math.ceil(M.max.z/x)*x),b=M.getSize(new r.Vector3),t.planes={x:[{normal:new r.Vector3(-1,0,0),p1:new r.Vector3(M.max.x,M.min.y,M.min.z),p2:M.max},{normal:new r.Vector3(1,0,0),p1:M.min,p2:new r.Vector3(M.min.x,M.max.y,M.max.z)}],y:[{normal:new r.Vector3(0,-1,0),p1:new r.Vector3(M.min.x,M.max.y,M.min.z),p2:M.max},{normal:new r.Vector3(0,1,0),p1:M.min,p2:new r.Vector3(M.max.x,M.min.y,M.max.z)}],z:[{normal:new r.Vector3(0,0,-1),p1:new r.Vector3(M.min.x,M.min.y,M.max.z),p2:M.max},{normal:new r.Vector3(0,0,1),p1:M.min,p2:new r.Vector3(M.max.x,M.max.y,M.min.z)}]},w=M.clone().expandByScalar(.15*x),f=u(M),y=u(w),Object.keys(f).forEach((e=>{t.labelsOnEdges[e]={},t.labelsOnEdges[e].v=f[e],t.labelsOnEdges[e].p=y[e],t.labelsOnEdges[e].labels=[]})),Object.keys(t.labelsOnEdges).forEach((n=>{const i=o.difference(["x","y","z"],n.replace(/[^xyz]/g,"").split(""))[0],s=b[i]/x,l=C[i].clone().multiplyScalar(x),c=C[i].clone().multiplyScalar(t.labelsOnEdges[n].p[0].distanceTo(t.labelsOnEdges[n].p[1])/s);let d,p,u,h;for(d=1;d<=s-1;d++)p=t.labelsOnEdges[n].v[0].clone().add(l.clone().multiplyScalar(d)),u=t.labelsOnEdges[n].p[0].clone().add(c.clone().multiplyScalar(d)),h=a.create({position:u.toArray(),reference_point:"cc",color:S,text:parseFloat(p[i].toFixed(15)).toString(),size:.75},e),g.push(h.then((e=>{t.labelsOnEdges[n].labels.push(e)})));const m=t.labelsOnEdges[n].v[0].clone().add((new r.Vector3).subVectors(t.labelsOnEdges[n].v[1],t.labelsOnEdges[n].v[0]).multiplyScalar(.5)),f=t.labelsOnEdges[n].p[0].clone().add((new r.Vector3).subVectors(t.labelsOnEdges[n].p[1],t.labelsOnEdges[n].p[0]).multiplyScalar(.5)),v=f.add((new r.Vector3).subVectors(f,m).multiplyScalar(2));a.create({position:v.toArray(),reference_point:"cc",color:S,text:e.parameters.axes[["x","y","z"].indexOf(i)],size:1},e).then((e=>{t.labelsOnEdges[n].labels.push(e)}))})),Object.keys(t.planes).forEach((function(n){t.planes[n].forEach((function(t){let o=[];const a=[],i=[],l=["x","y","z"].filter((e=>e!==n)),c=new s.MeshLine,d=new s.MeshLineMaterial({color:new r.Color(1,1,1),opacity:.75,sizeAttenuation:!0,transparent:!0,lineWidth:.05*_,resolution:new r.Vector2(e.getWorld().width,e.getWorld().height),side:r.DoubleSide});l.forEach((e=>{const n=C[e].clone().multiplyScalar(_);let r,s,l;for(l=0;l<=b[e]/_;l++)r=t.p1.clone().add(n.clone().multiplyScalar(l)),o=o.concat(r.toArray()),s=t.p2.clone(),s[e]=r[e],o=o.concat(s.toArray()),l%10==0?(a.push(1.5,1.5),i.push(.72*E.r,.72*E.g,.72*E.b),i.push(.72*E.r,.72*E.g,.72*E.b)):(a.push(1,1),i.push(E.r,E.g,E.b),i.push(E.r,E.g,E.b))}),this),c.setGeometry(new Float32Array(o),!0,a,i),c.geometry.computeBoundingSphere(),c.geometry.computeBoundingBox(),t.obj=new r.Mesh(c.geometry,d),this.gridScene.add(t.obj)}),this)}),this));const A=M.clone();Object.keys(t.planes).forEach((function(e){t.planes[e].forEach((e=>{A.union(e.obj.geometry.boundingBox.clone())}),this)}),this);const P=A.getSize(new r.Vector3).length(),D=P/2/Math.sin(r.Math.degToRad(e.parameters.camera_fov/2));return this.camera.far=5*(D+P/2),this.camera.near=1e-4*P,this.camera.updateProjectionMatrix(),d=g,Promise.all(g).then((e=>(d=null,e)))}function g(e,t){const n=[],a=new r.Vector3;this.camera.getWorldDirection(a),Object.keys(t.planes).forEach((r=>{const o=t.planes[r][0].normal.dot(a),i=t.planes[r][1].normal.dot(a);t.planes[r][0].obj.visible=o<=i&&e.parameters.gridVisible,t.planes[r][1].obj.visible=o>i&&e.parameters.gridVisible,t.planes[r][0].obj.visible&&n.push(`+${r}`),t.planes[r][1].obj.visible&&n.push(`-${r}`)}),this),Object.keys(t.labelsOnEdges).forEach((r=>{const a=r.match(/.{2}/g),i=1===o.intersection(a,n).length;t.labelsOnEdges[r].labels.forEach((t=>{i&&e.parameters.gridVisible?t.show():t.hide()}))}))}function f(e,t,n,o,a,i){const s=[];let l,c=!1;return this.raycaster.setFromCamera(new r.Vector2(t,n),o),this.K3DObjects.traverse((e=>{e.interactions&&s.push(e)})),s.length>0&&(l=this.raycaster.intersectObjects(s),l.length>0?(l=l[0],e.getWorld().targetDOMNode.style.cursor="pointer",l.object.interactions&&l.object.interactions.onHover&&(c|=l.object.interactions.onHover(l,i)),a&&l.object.interactions&&l.object.interactions.onClick&&(c|=l.object.interactions.onClick(l,i))):e.getWorld().targetDOMNode.style.cursor="auto"),c}e.exports={Init(e){const t=new r.AmbientLight(16777215),n={planes:{},labelsOnEdges:{}},o=this;this.lights=[],this.raycaster=new r.Raycaster,this.raycaster.firstHitOnly=!0,this.keyLight=new r.DirectionalLight(16777215),this.headLight=new r.DirectionalLight(16777215),this.fillLight=new r.DirectionalLight(16777215),this.backLight=new r.DirectionalLight(16777215),this.keyLight.position.set(.25,1,1),this.headLight.position.set(0,0,1),this.fillLight.position.set(-.25,-1,1),this.backLight.position.set(-2.5,.4,-1),this.scene=new r.Scene,this.gridScene=new r.Scene,this.axesHelper.scene=new r.Scene,this.K3DObjects=new r.Group,[this.keyLight,this.headLight,this.fillLight,this.backLight].forEach((e=>{o.camera.add(e),o.camera.add(e.target)})),this.scene.add(t),this.scene.add(this.camera),this.scene.add(this.K3DObjects),this.cleanup=h.bind(this,n,this.gridScene),e.rebuildSceneData=m.bind(this,e,n,this.axesHelper),e.getSceneBoundingBox=p.bind(this),e.refreshGrid=g.bind(this,e,n),e.rebuildSceneData().then((()=>{e.refreshGrid(),e.render()})),this.recalculateLights=function(e){t.intensity=e<=1?1-.8*e:.2,o.keyLight.intensity=.4*e,o.headLight.intensity=.15*e,o.fillLight.intensity=.15*e,o.backLight.intensity=.1*e,o.backLight.visible=e>0,o.headLight.visible=e>0,o.fillLight.visible=e>0,o.backLight.visible=e>0},e.on(e.events.MOUSE_MOVE,(t=>{e.parameters.viewMode!==l.view&&f.call(o,e,t.x,t.y,o.camera,!1,e.parameters.viewMode)&&!e.autoRendering&&e.render()})),e.on(e.events.MOUSE_CLICK,(t=>{e.parameters.viewMode!==l.view&&f.call(o,e,t.x,t.y,o.camera,!0,e.parameters.viewMode)&&!e.autoRendering&&e.render()})),e.on(e.events.RESIZED,(function(){Object.keys(n.planes).forEach((function(t){n.planes[t].forEach((t=>{const n=t.obj.material.uniforms.resolution;n.value.x=e.getWorld().width,n.value.y=e.getWorld().height}),this)}),this)}))}}},3768:(e,t,n)=>{const{getSpaceDimensionsFromTargetElement:r}=n(9724);e.exports=function(){const e=r(this);this.width=e[0],this.height=e[1],this.axesHelper={width:100,height:100}}},9034:(e,t,n)=>{const r=n(6788),{viewModes:o}=n(7861);e.exports=function(e,t,n,a){function i(e){const t=e.voxel.getVoxelChunkObject(e.voxel.generate());let n;for(n=0;n<e.children.length;n++)e.children[n].geometry=t.children[n].geometry}function s(n,o){const a=(new r.Matrix4).copy(t.matrixWorld).invert(),i=(new r.Matrix3).getNormalMatrix(a),s=n.point.clone().applyMatrix4(a),l=n.face.normal.clone().applyMatrix3(i).normalize(),c=o?.5:-.5;s.add(l.multiplyScalar(c/Math.max(e.voxelSize.width,e.voxelSize.height,e.voxelSize.length)));const d=Math.floor(s.x*e.voxelSize.width)+t.voxel.chunk.offset[0],p=Math.floor(s.y*e.voxelSize.height)+t.voxel.chunk.offset[1],u=Math.floor(s.z*e.voxelSize.length)+t.voxel.chunk.offset[2];return!(d<0||p<0||u<0||d>=e.voxelSize.width||p>=e.voxelSize.height||u>=e.voxelSize.length)&&{x:d,y:p,z:u}}function l(t){return e.children.find((e=>!!(e.voxel&&t.x>=e.voxel.chunk.offset[0]&&t.x<=e.voxel.chunk.offset[0]+e.voxel.chunk.size[0]&&t.y>=e.voxel.chunk.offset[1]&&t.y<=e.voxel.chunk.offset[1]+e.voxel.chunk.size[1]&&t.z>=e.voxel.chunk.offset[2]&&t.z<=e.voxel.chunk.offset[2]+e.voxel.chunk.size[2])&&e))}function c(e,t){const n=l({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z});n&&i(n)}return{onHover(t,r){switch(r){case o.add:return function(t){const r=s(t,!0);return!!r&&(n.visible=!0,n.position.set(r.x/e.voxelSize.width,r.y/e.voxelSize.height,r.z/e.voxelSize.length),!0)}(t);case o.change:case o.callback:return function(t){const r=s(t,!1);return!!r&&(n.visible=!0,n.position.set(r.x/e.voxelSize.width,r.y/e.voxelSize.height,r.z/e.voxelSize.length),!0)}(t);default:return!1}},onClick(r,d){switch(d){case o.add:return function(r){const o=s(r,!0);if(!o)return!1;const c=o.x+o.y*e.voxelSize.width+o.z*e.voxelSize.width*e.voxelSize.height;t.voxel.chunk.voxels instanceof Uint8Array?t.voxel.chunk.voxels[c]=a.parameters.voxelPaintColor:t.voxel.chunk.voxels.set(o.x,o.y,o.z,a.parameters.voxelPaintColor,!0),i(t);const d=l(o);return d&&t.uuid!==d.uuid&&i(d),n.visible=!1,!0}(r);case o.change:return function(r){const o=s(r,!1);if(!o)return!1;const l=o.x+o.y*e.voxelSize.width+o.z*e.voxelSize.width*e.voxelSize.height;return t.voxel.chunk.voxels instanceof Uint8Array?t.voxel.chunk.voxels[l]=a.parameters.voxelPaintColor:t.voxel.chunk.voxels.set(o.x,o.y,o.z,a.parameters.voxelPaintColor,!0),i(t),o.x===t.voxel.chunk.offset.x&&c(o,{x:-1,y:0,z:0}),o.x===t.voxel.chunk.offset.x+t.voxel.chunk.size-1&&c(o,{x:1,y:0,z:0}),o.y===t.voxel.chunk.offset.y&&c(o,{x:0,y:-1,z:0}),o.y===t.voxel.chunk.offset.y+t.voxel.chunk.size-1&&c(o,{x:0,y:1,z:0}),o.z===t.voxel.chunk.offset.z&&c(o,{x:1,y:0,z:-1}),o.z===t.voxel.chunk.offset.z+t.voxel.chunk.size-1&&c(o,{x:0,y:0,z:1}),n.visible=!1,!0}(r);case o.callback:return function(t){const n=s(t,!1);return n&&a.dispatch(a.events.VOXELS_CALLBACK,{coord:n,object:e}),!1}(r);default:return!1}}}}},6154:(e,t,n)=>{const{viewModes:r}=n(7861);e.exports=function(e,t){return{onHover(e,n){switch(n){case r.callback:return function(e){return t.dispatch(t.events.OBJECT_HOVERED,e),!1}(e);default:return!1}},onClick(e,n){switch(n){case r.callback:return function(e){return t.dispatch(t.events.OBJECT_CLICKED,e),!1}(e);default:return!1}}}}},9474:(e,t,n)=>{const r=n(6788),o=n(3915),{areAllChangesResolve:a}=n(9724);function i(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0;const n=new r.BufferGeometry,a=new r.MeshBasicMaterial({color:e.color}),s=e.text||"\\KaTeX",{color:l}=e,c=e.max_length||1,{position:d}=e,p=e.size||1,u=new r.Group,h=new r.Object3D,m=new r.Line(n,a),g=document.createElement("div"),{overlayDOMNode:f}=t.getWorld(),v=t.getWorld();function y(){let o,a,i,s;const l=.5*v.width,d=.5*v.height,p=function(e,t){const n=new r.Vector3;return e.updateMatrixWorld(),n.setFromMatrixPosition(e.matrixWorld),t.camera.frustum&&!t.camera.frustum.containsPoint(n)?{x:-1e4,y:-1e4,z:-1e4,out:!0}:(n.project(t.camera),n.x=.5*(n.x+1)*t.width,n.y=.5*(1-n.y)*t.height,{x:n.x,y:n.y,z:n.z})}(h,v);if(p.out)m.visible=!1,g.style.display="none";else{if(g.style.display="block","dynamic"===e.mode){let e,n,r=Math.atan2(p.y-d,p.x-l);const i=150,u=360;let h=0;do{e=Math.sqrt((p.x-l)*(p.x-l)+(p.y-d)*(p.y-d)),o=p.x+Math.cos(r)*Math.min(.98*l-e,Math.min(l,d)*c),a=p.y+Math.sin(r)*Math.min(.98*d-e,Math.min(l,d)*c),n=t.labels.every((e=>Math.sqrt((o-e.coord.x)*(o-e.coord.x)+(a-e.coord.y)*(a-e.coord.y))>i)),n||(r+=Math.PI/180*.25),h++}while(!n&&h<u);p.x=o,p.y=a,r>=-Math.PI/4&&r<Math.PI/4&&(s="lc",p.x-=g.offsetWidth),r>=Math.PI/4&&r<.75*Math.PI&&(s="ct",p.x-=g.offsetWidth/2,p.y-=g.offsetHeight),(r>=.75*Math.PI||r<.75*-Math.PI)&&(s="rc",p.x+=g.offsetWidth),r>=.75*-Math.PI&&r<-Math.PI/4&&(s="cb",p.x-=g.offsetWidth/2,p.y+=g.offsetHeight)}switch("local"===e.mode&&(s="cb",p.y-=.25*c*v.height),"side"===e.mode&&(s="rc",a=t.labels.reduce(((e,t)=>"side"===t.mode?e+t.domElement.offsetHeight+10:e),0),p.x=g.offsetWidth+10,p.y=10+a+g.offsetHeight/2),s[0]){case"l":o=`${Math.round(p.x)}px`;break;case"c":o=`calc(${Math.round(p.x)}px - 50%)`;break;case"r":o=`calc(${Math.round(p.x)}px - 100%)`}switch(s[1]){case"t":a=`${Math.round(p.y)}px`;break;case"c":a=`calc(${Math.round(p.y)}px - 50%)`;break;case"b":a=`calc(${Math.round(p.y)}px - 100%)`}i=new r.Vector3(2*(p.x/v.width-.5),2*-(p.y/v.height-.5),p.z),i.unproject(v.camera),n.attributes.position.array.set([h.position.x,h.position.y,h.position.z,i.x,i.y,i.z]),n.attributes.position.needsUpdate=!0,n.computeBoundingBox(),m.visible=!0,g.style.transform=`translate(${o},${a})`,g.style.zIndex=e.on_top?"1500":"15",h.coord=p,t.labels.push(h)}}e.is_html?(g.innerHTML=s,g.style.cssText="pointer-events: all"):g.innerHTML=o.renderToString(s,{displayMode:!0}),g.style.position="absolute",g.style.color=i(l),g.style.fontSize=`${p}em`,e.label_box&&(g.style.padding="5px",g.style.background=t.getWorld().targetDOMNode.style.backgroundColor,g.style.border=`1px solid ${i(l)}`,g.style.borderRadius="10px"),f.appendChild(g),h.position.set(d[0],d[1],d[2]),h.updateMatrixWorld(),m.frustumCulled=!1,n.setAttribute("position",new r.BufferAttribute(new Float32Array([0,0,0,1,1,1]),3)),n.computeBoundingSphere(),n.computeBoundingBox();const b=t.on(t.events.BEFORE_RENDER,y);return h.domElement=g,h.mode=e.mode,u.onRemove=function(){f.removeChild(g),h.domElement=null,t.off(t.events.BEFORE_RENDER,b)},u.add(h),u.add(m),y(),Promise.resolve(u)},update(e,t,n){const r={};return void 0===t.text||t.text.timeSeries||(e.is_html?n.children[0].domElement.innerHTML=t.text:n.children[0].domElement.innerHTML=o.renderToString(t.text,{displayMode:!0}),r.text=null),void 0===t.position||t.position.timeSeries||(n.children[0].position.set(t.position[0],t.position[1],t.position[2]),n.updateMatrixWorld(),r.position=null),!!a(t,r)&&Promise.resolve({json:e,obj:n})}}},8308:(e,t,n)=>{const r=n(5748),o=n(4660),a=n(180);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:65280,e.shader=void 0!==e.shader?e.shader:"simple","mesh"===e.shader?o.create(e,t):"simple"===e.shader?r.create(e,t):a.create(e,t)),update:(e,t,n,i)=>"mesh"===e.shader?o.update(e,t,n,i):"simple"===e.shader?r.update(e,t,n,i):a.update(e,t,n,i)}},4660:(e,t,n)=>{const r=n(6788),o=n(9724),{areAllChangesResolve:a}=o,{commonUpdate:i}=o,{colorsToFloat32Array:s}=n(5321),l=n(7241),{handleColorMap:c}=o;e.exports={create(e){e.radial_segments=void 0!==e.radial_segments?e.radial_segments:8,e.width=void 0!==e.width?e.width:.1;const t=new r.MeshPhongMaterial({emissive:0,shininess:50,specular:1118481,side:r.DoubleSide,wireframe:!1}),n=e.radial_segments,{width:o}=e;let a=e.colors&&e.colors.data||null;const i=new r.Color(e.color),d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,h=new r.Matrix4,m=e.vertices.data;a&&a.length===m.length/3&&(a=s(a));const g=l(m,u,o,n,i,a,d);u&&d&&p&&u.length>0&&d.length>0&&p.length>0?c(g,p,d,null,t):t.setValues({vertexColors:r.VertexColors}),g.computeBoundingSphere(),g.computeBoundingBox(),h.set.apply(h,e.model_matrix.data);const f=new r.Mesh(g,t);return f.applyMatrix4(h),f.updateMatrixWorld(),Promise.resolve(f)},update(e,t,n){const r={};return i(e,t,r,n),!!a(t,r)&&Promise.resolve({json:e,obj:n})}}},5748:(e,t,n)=>{const r=n(6788),{colorsToFloat32Array:o}=n(5321),a=n(9724),{commonUpdate:i}=a,{areAllChangesResolve:s}=a,{getColorsArray:l}=a,{handleColorMap:c}=a;e.exports={create(e){const t=new r.BufferGeometry,n=new r.MeshBasicMaterial,a=e.colors&&e.colors.data||null,i=new r.Color(e.color);let s;const d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,h=new r.Line(t,n),m=new r.Matrix4,g=e.vertices.data;return u&&d&&p&&u.length>0&&d.length>0&&p.length>0?c(t,p,d,u,n):(s=a&&a.length===g.length/3?o(a):l(i,g.length/3),n.setValues({vertexColors:r.VertexColors}),t.setAttribute("color",new r.BufferAttribute(s,3))),t.setAttribute("position",new r.BufferAttribute(g,3)),t.computeBoundingSphere(),t.computeBoundingBox(),m.set.apply(m,e.model_matrix.data),h.applyMatrix4(m),h.updateMatrixWorld(),Promise.resolve(h)},update(e,t,n){const r={};if(void 0!==n.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],r.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries&&t.attribute.data.length===n.geometry.attributes.uv.array.length)){const o=n.geometry.attributes.uv.array;for(let n=0;n<o.length;n++)o[n]=(t.attribute.data[n]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);n.geometry.attributes.uv.needsUpdate=!0,r.attribute=null}return void 0===t.vertices||t.vertices.timeSeries||t.vertices.data.length!==n.geometry.attributes.position.array.length||(n.geometry.attributes.position.array.set(t.vertices.data),n.geometry.attributes.position.needsUpdate=!0,r.vertices=null),i(e,t,r,n),!!s(t,r)&&Promise.resolve({json:e,obj:n})}}},180:(e,t,n)=>{const r=n(6788),{colorsToFloat32Array:o}=n(5321),a=n(2460)(r),i=n(9724),{commonUpdate:s}=i,{areAllChangesResolve:l}=i,c=n(5103),{getColorsArray:d}=i;e.exports={create:function(e,t){e.width=void 0!==e.width?e.width:.1;const n=new a.MeshLineMaterial({color:new r.Color(1,1,1),opacity:1,sizeAttenuation:!0,transparent:!0,lineWidth:e.width,resolution:new r.Vector2(t.getWorld().width,t.getWorld().height),side:r.DoubleSide}),i=e.colors&&e.colors.data||null,s=new r.Color(e.color);let l=null,p=null;const u=e.color_range,h=e.color_map&&e.color_map.data||null,m=e.attribute&&e.attribute.data||null,g=new r.Matrix4,f=e.vertices.data;if(m&&u&&h&&m.length>0&&u.length>0&&h.length>0){const e=c.createCanvasGradient(h,1024),t=new r.CanvasTexture(e,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);t.needsUpdate=!0,n.uniforms.useMap.value=1,n.uniforms.map.value=t,p=new Float32Array(m.length);for(let e=0;e<m.length;e++)p[e]=(m[e]-u[0])/(u[1]-u[0])}else l=i&&i.length===f.length/3?o(i):d(s,f.length/3);const v=new a.MeshLine;v.setGeometry(new Float32Array(f),!1,null,l,p),v.geometry.computeBoundingSphere(),v.geometry.computeBoundingBox();const y=new r.Mesh(v.geometry,n);y.userData.meshLine=v,y.userData.lastPosition=new Float32Array(f),y.userData.lastUVs=p,y.userData.lastColors=l,g.set.apply(g,e.model_matrix.data),y.applyMatrix4(g),y.updateMatrixWorld();const b=t.on(t.events.RESIZED,(()=>{y.material.uniforms.resolution.value.x=t.getWorld().width,y.material.uniforms.resolution.value.y=t.getWorld().height}));return y.onRemove=function(){t.off(t.events.RESIZED,b),y.material.uniforms.map.value&&(y.material.uniforms.map.value.dispose(),y.material.uniforms.map.value=void 0)},Promise.resolve(y)},update:function(e,t,n){let r=n.userData.lastUVs,o=n.userData.lastPosition;const a=n.userData.lastColors,i={};if(void 0!==n.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],i.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries)){if(t.attribute.data.length!==n.geometry.attributes.uv.array.length)return!1;r=new Float32Array(t.attribute.data.length);for(let n=0;n<r.length;n++)r[n]=(t.attribute.data[n]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);n.userData.lastUVs=r}if(void 0!==t.vertices&&!t.vertices.timeSeries){if(t.vertices.data.length!==o.length)return!1;o=t.vertices.data,n.userData.lastPosition=o}return void 0===t.attribute&&void 0===t.vertices||(n.userData.meshLine.setGeometry(o,!1,null,a,r),i.attribute=null,i.vertices=null),s(e,t,i,n),!!l(t,i)&&Promise.resolve({json:e,obj:n})}}},953:(e,t,n)=>{const r=n(6788),o=n(5843),a=n(5103),{typedArrayToThree:i}=n(9724),{areAllChangesResolve:s}=n(9724),{commonUpdate:l}=n(9724);e.exports={create(e){e.samples=e.samples||512,e.gradient_step=e.gradient_step||.005;const t=void 0!==window.randomMul?window.randomMul:255,s=new r.BoxBufferGeometry(1,1,1),l=new r.Matrix4,c=new r.Vector3,d=new r.Quaternion,p=new r.Vector3,u=e.color_map&&e.color_map.data||null;let h=e.opacity_function&&e.opacity_function.data||null;const m=e.color_range,{samples:g}=e;let f;null===h&&(h=[u[0],0,u[u.length-4],1]),l.set.apply(l,e.model_matrix.data),l.decompose(c,d,p);const v=new r.DataTexture3D(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);v.format=r.RedFormat,v.type=i(e.volume.data.constructor),v.generateMipmaps=!1,v.minFilter=r.LinearFilter,v.magFilter=r.LinearFilter,v.wrapS=r.ClampToEdgeWrapping,v.wrapT=r.ClampToEdgeWrapping,v.wrapR=r.ClampToEdgeWrapping,v.needsUpdate=!0,f=new r.DataTexture(new Uint8Array(o.range(4096).map((()=>t*Math.random()))),64,64,r.RedFormat,r.UnsignedByteType),f.minFilter=r.LinearFilter,f.magFilter=r.LinearFilter,f.wrapS=r.MirroredRepeatWrapping,f.wrapT=r.MirroredRepeatWrapping,f.generateMipmaps=!1,f.needsUpdate=!0;const y=a.createCanvasGradient(u,1024,h),b=new r.CanvasTexture(y,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);b.needsUpdate=!0;const x={volumeMapSize:{value:new r.Vector3(e.volume.shape[2],e.volume.shape[1],e.volume.shape[0])},low:{value:m[0]},high:{value:m[1]},gradient_step:{value:e.gradient_step},samples:{value:g},translation:{value:c},rotation:{value:d},scale:{value:p},volumeTexture:{type:"t",value:v},colormap:{type:"t",value:b},jitterTexture:{type:"t",value:f}},_=new r.ShaderMaterial({uniforms:o.merge(x,r.UniformsLib.lights),defines:{USE_SPECULAR:1},vertexShader:n(9192),fragmentShader:n(6231),side:r.BackSide,depthTest:!1,depthWrite:!1,lights:!0,clipping:!0,transparent:!0});s.computeBoundingSphere(),s.computeBoundingBox();const w=new r.Mesh(s,_);return w.applyMatrix4(l),w.updateMatrixWorld(),w.onRemove=function(){w.material.uniforms.volumeTexture.value=void 0,w.material.uniforms.colormap.value.dispose(),w.material.uniforms.colormap.value=void 0,f.dispose(),f=void 0},Promise.resolve(w)},update(e,t,n){const r={};if(void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],r.color_range=null),void 0===t.volume||t.volume.timeSeries||n.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&(n.material.uniforms.volumeTexture.value.image.data=t.volume.data,n.material.uniforms.volumeTexture.value.needsUpdate=!0,r.volume=null),void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries){const o=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=o,n.material.uniforms.colormap.value.needsUpdate=!0,r.color_map=null,r.opacity_function=null}return["samples","gradient_step"].forEach((e=>{t[e]&&!t[e].timeSeries&&(n.material.uniforms[e].value=t[e],r[e]=null)})),l(e,t,r,n),!!s(t,r)&&Promise.resolve({json:e,obj:n})}}},9603:(e,t,n)=>{const r=n(6788),{BufferGeometryUtils:o}=n(9961),a=n(1854),i=n(2314),s=n(7290),{areAllChangesResolve:l}=n(9724),{commonUpdate:c}=n(9724);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading,e.opacity=void 0!==e.opacity?e.opacity:1,new Promise((n=>{const l=e.scalar_field.data,c=e.scalar_field.shape[2],d=e.scalar_field.shape[1],p=e.scalar_field.shape[0],u=e.spacings_x,h=e.spacings_y,m=e.spacings_z;let g=!1;const{level:f}=e,v=new r.Matrix4,y=new(e.wireframe?r.MeshBasicMaterial:r.MeshPhongMaterial)({color:e.color,emissive:0,shininess:50,specular:1118481,side:r.DoubleSide,flatShading:e.flat_shading,wireframe:e.wireframe,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity});let b,x,_,w,M,C=new r.BufferGeometry,E=[],S=0;const A=i;u&&h&&m&&(g=u.shape[0]===c-1&&h.shape[0]===d-1&&m.shape[0]===p-1),s(p-1,5,g?function(e){for(_=0,w=0;w<d-1;w++){for(x=0,M=0;M<c-1;M++)A(E,l,f,c,d,p,M,w,e,x,_,S,u.data[M],h.data[w],m.data[e]),x+=u.data[M];_+=h.data[w]}S+=m.data[e]}:function(e){const t=1/(c-1),n=1/(d-1),r=1/(p-1);for(_=0,w=0;w<d-1;w++){for(x=0,M=0;M<c-1;M++)A(E,l,f,c,d,p,M,w,e,x,_,S,t,n,r),x+=t;_+=n}S+=r},(()=>{let i=1,s=1,l=1;E=new Float32Array(E),C.setAttribute("position",new r.BufferAttribute(E,3)),!1===e.flat_shading&&(C=o.mergeVertices(C),C.computeVertexNormals()),g&&(i=u.data.reduce(((e,t)=>e+t),0),s=h.data.reduce(((e,t)=>e+t),0),l=m.data.reduce(((e,t)=>e+t),0)),C.boundingSphere=new r.Sphere(new r.Vector3(.5*i,.5*s,.5*l),new r.Vector3(.5*i,.5*s,.5*l).length()),C.boundingBox=new r.Box3(new r.Vector3(0,0,0),new r.Vector3(i,s,l)),b=new r.Mesh(C,y),b.scale.set(1/i,1/s,1/l),a.init(e,b,t),v.set.apply(v,e.model_matrix.data),b.position.set(-.5,-.5,-.5),b.initialPosition=b.position.clone(),b.updateMatrix(),b.applyMatrix4(v),b.updateMatrixWorld(),n(b)}))}))),update(e,t,n,r){const o={};return a.update(e,t,n,r),void 0===t.opacity||t.opacity.timeSeries||(n.material.opacity=t.opacity,n.material.depthWrite=1===t.opacity,n.material.transparent=1!==t.opacity,n.material.needsUpdate=!0,o.opacity=null),c(e,t,o,n),!!l(t,o)&&Promise.resolve({json:e,obj:n})}}},4222:(e,t,n)=>{const r=n(4402),o=n(2611);function a(e){return e.volume&&e.volume.data&&e.volume.data.length>0&&e.volume_bounds&&e.volume_bounds.data&&e.volume_bounds.data.length>0&&e.color_range&&e.color_range.length>0&&e.color_map&&e.color_map.data&&e.color_map.data.length>0}e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,a(e)?o.create(e,t):r.create(e,t)),update:(e,t,n,i)=>a(e)?o.update(e,t,n,i):r.update(e,t,n,i)}},4402:(e,t,n)=>{const r=n(6788),o=n(1854),a=n(5103),{handleColorMap:i}=n(9724),{areAllChangesResolve:s}=n(9724),{commonUpdate:l}=n(9724),{getSide:c}=n(9724),d=n(5321);e.exports={create:(e,t)=>new Promise((n=>{e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading,e.opacity=void 0!==e.opacity?e.opacity:1;const a=new r.Matrix4,s=e.wireframe?r.MeshBasicMaterial:r.MeshPhongMaterial,l=new r.Texture,p=e.texture,u=e.texture_file_format,h=e.colors&&e.colors.data||null,m=e.color_range,g=e.color_map&&e.color_map.data||null,f=e.attribute&&e.attribute.data||null,v=e.triangles_attribute&&e.triangles_attribute.data||null,y=e.vertices&&e.vertices.data||null,b=e.indices&&e.indices.data||null,x=e.uvs&&e.uvs.data||null;let _=new r.BufferGeometry;const w=r.Mesh;let M,C,E,S;a.set.apply(a,e.model_matrix.data),_.setAttribute("position",new r.BufferAttribute(y,3)),_.setIndex(new r.BufferAttribute(b,1));const A=new s({color:e.color,emissive:0,shininess:50,specular:1118481,side:c(e),flatShading:e.flat_shading,wireframe:e.wireframe,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity});function P(){!1===e.flat_shading&&_.computeVertexNormals(),_.computeBoundingSphere(),_.computeBoundingBox(),C=new w(_,A),o.init(e,C,t),C.applyMatrix4(a),C.updateMatrixWorld(),n(C)}if(null!==h&&h.length>0)A.setValues({color:16777215,vertexColors:r.VertexColors}),_.setAttribute("color",new r.BufferAttribute(d.colorsToFloat32Array(h),3)),P();else if(f&&m&&g&&f.length>0&&m.length>0&&g.length>0)i(_,g,m,f,A),P();else if(v&&m&&g&&v.length>0&&m.length>0&&g.length>0){for(_=_.toNonIndexed(),E=new Float32Array(3*v.length),S=0;S<E.length;S++)E[S]=v[Math.floor(S/3)];i(_,g,m,E,A),P()}else p&&u&&x?(M=document.createElement("img"),M.src=`data:image/${u};base64,${d.bufferToBase64(p.data.buffer)}`,_.setAttribute("uv",new r.BufferAttribute(new Float32Array(x),2)),M.onload=function(){A.map=l,l.image=M,l.flipY=!1,l.minFilter=r.LinearFilter,l.needsUpdate=!0,A.needsUpdate=!0,P()}):P()})),update(e,t,n,i){const c={};let d,p;if(!n)return!1;if(n.geometry&&void 0!==n.geometry.attributes.uv){if(void 0!==t.color_range&&!t.color_range.timeSeries){if(d=n.geometry.attributes.uv.array,e.attribute.data.length>0)for(p=0;p<d.length;p++)d[p]=(e.attribute.data[p]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);if(e.triangles_attribute.data.length>0)for(p=0;p<d.length;p++)d[p]=(e.triangles_attribute.data[Math.floor(p/3)]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);n.geometry.attributes.uv.needsUpdate=!0,c.color_range=null}if(n.geometry&&void 0!==t.attribute&&!t.attribute.timeSeries){for(d=n.geometry.attributes.uv.array,p=0;p<d.length;p++)d[p]=(t.attribute.data[p]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);n.geometry.attributes.uv.needsUpdate=!0,c.attribute=null}if(void 0!==t.color_map&&!t.color_map.timeSeries){const r=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024);n.material.map.image=r,n.material.map.needsUpdate=!0,n.material.needsUpdate=!0,c.color_map=null}}return void 0===t.opacity||t.opacity.timeSeries||(n.material.uniforms&&n.material.uniforms.opacity?n.material.uniforms.opacity.value=t.opacity:n.material.opacity=t.opacity,n.material.depthWrite=1===t.opacity,n.material.transparent=1!==t.opacity,n.material.side=t.opacity<1?r.DoubleSide:r.FrontSide,c.opacity=null),o.update(e,t,c,n,i),l(e,t,c,n),!!s(t,c)&&Promise.resolve({json:e,obj:n})}}},2611:(e,t,n)=>{const r=n(6788),o=n(1854),a=n(5103),{typedArrayToThree:i}=n(9724),{areAllChangesResolve:s}=n(9724),{commonUpdate:l}=n(9724),{getSide:c}=n(9724);e.exports={create(e,t){e.color=void 0!==e.color?e.color:255,e.opacity=void 0!==e.opacity?e.opacity:1;const s=new r.Matrix4,l=e.color_range,d=e.color_map&&e.color_map.data||null,p=e.vertices&&e.vertices.data||null,u=e.indices&&e.indices.data||null;let h=null;const m=new r.BufferGeometry;e.opacity_function&&e.opacity_function.data&&e.opacity_function.data.length>0&&(h=e.opacity_function.data);const g=a.createCanvasGradient(d,1024,h),f=new r.CanvasTexture(g,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);f.needsUpdate=!0,m.setAttribute("position",new r.BufferAttribute(p,3)),m.setIndex(new r.BufferAttribute(u,1));const v=new r.DataTexture3D(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);v.format=r.RedFormat,v.type=i(e.volume.data.constructor),v.generateMipmaps=!1,v.minFilter=r.LinearFilter,v.magFilter=r.LinearFilter,v.wrapT=r.ClampToEdgeWrapping,v.wrapS=r.ClampToEdgeWrapping,v.needsUpdate=!0;const y=new r.ShaderMaterial({uniforms:{opacity:{value:e.opacity},low:{value:l[0]},high:{value:l[1]},volumeTexture:{type:"t",value:v},colormap:{type:"t",value:f},b1:{type:"v3",value:new r.Vector3(e.volume_bounds.data[0],e.volume_bounds.data[2],e.volume_bounds.data[4])},b2:{type:"v3",value:new r.Vector3(e.volume_bounds.data[1],e.volume_bounds.data[3],e.volume_bounds.data[5])}},side:c(e),vertexShader:n(6830),fragmentShader:n(2345),depthWrite:1===e.opacity&&null===h,transparent:1!==e.opacity||null!==h,lights:!1,clipping:!0});!1===e.flat_shading&&m.computeVertexNormals(),m.computeBoundingSphere(),m.computeBoundingBox();const b=new r.Mesh(m,y);return o.init(e,b,t),s.set.apply(s,e.model_matrix.data),b.applyMatrix4(s),b.updateMatrixWorld(),Promise.resolve(b)},update(e,t,n,r){const i={};if(o.update(e,t,i,n,r),void 0===t.volume||t.volume.timeSeries||n.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&(n.material.uniforms.volumeTexture.value.image.data=t.volume.data,n.material.uniforms.volumeTexture.value.needsUpdate=!0,i.volume=null),void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],i.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&(!t.opacity_function||!1!==n.material.transparent)){const r=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=r,n.material.uniforms.colormap.value.needsUpdate=!0,i.color_map=null,i.opacity_function=null}return l(e,t,i,n),!!s(t,i)&&Promise.resolve({json:e,obj:n})}}},2168:(e,t,n)=>{const r=n(8438),o=n(2975);e.exports={create:e=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:65280,e.opacity=void 0!==e.opacity?e.opacity:1,e.point_size=void 0!==e.point_size?e.point_size:1,e.shader=void 0!==e.shader?e.shader:"3dSpecular",e.opacity=Math.max(Math.min(e.opacity,1),0),"mesh"===e.shader?r.create(e):o.create(e)),update:(e,t,n,a)=>"mesh"===e.shader?r.update(e,t,n,a):o.update(e,t,n,a)}},2975:(e,t,n)=>{const r=n(6788),o=n(5321),a=n(5103),i=n(9724),{commonUpdate:s}=i,{areAllChangesResolve:l}=i,{getColorsArray:c}=i;e.exports={create(e){const t=new r.Matrix4,s=new r.Color(e.color),l=e.positions.data,d=e.colors&&e.colors.data||null,{shader:p}=e;let u=null;const h=e.opacities&&e.opacities.data&&e.opacities.data.length===l.length/3?e.opacities.data:null,m=e.point_sizes&&e.point_sizes.data&&e.point_sizes.data.length===l.length/3?e.point_sizes.data:null,{colorsToFloat32Array:g}=o,f={dot:n(5074),flat:n(8640),"3d":n(8349),"3dspecular":n(8349)},v={dot:n(1885),flat:n(6404),"3d":n(6404),"3dspecular":n(6404)},y=e.color_map&&e.color_map.data||null;let b=e.opacity_function&&e.opacity_function.data||null;const x=e.color_range,_=e.attribute&&e.attribute.data||null;let w={},M=0;const C=f[p.toLowerCase()]||f.flat,E=v[p.toLowerCase()]||v.flat;if(_&&x&&y&&_.length>0&&x.length>0&&y.length>0){M=1,null!==b&&0!==b.length||(b=[y[0],1,y[y.length-4],1],e.opacity_function={data:b,shape:[4]});const t=a.createCanvasGradient(y,1024,b),n=new r.CanvasTexture(t,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);n.needsUpdate=!0,w={low:{value:x[0]},high:{value:x[1]},colormap:{type:"t",value:n}}}else u=d&&d.length===l.length/3?g(d):c(s,l.length/3);const S=new r.ShaderMaterial({uniforms:r.UniformsUtils.merge([r.UniformsLib.lights,r.UniformsLib.points,w]),defines:{USE_SPECULAR:"3dSpecular"===p?1:0,USE_COLOR_MAP:M,USE_PER_POINT_OPACITY:null!==h?1:0,USE_PER_POINT_SIZE:null!==m?1:0},vertexShader:E,fragmentShader:C,opacity:e.opacity,depthWrite:1===e.opacity&&null===h,transparent:1!==e.opacity||null!==h,lights:!0,clipping:!0,extensions:{fragDepth:!0}});S.size=e.point_size,S.color=new r.Color(1,1,1),S.map=null,S.isPointsMaterial=!0;const A=new r.Points(function(e,t,n,o,a){const i=new r.BufferGeometry;return i.setAttribute("position",new r.BufferAttribute(new Float32Array(e),3)),t&&t.length>0&&i.setAttribute("color",new r.BufferAttribute(t,3)),n&&n.length>0&&i.setAttribute("opacities",new r.BufferAttribute(n,1).setUsage(r.DynamicDrawUsage)),o&&o.length>0&&i.setAttribute("sizes",new r.BufferAttribute(o,1).setUsage(r.DynamicDrawUsage)),a&&a.length>0&&i.setAttribute("attributes",new r.BufferAttribute(a,1).setUsage(r.DynamicDrawUsage)),i.computeBoundingSphere(),i.computeBoundingBox(),i}(l,u,h,m,M?_:null),S);return"dot"!==e.shader&&i.expandBoundingBox(A.geometry.boundingBox,.5*e.point_size),t.set.apply(t,e.model_matrix.data),A.applyMatrix4(t),A.updateMatrixWorld(),Promise.resolve(A)},update(e,t,n){const r={};if(void 0===t.positions||t.positions.timeSeries||t.positions.data.length!==n.geometry.attributes.position.array.length||(n.geometry.attributes.position.array.set(t.positions.data),n.geometry.attributes.position.needsUpdate=!0,n.geometry.computeBoundingSphere(),n.geometry.computeBoundingBox(),r.positions=null),void 0!==t.color_range&&!t.color_range.timeSeries&&n.geometry.attributes.attributes&&(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],r.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&n.geometry.attributes.attributes){const o=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=o,n.material.uniforms.colormap.value.needsUpdate=!0,r.color_map=null,r.opacity_function=null}return void 0!==t.attribute&&!t.attribute.timeSeries&&n.geometry.attributes.attattributesribute&&t.attribute.data.length===n.geometry.attributes.attributes.array.length&&(n.geometry.attributes.attributes.array.set(t.attribute.data),n.geometry.attributes.attributes.needsUpdate=!0,r.attribute=null),s(e,t,r,n),!!l(t,r)&&Promise.resolve({json:e,obj:n})}}},8438:(e,t,n)=>{const r=n(6788),o=n(5321),a=n(5103),i=n(9724),{areAllChangesResolve:s}=i,{commonUpdate:l}=i,{getColorsArray:c}=i;e.exports={create(e){const t=new r.Matrix4,s=new r.Color(e.color),l=e.positions.data,d=e.colors&&e.colors.data||null,p=void 0!==e.mesh_detail?e.mesh_detail:2;let u;const h=e.opacities&&e.opacities.data&&e.opacities.data.length===l.length/3?e.opacities.data:null,m=e.point_sizes&&e.point_sizes.data&&e.point_sizes.data.length===l.length/3?e.point_sizes.data:null,{colorsToFloat32Array:g}=o,f=r.ShaderLib.phong;let v;const y=new r.BufferGeometry,b=new r.IcosahedronBufferGeometry(.5*e.point_size,p),x=e.color_map&&e.color_map.data||null;let _=e.opacity_function&&e.opacity_function.data||null;const w=e.color_range,M=e.attribute&&e.attribute.data||null;let C={},E=0;if(M&&w&&x&&M.length>0&&w.length>0&&x.length>0){E=1,null!==_&&0!==_.length||(_=[x[0],1,x[x.length-4],1],e.opacity_function={data:_,shape:[4]});const t=a.createCanvasGradient(x,1024,_),n=new r.CanvasTexture(t,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);n.needsUpdate=!0,C={low:{value:w[0]},high:{value:w[1]},colormap:{type:"t",value:n}},b.setAttribute("attributes",new r.InstancedBufferAttribute(M,1).setUsage(r.DynamicDrawUsage))}else u=d&&d.length===l.length/3?g(d):c(s,l.length/3);b.setAttribute("color",new r.InstancedBufferAttribute(new Float32Array(u),3)),h&&b.setAttribute("opacities",new r.InstancedBufferAttribute(h,1)),y.setAttribute("position",new r.BufferAttribute(l,3)),y.computeBoundingSphere(),y.computeBoundingBox(),i.expandBoundingBox(y.boundingBox,.5*e.point_size),b.boundingBox=y.boundingBox.clone();const S=new r.ShaderMaterial({uniforms:r.UniformsUtils.merge([f.uniforms,{shininess:{value:50},opacity:{value:e.opacity}},C]),defines:{USE_PER_POINT_OPACITY:null!==h?1:0,USE_COLOR_MAP:E},vertexShader:n(2048),fragmentShader:n(6772),depthWrite:1===e.opacity&&null===h,transparent:1!==e.opacity||null!==h,lights:!0,clipping:!0,vertexColors:r.VertexColors}),A=new r.InstancedMesh(b,S,l.length/3);for(A.instanceMatrix.setUsage(r.DynamicDrawUsage),t.set.apply(t,e.model_matrix.data),A.applyMatrix4(t),A.updateMatrixWorld(),v=0;v<l.length/3;v++){let e=m&&m[v]||1;A.setMatrixAt(v,(new r.Matrix4).identity().setPosition(l[3*v],l[3*v+1],l[3*v+2]).scale(new r.Vector3(e,e,e)))}return Promise.resolve(A)},update(e,t,n){const r={};if(void 0===t.positions||t.positions.timeSeries||t.positions.data.length!==n.geometry.attributes.position.array.length||(n.geometry.attributes.position.array.set(t.positions.data),n.geometry.attributes.position.needsUpdate=!0,n.geometry.computeBoundingSphere(),n.geometry.computeBoundingBox(),r.positions=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&n.geometry.attributes.attributes){const o=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=o,n.material.uniforms.colormap.value.needsUpdate=!0,r.color_map=null,r.opacity_function=null}return void 0!==t.color_range&&!t.color_range.timeSeries&&n.geometry.attributes.attributes&&(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],r.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries&&n.geometry.attributes.attributes&&t.attribute.data.length===n.geometry.attributes.attributes.array.length&&(n.geometry.attributes.attributes.array.set(t.attribute.data),n.geometry.attributes.attributes.needsUpdate=!0,r.attribute=null),l(e,t,r,n),!!s(t,r)&&Promise.resolve({json:e,obj:n})}}},8012:(e,t,n)=>{const r=n(6788),{BufferGeometryUtils:o}=n(9961),{areAllChangesResolve:a}=n(9724),{commonUpdate:i}=n(9724);e.exports={create(e){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading;const t=new r.STLLoader,n=new r.Matrix4;let a=new(e.wireframe?r.MeshBasicMaterial:r.MeshPhongMaterial)({color:e.color,emissive:0,shininess:50,specular:1118481,flatShading:e.flat_shading,side:r.DoubleSide,wireframe:e.wireframe});const{text:i}=e,{binary:s}=e;let l;l=null==i?t.parse(s.data.buffer):t.parse(i),l.hasColors&&(a=new r.MeshPhongMaterial({opacity:l.alpha,vertexColors:r.VertexColors,wireframe:e.wireframe})),!1===e.flat_shading&&(l=o.mergeVertices(l),l.computeVertexNormals());const c=new r.Mesh(l,a);return l.computeBoundingSphere(),l.computeBoundingBox(),n.set.apply(n,e.model_matrix.data),c.applyMatrix4(n),c.updateMatrixWorld(),Promise.resolve(c)},update(e,t,n){const r={};return i(e,t,r,n),!!a(t,r)&&Promise.resolve({json:e,obj:n})}}},6264:(e,t,n)=>{const r=n(2976),{areAllChangesResolve:o}=n(9724),{commonUpdate:a}=n(9724);function i(e){let t;this._map=new Map,this.set=function(n,r,o,a,i){const s=e.sparse_voxels.data;if(this._map.set((o*e.space_size.data[0]+r)*e.space_size.data[1]+n,a),i){for(let i=0;i<s.length;i+=4)if(s[i]===n&&s[i+1]===r&&s[i+2]===o)return void(0===a?(t=new s.constructor(s.length-4),t.set(s.subarray(0,i)),t.set(s.subarray(i+4,s.length),i),e.sparse_voxels.data=t,e.sparse_voxels.shape[0]--):s[i+3]=a);0!==a&&(t=new s.constructor(s.length+4),t.set(s),t.set([n,r,o,a],s.length),e.sparse_voxels.data=t,e.sparse_voxels.shape[0]++)}},this.get=function(t,n,r){return this._map.get((r*e.space_size.data[0]+n)*e.space_size.data[1]+t)}}e.exports={create(e,t){const n=e.sparse_voxels.data,o=new i(e);let a;for(a=0;a<n.length;a+=4)o.set(n[a],n[a+1],n[a+2],n[a+3],!1);return r.create(e,r.generateRegularChunks(32,[e.space_size.data[2],e.space_size.data[1],e.space_size.data[0]],o),e.space_size.data,t)},update(e,t,n){const r={};return a(e,t,r,n),!!o(t,r)&&Promise.resolve({json:e,obj:n})}}},4638:(e,t,n)=>{const r=n(6788),o=n(1854),{handleColorMap:a}=n(9724),{areAllChangesResolve:i}=n(9724),{commonUpdate:s}=n(9724);e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading;const n=e.heights.data,i=e.heights.shape[1],s=e.heights.shape[0],l=new r.Matrix4,c=e.wireframe?r.MeshBasicMaterial:r.MeshPhongMaterial,d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,h=new c({color:e.color,emissive:0,shininess:50,specular:1118481,side:r.DoubleSide,flatShading:e.flat_shading,wireframe:e.wireframe}),m=new r.BufferGeometry,g=new Float32Array(i*s*3),f=[];let v,y,b,x;for(y=0,b=0,x=0;y<s;y++)for(v=0;v<i;v++,x++,b+=3)g[b]=v/(i-1),g[b+1]=y/(s-1),g[b+2]=n[x];for(y=0,b=0;y<s-1;y++)for(v=0;v<i-1;v++,b+=6)f[b]=v+y*i,f[b+1]=v+1+y*i,f[b+3]=f[b+1],f[b+2]=v+(y+1)*i,f[b+5]=f[b+2],f[b+4]=v+1+(y+1)*i;m.setAttribute("position",new r.BufferAttribute(g,3)),m.setIndex(f),!1===e.flat_shading&&m.computeVertexNormals(),u&&d&&p&&u.length>0&&d.length>0&&p.length>0&&a(m,p,d,u,h),m.computeBoundingSphere(),m.computeBoundingBox();const _=new r.Mesh(m,h);return o.init(e,_,t),l.set.apply(l,e.model_matrix.data),_.position.set(-.5,-.5,0),_.initialPosition=_.position.clone(),_.updateMatrix(),_.applyMatrix4(l),_.updateMatrixWorld(),Promise.resolve(_)},update(e,t,n,r){const a={};return o.update(e,t,a,n,r),s(e,t,a,n),!!i(t,a)&&Promise.resolve({json:e,obj:n})}}},2932:(e,t,n)=>{const r=n(6788),o=n(3915);function a(e,t,n){const o=new r.Vector3,a=.5*t.width,i=.5*t.height;return e.updateMatrixWorld(),o.setFromMatrixPosition(e.matrixWorld),n.frustum&&!n.frustum.containsPoint(o)?{x:-1e3,y:-1e3,z:-1e3}:(o.project(n),o.x=(o.x+1)*a+t.offsetX,o.y=(1-o.y)*i+t.offsetY,{x:Math.round(o.x),y:Math.round(o.y),z:o.z})}function i(e){return`#${new r.Color(e).getHexString()}`}e.exports={create(e,t,n){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0,e.text=void 0!==e.text?e.text:"\\KaTeX";const{text:s}=e,{color:l}=e,c=e.reference_point||"lb",d=e.size||1,{position:p}=e,u=new r.Object3D,h=document.createElement("div"),m=t.getWorld(),{overlayDOMNode:g}=m;e.is_html?(h.innerHTML=s,h.style.cssText="pointer-events: all"):h.innerHTML=o.renderToString(s,{displayMode:!0}),h.style.position="absolute",h.style.color=i(l),h.style.fontSize=`${d}em`,e.label_box&&(h.style.padding="5px",h.style.background=t.getWorld().targetDOMNode.style.backgroundColor,h.style.border=`1px solid ${i(l)}`,h.style.borderRadius="10px"),g.appendChild(h),u.position.set(p[0],p[1],p[2]),u.text=s,u.updateMatrixWorld();const f=t.on(t.events.RENDERED,(function(){let t,r,o;if("hidden"!==h.style.display){switch(t=n?a(u,{width:n.width,height:n.height,offsetX:m.width-n.width,offsetY:m.height-n.height},n.camera):a(u,{width:m.width,height:m.height,offsetX:0,offsetY:0},m.camera),c[0]){case"l":r=`${t.x}px`;break;case"c":r=`calc(${t.x}px - 50%)`;break;case"r":r=`calc(${t.x}px - 100%)`}switch(c[1]){case"t":o=`${t.y}px`;break;case"c":o=`calc(${t.y}px - 50%)`;break;case"b":o=`calc(${t.y}px - 100%)`}h.style.transform=`translate(${r},${o})`,h.style.zIndex=e.on_top?16777271-Math.round(1e6*t.z):"15"}}));return u.onRemove=function(){g.contains(h)&&g.removeChild(h),t.off(t.events.RENDERED,f)},u.hide=function(){h.style.display="none"},u.show=function(){h.style.display="block"},u.show(),Promise.resolve(u)}}},3099:(e,t,n)=>{const r=n(6788),o=n(3915),{areAllChangesResolve:a}=n(9724);function i(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0;const n=e.text||"\\KaTeX",{color:a}=e,s=e.reference_point||"lb",{position:l}=e,c=e.size||1,d=new r.Object3D,p=document.createElement("div"),{overlayDOMNode:u}=t.getWorld(),h=t.getWorld();e.is_html?(p.innerHTML=n,p.style.cssText="pointer-events: all"):p.innerHTML=o.renderToString(n,{displayMode:!0}),p.style.position="absolute",p.style.color=i(a),p.style.fontSize=`${c}em`,e.label_box&&(p.style.padding="5px",p.style.background=t.getWorld().targetDOMNode.style.backgroundColor,p.style.border=`1px solid ${i(a)}`,p.style.borderRadius="10px"),u.appendChild(p),d.position.set(l[0],l[1],l[2]),d.updateMatrixWorld();const m=t.on(t.events.RENDERED,(function(){let e,t;const n=d.position.x*h.width,r=d.position.y*h.height;switch(s[0]){case"l":e=`${n}px`;break;case"c":e=`calc(${n}px - 50%)`;break;case"r":e=`calc(${n}px - 100%)`}switch(s[1]){case"t":t=`${r}px`;break;case"c":t=`calc(${r}px - 50%)`;break;case"b":t=`calc(${r}px - 100%)`}p.style.transform=`translate(${e},${t})`,p.style.zIndex=16777271}));return d.domElement=p,d.onRemove=function(){u.removeChild(p),d.domElement=null,t.off(t.events.RENDERED,m)},Promise.resolve(d)},update(e,t,n){const r={};return void 0===t.text||t.text.timeSeries||(e.is_html?(n.domElement.innerHTML=t.text,n.domElement.style.pointerEvents="all"):(n.domElement.innerHTML=o.renderToString(t.text,{displayMode:!0}),n.domElement.style.pointerEvents="none"),r.text=null),void 0===t.position||t.position.timeSeries||(n.position.set(t.position[0],t.position[1],t.position[2]),n.updateMatrixWorld(),r.position=null),!!a(t,r)&&Promise.resolve({json:e,obj:n})}}},2833:(e,t,n)=>{const r=n(8507),o=n(719);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.file_format&&e.binary?r.create(e,t):o.create(e,t)),update:(e,t,n,a)=>e.file_format&&e.binary?r.update(e,t,n,a):o.update(e,t,n,a)}},719:(e,t,n)=>{const r=n(6788),o=n(1854),a=n(5103),{areAllChangesResolve:i}=n(9724),{commonUpdate:s}=n(9724),{typedArrayToThree:l}=n(9724);e.exports={create:(e,t)=>new Promise((i=>{const s=new r.PlaneBufferGeometry(1,1),c=new r.Matrix4,d=e.color_map&&e.color_map.data||null;let p=e.opacity_function&&e.opacity_function.data||null;const u=e.color_range;e.interpolation=void 0===e.interpolation||e.interpolation,null!==p&&0!==p.length||(p=[d[0],1,d[d.length-4],1],e.opacity_function={data:p,shape:[4]});const h=new r.DataTexture(e.attribute.data,e.attribute.shape[1],e.attribute.shape[0],r.RedFormat,l(e.attribute.data.constructor));e.interpolation?(h.minFilter=r.LinearFilter,h.magFilter=r.LinearFilter,h.anisotropy=t.getWorld().renderer.capabilities.getMaxAnisotropy()):(h.minFilter=r.NearestFilter,h.magFilter=r.NearestFilter,h.anisotropy=0),h.generateMipmaps=!1,h.needsUpdate=!0;const m=a.createCanvasGradient(d,1024,p),g=new r.CanvasTexture(m,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);g.needsUpdate=!0;const f={low:{value:u[0]},high:{value:u[1]},map:{type:"t",value:h},colormap:{type:"t",value:g}},v=new r.ShaderMaterial({uniforms:f,vertexShader:n(3012),fragmentShader:n(7644),side:r.DoubleSide,clipping:!0});if(9===e.puv.data.length){const t=s.attributes.position.array,n=(new r.Vector3).fromArray(e.puv.data,0),o=(new r.Vector3).fromArray(e.puv.data,3),a=(new r.Vector3).fromArray(e.puv.data,6);n.toArray(t,0),n.clone().add(o).toArray(t,3),n.clone().add(a).toArray(t,6),n.clone().add(a).add(o).toArray(t,9),s.computeVertexNormals()}s.computeBoundingSphere(),s.computeBoundingBox();const y=new r.Mesh(s,v);o.init(e,y,t),c.set.apply(c,e.model_matrix.data),y.applyMatrix4(c),y.updateMatrixWorld(),y.onRemove=function(){y.material.uniforms.map.value.dispose(),y.material.uniforms.map.value=void 0,y.material.uniforms.colormap.value.dispose(),y.material.uniforms.colormap.value=void 0},i(y)})),update(e,t,n,r){const l={};if(o.update(e,t,l,n,r),void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],l.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&(!t.opacity_function||!1!==n.material.transparent)){const r=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=r,n.material.uniforms.colormap.value.needsUpdate=!0,l.color_map=null,l.opacity_function=null}return void 0===t.attribute||t.attribute.timeSeries||n.material.uniforms.map.value.image.data.constructor===t.attribute.data.constructor&&(n.material.uniforms.map.value.image.data=t.attribute.data,n.material.uniforms.map.value.needsUpdate=!0,l.attribute=null),s(e,t,l,n),!!i(t,l)&&Promise.resolve({json:e,obj:n})}}},8507:(e,t,n)=>{const r=n(6788),o=n(1854),{areAllChangesResolve:a}=n(9724),{commonUpdate:i}=n(9724),s=n(5321);e.exports={create:(e,t)=>new Promise((n=>{const a=new r.PlaneBufferGeometry(1,1),i=new r.Matrix4,l=new r.Texture;let c,d;e.interpolation=void 0===e.interpolation||e.interpolation;const p=document.createElement("img");if(p.src=`data:image/${e.file_format};base64,${s.bufferToBase64(e.binary.data.buffer)}`,9===e.puv.data.length){const t=a.attributes.position.array,n=(new r.Vector3).fromArray(e.puv.data,0),o=(new r.Vector3).fromArray(e.puv.data,3),i=(new r.Vector3).fromArray(e.puv.data,6);n.toArray(t,0),n.clone().add(o).toArray(t,3),n.clone().add(i).toArray(t,6),n.clone().add(i).add(o).toArray(t,9),a.computeVertexNormals()}a.computeBoundingSphere(),a.computeBoundingBox(),p.onload=function(){c=new r.MeshBasicMaterial({color:16777215,side:r.DoubleSide,map:l}),d=new r.Mesh(a,c),o.init(e,d,t),i.set.apply(i,e.model_matrix.data),d.applyMatrix4(i),d.updateMatrixWorld(),e.interpolation?(l.minFilter=r.LinearFilter,l.magFilter=r.LinearFilter):(l.minFilter=r.NearestFilter,l.magFilter=r.NearestFilter),l.image=p,l.flipY=!1,l.minFilter=r.LinearFilter,l.needsUpdate=!0,n(d)}})),update(e,t,n,r){const s={};return o.update(e,t,s,n,r),i(e,t,s,n),!!a(t,s)&&Promise.resolve({json:e,obj:n})}}},6242:(e,t,n)=>{const r=n(6788),{closestPowOfTwo:o}=n(9724),{areAllChangesResolve:a}=n(9724);e.exports={create(e){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:16777215,e.font_size=void 0!==e.font_size?e.font_size:68,e.font_weight=void 0!==e.font_weight?e.font_weight:700;const t=e.text.split("\n"),{color:n}=e,{position:a}=e,i=e.size||1,s=e.font_face||"Courier New",l=e.font_size,c=`${e.font_weight} ${l}px ${s}`,d=document.createElement("canvas"),p=d.getContext("2d"),u=t.length>1;p.font=c;const h=function(e,t){return e.reduce(((e,n)=>{const r=t.measureText(n);let o=0;return r.actualBoundingBoxAscent&&r.actualBoundingBoxDescent&&(o=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent),Math.max(e,o,r.width)}),0)}(t,p);d.width=o(h),d.height=~~d.width,p.font=c,p.textBaseline="top",p.fillStyle=function(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}(n),p.lineWidth=5,t.forEach(((e,t)=>{const n=(d.width-h)/2,r=d.height/2-(u?l:l/2)+l*t;p.strokeText(e,n,r),p.fillText(e,n,r)}));const m=function(e,t,n){const o=new r.Texture(e),a=new r.SpriteMaterial({map:o}),i=new r.Sprite(a);return o.needsUpdate=!0,i.position.set(t[0],t[1],t[2]),i.scale.set(n,n,n),i.boundingBox=(new r.Box3).setFromCenterAndSize(new r.Vector3,new r.Vector3(n,n,n)),i.updateMatrixWorld(),i}(d,a,i);return Promise.resolve(m)},update(e,t,n){const r={};return void 0===t.position||t.position.timeSeries||(n.position.set(t.position[0],t.position[1],t.position[2]),r.position=null),void 0===t.size||t.size.timeSeries||(n.scale.set(t.size,t.size,t.size),r.size=null),!!a(t,r)&&Promise.resolve({json:e,obj:n})}}},7186:(e,t,n)=>{const r=n(6788);e.exports={create(e){const t=new r.Object3D,n=new r.Matrix4;var o,a;return t.add(new r.LineSegments(new r.BufferGeometry,new r.LineBasicMaterial({color:16777215,transparent:!0,opacity:.5}))),t.add(new r.Mesh(new r.BufferGeometry,new r.MeshPhongMaterial({color:e.color,emissive:0,side:r.DoubleSide,flatShading:!0}))),o=t,a=new r.TorusKnotGeometry(e.radius,e.tube,64,e.knotsNumber,2,3),o.children[0].geometry.dispose(),o.children[1].geometry.dispose(),o.children[0].geometry=new r.WireframeGeometry(a),o.children[1].geometry=a,o.children[0].geometry.computeBoundingSphere(),o.children[1].geometry.computeBoundingSphere(),o.children[0].geometry.computeBoundingBox(),o.children[1].geometry.computeBoundingBox(),n.set.apply(n,e.model_matrix.data),t.applyMatrix4(n),t.updateMatrixWorld(),Promise.resolve(t)}}},253:(e,t,n)=>{const r=n(6788),{BufferGeometryUtils:o}=n(9961),a=n(5321),{areAllChangesResolve:i}=n(9724),{commonUpdate:s}=n(9724),l=n(2460)(r),{getTwoColorsArray:c}=n(9724),{generateArrow:d}=n(9724);e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.origin_color=void 0!==e.origin_color?e.origin_color:255,e.head_color=void 0!==e.head_color?e.head_color:255,e.use_head=void 0===e.use_head||e.use_head,e.head_size=e.head_size||1,e.scale=e.scale||1,e.line_width=e.line_width||.01;const n=(new r.Matrix4).fromArray(e.model_matrix.data),i=new r.Color(e.origin_color),s=new r.Color(e.head_color);let p=e.vectors.shape[2],u=e.vectors.shape[1],h=e.vectors.shape[0],m=e.vectors.data,g=e.colors&&e.colors.data||null;const f=e.use_head,v=e.head_size,{scale:y}=e,b=new r.Group;let x,_,w,M,C,E,S=null;const A=[],{colorsToFloat32Array:P}=a;3===e.vectors.shape.length&&(p=u,u=h,h=1,m=function(e){let t;const n=new Float32Array(e.length/2*3);for(t=0;t<e.length/2;t++)n[3*t]=e[2*t],n[3*t+1]=e[2*t+1],n[3*t+2]=0;return n}(m));const D=y/Math.max(p,u,h);g=g?P(g):c(i,s,p*u*h*2);const z=new r.CylinderGeometry(0,.025*v*D,.2*v*D,5,1).translate(0,-.1*v*D,0);for(w=0,M=0;w<h;w++)for(_=0;_<u;_++)for(x=0;x<p;x++,M++)C=new r.Vector3(x/p,_/u,w/h),E=new r.Vector3(m[3*M]/2*D,m[3*M+1]/2*D,m[3*M+2]/2*D).add(C),S=d(f?z:null,A,S,C,E,new r.Color(g[6*M+3],g[6*M+4],g[6*M+5]),.2*v*D);f&&function(e,t){(e=o.mergeBufferGeometries(e)).computeBoundingSphere(),e.computeBoundingBox(),t.add(new r.Mesh(e,new r.MeshBasicMaterial({vertexColors:r.VertexColors})))}(S,b);let T=new l.MeshLine;const O=new l.MeshLineMaterial({color:new r.Color(1,1,1),opacity:1,sizeAttenuation:!0,transparent:!0,lineWidth:e.line_width,resolution:new r.Vector2(t.getWorld().width,t.getWorld().height),side:r.DoubleSide});T.setGeometry(new Float32Array(A),!0,null,g),T.geometry.computeBoundingSphere(),T.geometry.computeBoundingBox(),T=new r.Mesh(T.geometry,O),b.add(T),b.position.set(-.5,-.5,1===h?0:-.5),b.initialPosition=b.position.clone(),b.updateMatrix(),b.applyMatrix4(n),b.boundingBox=T.geometry.boundingBox,b.updateMatrixWorld();const j=t.on(t.events.RESIZED,(()=>{T.material.uniforms.resolution.value.x=t.getWorld().width,T.material.uniforms.resolution.value.y=t.getWorld().height}));return b.onRemove=function(){t.off(t.events.RESIZED,j)},Promise.resolve(b)},update(e,t,n){const r={};return s(e,t,r,n),!!i(t,r)&&Promise.resolve({json:e,obj:n})}}},860:(e,t,n)=>{const r=n(6788),{BufferGeometryUtils:o}=n(9961),a=n(5321),i=n(2460)(r),{getTwoColorsArray:s}=n(9724),{generateArrow:l}=n(9724),c=n(2932);function d(e,t,n,r,o){const a=t.clone().add(n).divideScalar(2),i={position:[a.x,a.y,a.z],referencePoint:"cb",text:e,size:r};return c.create(i,o)}e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.origin_color=void 0!==e.origin_color?e.origin_color:255,e.head_color=void 0!==e.head_color?e.head_color:255,e.use_head=void 0===e.use_head||e.use_head,e.head_size=e.head_size||1,e.line_width=e.line_width||.01;const n=new r.Color(e.origin_color),c=new r.Color(e.head_color),p=e.vectors.data,u=e.origins.data;let h=e.colors&&e.colors.data||[];const m=e.use_head,g=e.head_size,f=new r.Group;let v,y,b;const x=e.label_size,{labels:_}=e,w=[];let M=null;const C=[];if(h=h.length>0?a.colorsToFloat32Array(h):s(n,c,p.length/3*2),p.length!==u.length)throw new Error("vectors and origins should have the same length");if(h&&h.length/2!==p.length)throw new Error("there should be 2 colors for each vector");const E=new r.CylinderGeometry(0,.025*g,.2*g,5,1).translate(0,-.1*g,0);for(b=0;b<p.length;b+=3)v=new r.Vector3(u[b],u[b+1],u[b+2]),y=new r.Vector3(p[b],p[b+1],p[b+2]).add(v),M=l(m?E:null,C,M,v,y,new r.Color(h[2*b+3],h[2*b+4],h[2*b+5]),.2*g),_&&_[b/3]&&w.push(d(_[b/3],v,y,x,t));m&&function(e,t){(e=o.mergeBufferGeometries(e)).computeBoundingSphere(),e.computeBoundingBox(),t.add(new r.Mesh(e,new r.MeshBasicMaterial({vertexColors:r.VertexColors})))}(M,f);let S=new i.MeshLine;const A=new i.MeshLineMaterial({color:new r.Color(1,1,1),opacity:1,sizeAttenuation:!0,transparent:!0,lineWidth:e.line_width,resolution:new r.Vector2(t.getWorld().width,t.getWorld().height),side:r.DoubleSide});S.setGeometry(new Float32Array(C),!0,null,h),S.geometry.computeBoundingSphere(),S.geometry.computeBoundingBox(),S=new r.Mesh(S.geometry,A),f.add(S),f.updateMatrixWorld();const P=t.on(t.events.RESIZED,(()=>{S.material.uniforms.resolution.value.x=t.getWorld().width,S.material.uniforms.resolution.value.y=t.getWorld().height}));return Promise.all(w).then((e=>(e.forEach((e=>{f.add(e)})),f.onRemove=function(){e.forEach((e=>{e.onRemove()})),t.off(t.events.RESIZED,P)},f)))}}},5064:(e,t,n)=>{const r=n(6788),o=n(5843),a=n(5103),{closestPowOfTwo:i}=n(9724),{typedArrayToThree:s}=n(9724),{areAllChangesResolve:l}=n(9724),{commonUpdate:c}=n(9724);e.exports={create(e,t){e.samples=e.samples||512,e.alpha_coef=void 0!==e.alpha_coef?e.alpha_coef:50,e.gradient_step=e.gradient_step||.005,e.shadow=e.shadow||"off",e.interpolation=void 0===e.interpolation||e.interpolation,e.shadow_delay=e.shadow_delay||500,e.shadow_res=i(e.shadow_res||128),e.ray_samples_count=e.ray_samples_count||16,e.focal_plane=e.focal_plane||512,e.focal_length=void 0!==e.focal_length?e.focal_length:0;const l=void 0!==window.randomMul?window.randomMul:255,c=t.getWorld().renderer.getContext(),d=new r.BoxBufferGeometry(1,1,1),p=new r.Matrix4,u=new r.Vector3,h=new r.Quaternion,m=new r.Vector3,g=c.getParameter(c.MAX_TEXTURE_SIZE);let f=e.shadow_res;const v=e.color_map&&e.color_map.data||null;let y=e.opacity_function&&e.opacity_function.data||null;const b=e.color_range,{samples:x}=e;let _,w,M,C,E,S,A,P=0;f=f>512?512:f;const D=i(Math.sqrt(f*f*f));if(D>g)throw new Error(`To big light map size. gl.MAX_TEXTURE_SIZE=${g}`);null===y&&(y=[v[0],0,v[v.length-4],1]),p.set.apply(p,e.model_matrix.data),p.decompose(u,h,m);const z=new r.DataTexture3D(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);z.format=r.RedFormat,z.type=s(e.volume.data.constructor),z.generateMipmaps=!1,e.interpolation?(z.minFilter=r.LinearFilter,z.magFilter=r.LinearFilter):(z.minFilter=r.NearestFilter,z.magFilter=r.NearestFilter),z.wrapS=r.ClampToEdgeWrapping,z.wrapT=r.ClampToEdgeWrapping,z.wrapR=r.ClampToEdgeWrapping,z.needsUpdate=!0,E=new r.DataTexture(new Uint8Array(o.range(4096).map((()=>l*Math.random()))),64,64,r.RedFormat,r.UnsignedByteType),E.minFilter=r.LinearFilter,E.magFilter=r.LinearFilter,E.wrapS=r.MirroredRepeatWrapping,E.wrapT=r.MirroredRepeatWrapping,E.generateMipmaps=!1,E.needsUpdate=!0;const T=a.createCanvasGradient(v,1024,y),O=new r.CanvasTexture(T,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter);O.needsUpdate=!0,"off"!==e.shadow&&(C=new r.WebGLRenderTarget(D,D,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RedFormat,type:r.UnsignedByteType,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!1}));const j={lightMapSize:{value:new r.Vector3(f,f,f)},volumeMapSize:{value:new r.Vector3(e.volume.shape[2],e.volume.shape[1],e.volume.shape[0])},lightMapRenderTargetSize:{value:new r.Vector2(D,D)},low:{value:b[0]},high:{value:b[1]},samples:{value:x},alpha_coef:{value:e.alpha_coef},gradient_step:{value:e.gradient_step},translation:{value:u},rotation:{value:h},shadowTexture:{type:"t",value:C?C.texture:null},focal_length:{value:e.focal_length},focal_plane:{value:e.focal_plane},scale:{value:m},volumeTexture:{type:"t",value:z},colormap:{type:"t",value:O},jitterTexture:{type:"t",value:E}},L=new r.ShaderMaterial({uniforms:o.merge(j,r.UniformsLib.lights),defines:{USE_SPECULAR:1,USE_SHADOW:"off"!==e.shadow?1:0,RAY_SAMPLES_COUNT:0!==e.focal_length?e.ray_samples_count:0},vertexShader:n(2307),fragmentShader:n(7003),side:r.BackSide,depthTest:!1,depthWrite:!1,lights:!0,clipping:!0,transparent:!0});d.computeBoundingSphere(),d.computeBoundingBox();const k=new r.Mesh(d,L);return k.applyMatrix4(p),k.updateMatrixWorld(),"off"!==e.shadow&&(_=new r.Scene,M=new r.Mesh(new r.PlaneBufferGeometry(D,D),new r.ShaderMaterial({uniforms:o.merge(j,r.UniformsLib.lights,{lightDirection:{type:"v3",value:new r.Vector3}}),defines:{USE_MAP:1},vertexShader:n(2085),fragmentShader:n(472),clipping:!0,depthWrite:!1,depthTest:!1})),M.applyMatrix4(p),M.updateMatrixWorld(),w=new r.OrthographicCamera(D/-2,D/2,D/2,D/-2,-1e4,1e4),w.position.z=100,_.add(M),k.refreshLightMap=function(e){if(C){const{renderer:n}=t.getWorld(),o=new r.Vector3;e?M.material.uniforms.lightDirection.value.fromArray(e).normalize():(t.getWorld().camera.getWorldPosition(o),M.material.uniforms.lightDirection.value.copy(u.clone().sub(o).normalize())),t.getWorld().camera.updateMatrixWorld(),M.material.uniformsNeedUpdate=!0,n.clippingPlanes=[],t.parameters.clippingPlanes.forEach((e=>{n.clippingPlanes.push(new r.Plane((new r.Vector3).fromArray(e),e[3]))})),n.setRenderTarget(C),n.clear(!0,!0,!0),n.render(_,w),n.setRenderTarget(null)}},"dynamic"===e.shadow&&(S=t.on(t.events.BEFORE_RENDER,(()=>{const n=(new Date).getTime();A&&clearTimeout(A),n-P>=e.shadow_delay?(k.refreshLightMap(),P=n):A=setTimeout((()=>{k.refreshLightMap(),P=n,t.render()}),Math.max(e.shadow_delay,500))}))),k.quadRTT=M,k.refreshLightMap()),k.onRemove=function(){M&&(M.material.uniforms.volumeTexture.value.dispose(),M.material.uniforms.volumeTexture.value=void 0),k.material.uniforms.volumeTexture.value=void 0,k.material.uniforms.colormap.value.dispose(),k.material.uniforms.colormap.value=void 0,E.dispose(),E=void 0,_&&(_=void 0),w&&(w=void 0),C&&(C.dispose(),C=void 0),S&&t.off(t.events.BEFORE_RENDER,S)},Promise.resolve(k)},update(e,t,n){const r={};if(void 0===t.color_range||t.color_range.timeSeries||(n.material.uniforms.low.value=t.color_range[0],n.material.uniforms.high.value=t.color_range[1],r.color_range=null),void 0!==t.focal_length&&!t.focal_length.timeSeries&&(0===n.material.uniforms.focal_length.value&&0!==t.focal_length||0===t.focal_length))return!1;if(void 0===t.volume||t.volume.timeSeries||n.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&(n.material.uniforms.volumeTexture.value.image.data=t.volume.data,n.material.uniforms.volumeTexture.value.needsUpdate=!0,r.volume=null),void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries){const o=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);n.material.uniforms.colormap.value.image=o,n.material.uniforms.colormap.value.needsUpdate=!0,n.quadRTT&&(n.quadRTT.material.uniforms.colormap.value.image=o,n.quadRTT.material.uniforms.colormap.value.needsUpdate=!0),r.color_map=null,r.opacity_function=null}return["samples","alpha_coef","gradient_step","focal_plane","focal_length"].forEach((e=>{void 0===t[e]||t[e].timeSeries||(n.material.uniforms[e].value=t[e],r[e]=null)})),c(e,t,r,n),!!l(t,r)&&Promise.resolve({json:e,obj:n})}}},3060:(e,t,n)=>{const r=n(2976),{areAllChangesResolve:o}=n(9724),{commonUpdate:a}=n(9724);e.exports={create:(e,t)=>r.create(e,r.generateRegularChunks(27,e.voxels.shape,e.voxels.data),[e.voxels.shape[2],e.voxels.shape[1],e.voxels.shape[0]],t),update(e,t,n){const r={};return a(e,t,r,n),!!o(t,r)&&Promise.resolve({json:e,obj:n})}}},2199:(e,t,n)=>{const r=n(2976),o=n(5843),{areAllChangesResolve:a}=n(9724),{commonUpdate:i}=n(9724);function s(e){const t=e.coord.data[0],n=e.coord.data[1],r=e.coord.data[2],o=e.voxels.shape[2],a=e.voxels.shape[1],i=e.voxels.shape[0],{data:s}=e.voxels;function l(t){let n=e.coord.data[0]-t.offset[0],r=e.coord.data[1]-t.offset[1],o=e.coord.data[2]-t.offset[2];return n=n<0?1e3:n,r=r<0?1e3:r,o=o<0?1e3:o,n+r+o}this.neighbours=[],this.data=s,this.set=function(e,s,l,c,d){const p=e-t,u=s-n,h=l-r;if(p>=0&&p<o&&u>=0&&u<a&&h>=0&&h<i)this.data[(h*a+u)*o+p]=c;else if(!d)for(let t=0;t<this.neighbours.length;t++)if(this.neighbours[t].voxels.set(e,s,l,c,!0))return!0;return!0},this.get=function(e,s,l,c){const d=e-t,p=s-n,u=l-r;if(d>=0&&d<o&&p>=0&&p<a&&u>=0&&u<i)return this.data[(u*a+p)*o+d];if(!c)for(let t=0;t<this.neighbours.length;t++){const n=this.neighbours[t].voxels.get(e,s,l,!0);if(-1!==n)return n}return-1},this.setNeighbours=function(t,n){this.neighbours=t.reduce(((t,r)=>{if(r.id===n.id)return t;const o=Math.max(e.coord.data[0]+e.voxels.shape[2],r.offset[0]+r.size[0])-Math.min(e.coord.data[0],r.offset[0]),a=Math.max(e.coord.data[1]+e.voxels.shape[1],r.offset[1]+r.size[1])-Math.min(e.coord.data[1],r.offset[1]),i=Math.max(e.coord.data[2]+e.voxels.shape[0],r.offset[2]+r.size[2])-Math.min(e.coord.data[2],r.offset[2]),s=e.voxels.shape[2]+r.size[0],l=e.voxels.shape[1]+r.size[1],c=e.voxels.shape[0]+r.size[2];if(o<=s&&a<=l&&i<=c){if(o===s&&a===l&&i===c)return t;t.push(r)}return t}),[]),this.neighbours.sort(((e,t)=>l(e)-l(t)))}}function l(e,t){return{voxels:new s(e),size:[e.voxels.shape[2],e.voxels.shape[1],e.voxels.shape[0]],offset:e.coord.data,multiple:e.multiple,id:e.id||t,idx:t}}e.exports={create(e,t){const n=[];return void 0!==e.voxels_group&&e.voxels_group.forEach(((e,t)=>{n.push(l(e,t))})),void 0!==e.chunks_ids&&e.chunks_ids.forEach(((e,r)=>{n.push(l(t.getWorld().chunkList[e].attributes,r))})),n.forEach((e=>{e.voxels.setNeighbours(n,e)})),r.create(e,n,e.space_size.data,t)},update(e,t,n,r){const s={};if(void 0===t.opacity||t.opacity.timeSeries||(n.traverse((t=>{t.material&&(t.material.userData.outline?(t.material.uniforms.opacity.value=.75*e.opacity,t.material.opacity=t.material.uniforms.opacity.value):(t.material.opacity=e.opacity,t.material.depthWrite=1===e.opacity,t.material.transparent=1!==e.opacity))})),s.opacity=null),void 0!==t.chunks_ids&&!t.chunks_ids.timeSeries){const e={},a=new Set;n.children.forEach((t=>{t.voxel&&(e[t.voxel.chunk.id]=t)}));const i=Object.keys(e).reduce(((e,t)=>(e.push(parseInt(t,10)),e)),[]);o.difference(i,t.chunks_ids).forEach((t=>{e[t].voxel.chunk.voxels.neighbours.forEach((e=>{a.add(e.id)})),n.remove(e[t]),n.voxelsChunks=n.voxelsChunks.filter((e=>e.id!==t)),e[t].children.forEach((e=>{e.geometry.dispose(),e.material.dispose()})),e[t]=null})),o.difference(t.chunks_ids,i).forEach((t=>{const o=l(r.getWorld().chunkList[t].attributes,n.voxelsChunks.length),a=n.addChunk(o);n.voxelsChunks.push(o),e[t]=a})),n.voxelsChunks.forEach((e=>{e.voxels.setNeighbours(n.voxelsChunks,e)})),o.difference(t.chunks_ids,i).forEach((t=>{const{chunk:n}=e[t].voxel;a.add(n.id),n.voxels.neighbours.forEach((e=>{a.add(e.id)}))})),a.forEach((t=>{e[t]&&n.updateChunk(e[t].voxel.chunk,!0)})),s.chunks_ids=null}return void 0===t._hold_remeshing||t._hold_remeshing.timeSeries||(n.holdRemeshing=e._hold_remeshing,e._hold_remeshing||n.rebuildChunk(),s._hold_remeshing=null),i(e,t,s,n),!!a(t,s)&&Promise.resolve({json:e,obj:n})}}},7203:(e,t,n)=>{const r=n(6788),o=n(5735);n(9806)(r),n(8117)(r),n(3866)(r),n(9209)(r),n(903)(r),r.Mesh.prototype.raycast=o.acceleratedRaycast,e.exports={Helpers:n(9724),Initializers:{Canvas:n(2794),Camera:n(8175),Renderer:n(5567),Scene:n(404).Init,Setup:n(3768),Manipulate:n(6615)},Objects:{Line:n(8308),MarchingCubes:n(9603),Mesh:n(4222),Points:n(2168),STL:n(8012),Surface:n(4638),TextureText:n(6242),Texture:n(2833),Text:n(2932),Text2d:n(3099),TorusKnot:n(7186),VectorField:n(253),Vectors:n(860),Voxels:n(3060),SparseVoxels:n(6264),VoxelsGroup:n(2199),Volume:n(5064),MIP:n(953),Label:n(9474)},Interactions:{Voxels:n(9034),intersectCallback:n(6154)}}},9452:(e,t,n)=>{const r=n(4872),o=n(7723),a=n(7203),i=n(7360),s=n(4260),l=i.createCodec({preset:!0});n(2876),n(4316),e.exports={K3D:o,CreateK3DAndLoadBinarySnapshot:function(e,t){let n;e=s.inflate(e),e=i.decode(e,{codec:l});try{n=new o(a,t,e.plot)}catch(e){return void console.log(e)}return n.setSnapshot(e).then((function(){return setTimeout((function(){e.plot.camera.length>0&&(n.setCamera(e.plot.camera),n.render())}),10),n}))},TransferFunctionEditor:r.transferFunctionEditor,TransferFunctionModel:r.transferFunctionModel,TransferFunctionView:r.transferFunctionView,ThreeJsProvider:a,version:n(5527).version}},4872:(e,t,n)=>{const r=n(829),o=n(5843),a=n(5527).version,i=n(5103),s=n(5251);function l(e,t,r){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");let a=t.opacityFunction;const s=o.namespaceURI;let l,c,d,p,u=t.colorMap;const h=10,m=40;let g=[],f=[];function v(e){const t=e.target.parentNode,n=g.indexOf(t);0!==n&&n!==g.length-1&&(o.removeChild(t),g.splice(n,1),a.splice(2*n,2),w(o,!0),r({key:"opacity_function",value:a}),e.preventDefault())}function y(e){const t=e.target.parentNode,n=f.indexOf(t);0!==n&&n!==f.length-1&&(o.removeChild(t),f.splice(n,1),u.splice(4*n,4),w(o,!0),_(o,!0),r({key:"color_map",value:u}),e.preventDefault())}function b(e,t,n){const r=document.createElementNS(o.namespaceURI,"g");return[{offset:1,color:"white"},{offset:0,color:"black"}].forEach((a=>{const i=document.createElementNS(o.namespaceURI,"circle");i.setAttribute("cx",e+a.offset),i.setAttribute("cy",t+a.offset),i.setAttribute("r",n),i.setAttribute("stroke-width",1),i.setAttribute("stroke",a.color),i.setAttribute("fill","transparent"),r.appendChild(i)})),r}function x(e,t){return e.reduce(((n,r,o)=>(o%(1+t)==0&&n.push({v:r,p:e.slice(o+1,o+1+t)}),n)),[]).sort(((e,t)=>e.v-t.v)).reduce(((e,t)=>(e.push(t.v),t.p.forEach((t=>{e.push(t)})),e)),[])}function _(e,t){let n;if(i.createSVGGradient(e,"colorMap",u,null,!0),p.setAttribute("x",0),p.setAttribute("y",e.clientHeight-m+10),p.setAttribute("width",e.clientWidth),p.setAttribute("height",30),!t)for(f.forEach((t=>{e.removeChild(t)})),f=[],n=0;n<u.length;n+=4){const t=b((u[n]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,e.clientHeight-15,5);t.classList.add("draggable"),t.classList.add("colormap"),t.addEventListener("contextmenu",y),t.addEventListener("dblclick",(t=>{const n=f.indexOf(t.target.parentElement),o=`0${Math.round(255*u[4*n+1]).toString(16)}`,a=`0${Math.round(255*u[4*n+2]).toString(16)}`,i=`0${Math.round(255*u[4*n+3]).toString(16)}`;l.k3dIndex=n,l.value=`#${o.substr(-2)}${a.substr(-2)}${i.substr(-2)}`,l.click(),l.addEventListener("change",(function t(n){const o=n.target.value.substr(1);u[4*l.k3dIndex+1]=parseInt(o.substring(0,2),16)/255,u[4*l.k3dIndex+2]=parseInt(o.substring(2,4),16)/255,u[4*l.k3dIndex+3]=parseInt(o.substring(4,6),16)/255,_(e,!0),w(e,!0),r({key:"color_map",value:u}),l.removeEventListener("change",t)}))})),e.appendChild(t),f.push(t)}}function w(e,t){let n;const r=a.concat([u[u.length-4],0,u[0],0]);for(i.createSVGGradient(e,"transferFunction",u,a,!0),c.points.clear(),n=0;n<r.length;n+=2){const t=e.createSVGPoint();t.x=(r[n]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,t.y=(1-r[n+1])*(e.clientHeight-h-m)+h,c.points.appendItem(t)}if(c.setAttribute("fill","url(#transferFunction)"),c.setAttribute("stroke-width",1),c.setAttribute("stroke","black"),!t)for(g.forEach((t=>{e.removeChild(t)})),g=[],n=0;n<a.length;n+=2){const t=b((a[n]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,(1-a[n+1])*(e.clientHeight-h-m)+h,5);t.classList.add("draggable"),t.classList.add("polygon"),t.addEventListener("contextmenu",v),e.appendChild(t),g.push(t)}}function M(){w(o),_(o)}n(1552),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.classList.add("k3d-transfer-function"),c=document.createElementNS(s,"polygon"),p=document.createElementNS(s,"rect"),p.setAttribute("fill","url(#colorMap)"),o.appendChild(c),o.appendChild(p),l=document.createElement("input"),l.setAttribute("type","color"),l.classList.add("k3d-color-picker"),e.appendChild(o),e.appendChild(l),window.addEventListener("resize",M,!1),function(e){function t(t){const n=e.getScreenCTM();return t.touches&&(t=t.touches[0]),{x:(t.clientX-n.e)/n.a,y:(t.clientY-n.f)/n.d}}function n(n){if(n.target.parentNode.classList.contains("draggable"))d=n.target.parentNode;else{const o=t(n);if(o.y>h&&o.y<e.clientHeight-m&&(a.push(u[0]+o.x/e.clientWidth*(u[u.length-4]-u[0])),a.push(1-(o.y-h)/(e.clientHeight-h-m)),a=x(a,1),w(e,!1),r({key:"opacity_function",value:a})),o.y>e.clientHeight-m+10){const t=u[0]+o.x/e.clientWidth*(u[u.length-4]-u[0]);let n;const a=i.mergeColorMapWithOpacity(u,[u[0],0,t,.5,u[u.length-4],1]);for(n=0;n<a.length;n+=5)a[n]===t&&(u=u.concat(a.slice(n,n+4)));u=x(u,3),_(e,!1),r({key:"color_map",value:u})}}}function o(n){let o;if(d){n.preventDefault();const i=t(n);d.classList.contains("polygon")&&(o=g.indexOf(d),i.y=Math.max(i.y,h),i.y=Math.min(i.y,e.clientHeight-m),0===o||o===g.length-1?i.x=parseFloat(d.childNodes[1].getAttribute("cx")):(i.x=Math.min(i.x,parseFloat(g[o+1].childNodes[1].getAttribute("cx"))-1),i.x=Math.max(i.x,parseFloat(g[o-1].childNodes[1].getAttribute("cx"))+1)),a[2*o]=u[0]+i.x/e.clientWidth*(u[u.length-4]-u[0]),a[2*o+1]=1-(i.y-h)/(e.clientHeight-h-m),r({key:"opacity_function",value:a})),d.classList.contains("colormap")&&(o=f.indexOf(d),i.y=parseFloat(d.childNodes[1].getAttribute("cy")),0===o||o===f.length-1?i.x=parseFloat(d.childNodes[1].getAttribute("cx")):(i.x=Math.min(i.x,parseFloat(f[o+1].childNodes[1].getAttribute("cx"))-1),i.x=Math.max(i.x,parseFloat(f[o-1].childNodes[1].getAttribute("cx"))+1)),u[4*o]=u[0]+i.x/e.clientWidth*(u[u.length-4]-u[0]),r({key:"color_map",value:u})),d.childNodes.forEach(((e,t)=>{e.setAttribute("cx",i.x+1-t),e.setAttribute("cy",i.y+1-t)})),_(e,!0),w(e,!0)}}function s(){d=!1}e.addEventListener("mousedown",n),e.addEventListener("mousemove",o),e.addEventListener("mouseup",s),e.addEventListener("mouseleave",s),e.addEventListener("touchstart",n),e.addEventListener("touchmove",o),e.addEventListener("touchend",s),e.addEventListener("touchleave",s),e.addEventListener("touchcancel",s)}(o),u=x(u,3),a=x(a,1),M(),this.refresh=M,this.setColorMap=function(e){u=e,M()},this.setOpacityFunction=function(e){a=e,M()},this.getColorMap=function(){return u},this.getOpacityFunction=function(){return a},this.isDragging=function(){return!1!==d}}const c=r.DOMWidgetModel.extend({defaults:o.extend(o.result({},"widgets.DOMWidgetModel.prototype.defaults"),{_model_name:"TransferFunctionModel",_view_name:"TransferFunctionView",_model_module:"k3d",_view_module:"k3d",_model_module_version:a,_view_module_version:a})},{serializers:o.extend({color_map:s,opacity_function:s},r.DOMWidgetModel.serializers)}),d=r.DOMWidgetView.extend({render(){const e=window.document.createElement("div"),t=window.document.createElement("div");e.style.cssText=[`height:${this.model.get("height")}px`,"position: relative"].join(";"),t.style.cssText=["width: 100%","height: 100%","position: relative"].join(";"),e.appendChild(t),this.el.appendChild(e),this.container=t,this.on("displayed",this._init,this)},remove(){},_init(){const e=this;this.model.on("change:color_map",this._setColorMap,this),this.model.on("change:opacity_function",this._setOpacityFunction,this);try{this.K3DTransferFunctionEditorInstance=new l(this.container,{height:this.model.get("height"),colorMap:Array.from(this.model.get("color_map").data),opacityFunction:Array.from(this.model.get("opacity_function").data)},(t=>{e.model.set(t.key,{data:new Float32Array(t.value),shape:[t.value.length]},{updated_view:e}),e.model.save_changes()}))}catch(e){console.log(e)}},_setColorMap(e,t,n){if(n.updated_view===this||this.K3DTransferFunctionEditorInstance.isDragging())return;const r=Array.from(this.model.get("color_map").data);this.K3DTransferFunctionEditorInstance.setColorMap(Array.from(r))},_setOpacityFunction(e,t,n){if(n.updated_view===this||this.K3DTransferFunctionEditorInstance.isDragging())return;const r=this.model.get("opacity_function").data;this.K3DTransferFunctionEditorInstance.setOpacityFunction(Array.from(r))},processPhosphorMessage(e){switch(r.DOMWidgetView.prototype.processPhosphorMessage.call(this,e),e.type){case"after-attach":this.el.addEventListener("contextmenu",this,!0);break;case"before-detach":this.el.removeEventListener("contextmenu",this,!0);break;case"resize":this.handleResize(e)}},handleEvent(e){switch(e.type){case"contextmenu":this.handleContextMenu(e);break;default:r.DOMWidgetView.prototype.handleEvent.call(this,e)}},handleContextMenu(){},handleResize(){this.K3DTransferFunctionEditorInstance&&this.K3DTransferFunctionEditorInstance.refresh()}});e.exports={transferFunctionModel:c,transferFunctionView:d,transferFunctionEditor:l}},5527:(e,t,n)=>{const r=n(8008);e.exports={version:r.version}},1174:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,".katex-display {\r\n  margin: 0.25em 0 !important;\r\n}\r\n\r\n.dg input, .dg select {\r\n  color: black;\r\n  line-height: normal !important;\r\n}\r\n\r\n.dg li {\r\n  list-style: none !important;\r\n}\r\n\r\n.dg li > * {\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n.dg input, .dg select {\r\n  padding: 3px !important;\r\n  display: block !important;\r\n  box-shadow: none !important;\r\n  font-size: 100% !important;\r\n  border: 0 !important;\r\n}\r\n\r\n.dg.a {\r\n  margin-right: 0 !important;\r\n}\r\n\r\n.dg li {\r\n  margin: 0 !important;\r\n}\r\n\r\n.dg.main {\r\n  max-height: inherit !important;;\r\n}\r\n\r\n.dg.main .close-button.close-bottom {\r\n  position: relative !important;\r\n}\r\n\r\n.dg.main.taller-than-window .close-button.close-bottom {\r\n  position: absolute !important;\r\n  bottom: 0 !important;\r\n}\r\n\r\n.dg.main.taller-than-window > ul > li:last-child {\r\n  margin-bottom: 20px !important;\r\n}\r\n\r\n.k3d-target canvas {\r\n  position: relative;\r\n  z-index: 10;\r\n}\r\n\r\n.k3d-transfer-function {\r\n  height: 100% !important;\r\n}\r\n\r\n.k3d-transfer-function circle {\r\n  cursor: move;\r\n}\r\n\r\n.k3d-transfer-function circle.selected {\r\n  /*stroke: red;*/\r\n}\r\n\r\n.k3d-color-picker {\r\n  display: none;\r\n}\r\n\r\n",""]);const a=o},1552:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(3379),o=n.n(r),a=n(1174);o()(a.Z,{insert:"head",singleton:!1});const i=a.Z.locals||{}},6231:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nuniform mat4 transform;\r\nuniform sampler3D volumeTexture;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler2D jitterTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform mat4 modelViewMatrix;\r\nuniform float samples;\r\nuniform float gradient_step;\r\n\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\n\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n\tvec3(-0.5, -0.5, -0.5),\r\n\tvec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n\t\t\t((inv_direction.x < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.y < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.z < 0.0) ? 1 : 0)\r\n\t\t)\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\n    in Ray ray, in vec3 aabb[2],\r\n    out float tmin, out float tmax\r\n){\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1-ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1-ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1-ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nvec3 worldGetNormal(in float px, in vec3 pos)\r\n{\r\n    return normalize(\r\n        vec3(px -  texture(volumeTexture, pos + vec3(gradient_step, 0, 0)).x,\r\n             px -  texture(volumeTexture, pos + vec3(0, gradient_step, 0)).x,\r\n             px -  texture(volumeTexture, pos + vec3(0, 0, gradient_step)).x\r\n         )\r\n    );\r\n}\r\n\r\nvoid main() {\r\n    float jitter = texture2D(jitterTexture, gl_FragCoord.xy/64.0).r;\r\n\tfloat tmin = 0.0;\r\n\tfloat tmax = 0.0;\r\n    float px = -3.402823466e+38F;\r\n    vec4 pxColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n    vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n    intersect(makeRay(transformedCameraPosition, direction), aabb, tmin, tmax);\r\n\r\n    vec3 textcoord_end = localPosition + vec3(0.5);\r\n    vec3 textcoord_start = textcoord_end - (tmax - max(0.0, tmin)) * direction / scale.xyz;\r\n    vec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n    // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n    int sampleCount = min(int(length(textcoord_delta) * samples), int(samples * 1.8));\r\n\r\n    textcoord_delta = textcoord_delta / float(sampleCount);\r\n    textcoord_start = textcoord_start - textcoord_delta * (0.01 + 0.98 * jitter);\r\n\r\n    vec3 textcoord = textcoord_start - textcoord_delta;\r\n    vec3 maxTextcoord = textcoord;\r\n\r\n    float step = length(textcoord_delta);\r\n\r\n    for(int count = 0; count < sampleCount; count++) {\r\n        textcoord += textcoord_delta;\r\n\r\n        #if NUM_CLIPPING_PLANES > 0\r\n            vec4 plane;\r\n            vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n            #pragma unroll_loop_start\r\n            for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\r\n                plane = clippingPlanes[ i ];\r\n                if ( dot( pos, plane.xyz ) > plane.w ) continue;\r\n            }\r\n            #pragma unroll_loop_end\r\n        #endif\r\n\r\n        float newPx = texture(volumeTexture, textcoord).x;\r\n\r\n        if(newPx > px) {\r\n            px = newPx;\r\n            maxTextcoord = textcoord;\r\n        }\r\n\r\n        if (px >= high) {\r\n            break;\r\n        }\r\n    }\r\n\r\n    float scaled_px = (px - low) * inv_range;\r\n\r\n    if(scaled_px > 0.0) {\r\n        scaled_px = min(scaled_px, 0.99);\r\n\r\n        pxColor = texture(colormap, vec2(scaled_px, 0.5));\r\n    }\r\n\r\n    // LIGHT\r\n    #if NUM_DIR_LIGHTS > 0\r\n        vec4 addedLights = vec4(ambientLightColor, 1.0);\r\n        vec3 normal = worldGetNormal(px, maxTextcoord);\r\n\r\n        vec3 lightDirection;\r\n        float lightingIntensity;\r\n\r\n        #pragma unroll_loop_start\r\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            lightDirection = -directionalLights[ i ].direction;\r\n            lightingIntensity = clamp(dot(-lightDirection, normal), 0.0, 1.0);\r\n            addedLights.rgb += directionalLights[ i ].color * (0.05 + 0.95 * lightingIntensity);\r\n\r\n            #if (USE_SPECULAR == 1)\r\n            pxColor.rgb += directionalLights[ i ].color * pow(lightingIntensity, 50.0) * pxColor.a;\r\n            #endif\r\n        }\r\n        #pragma unroll_loop_end\r\n\r\n        pxColor.rgb *= addedLights.xyz;\r\n    #endif\r\n\r\n    gl_FragColor = pxColor;\r\n}"},9192:e=>{"use strict";e.exports="uniform vec4 rotation;\r\nuniform vec4 translation;\r\n\r\nvarying vec4 worldPosition;\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nvec3 rotate_vertex_position(vec3 pos, vec3 t, vec4 q) {\r\n    vec3 p = pos.xyz - t.xyz;\r\n\r\n    return p.xyz + 2.0 * cross(cross(p.xyz, q.xyz) + q.w * p.xyz, q.xyz) + t.xyz;\r\n}\r\n\r\nvoid main() {\r\n    vec3 p;\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n    localPosition = position;\r\n    worldPosition = modelMatrix * vec4(transformed, 1.0);\r\n\r\n    transformedCameraPosition = rotate_vertex_position(cameraPosition.xyz, translation.xyz, rotation);\r\n    transformedWorldPosition = rotate_vertex_position(worldPosition.xyz, translation.xyz, rotation);\r\n\r\n\t#include <worldpos_vertex>\r\n}"},2345:e=>{"use strict";e.exports="precision highp sampler3D;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler3D volumeTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform vec3 b1;\r\nuniform vec3 b2;\r\nuniform float opacity;\r\n\r\nvarying vec4 worldPosition;\r\n\r\n#include <common>\r\n#include <dithering_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n    vec3 coord = (worldPosition.xyz - b1) / (b2 - b1);\r\n    float inv_range = 1.0 / (high - low);\r\n    float px = texture(volumeTexture, coord).x;\r\n    float scaled_px = (px - low) * inv_range;\r\n\r\n    scaled_px = max(min(scaled_px, 0.99), 0.01);\r\n    vec4 texelColor = texture(colormap, vec2(scaled_px, 0.5));\r\n\r\n    texelColor.a *= opacity;\r\n\r\n\tgl_FragColor = texelColor;\r\n\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n}\r\n"},6830:e=>{"use strict";e.exports="varying vec4 worldPosition;\r\n\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n    worldPosition = modelMatrix * vec4( position, 1.0 );\r\n\r\n    #include <clipping_planes_vertex>\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n}"},8349:e=>{"use strict";e.exports="uniform float size;\r\nuniform float specular;\r\nuniform float opacity;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 ambientLightColor;\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\nstruct DirectionalLight {\r\n    vec3 direction;\r\n    vec3 color;\r\n};\r\n\r\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\r\n\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main (void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n\r\n    vec2 impostorSpaceCoordinate = (gl_PointCoord.xy - vec2(0.5, 0.5)) * 2.0;\r\n    float distanceFromCenter = length(impostorSpaceCoordinate);\r\n\r\n    if (distanceFromCenter > 1.0) discard;\r\n\r\n    float normalizedDepth = sqrt(1.0 - distanceFromCenter * distanceFromCenter);\r\n\r\n    #if defined(GL_EXT_frag_depth)\r\n    float depthOfFragment = normalizedDepth * size * 0.5;\r\n\r\n    vec4 pos = vec4(mvPosition.xyz, 1.0);\r\n    pos.z += depthOfFragment;\r\n\r\n    pos = projectionMatrix * pos;\r\n    pos = pos / pos.w;\r\n    float depth = (pos.z + 1.0) / 2.0;\r\n\r\n    if (depth < gl_FragDepthEXT) discard;\r\n    gl_FragDepthEXT = depth;\r\n    #endif\r\n\r\n    vec3 normal = vec3(impostorSpaceCoordinate, normalizedDepth);\r\n\r\n    vec4 addedLights = vec4(ambientLightColor, 1.0);\r\n    vec4 finalSphereColor = vColor;\r\n\r\n    finalSphereColor.a *= opacity;\r\n\r\n    for (int l = 0; l <NUM_DIR_LIGHTS; l++) {\r\n        vec3 lightDirection = -directionalLights[l].direction;\r\n        float lightingIntensity = clamp(dot(-lightDirection, normal), 0.0, 1.0);\r\n        addedLights.rgb += directionalLights[l].color * (0.05 + 0.95 * lightingIntensity);\r\n\r\n        #if (USE_SPECULAR == 1)\r\n        finalSphereColor.rgb += directionalLights[l].color * pow(lightingIntensity, 80.0);\r\n        #endif\r\n    }\r\n\r\n    gl_FragColor = finalSphereColor * addedLights;\r\n}\r\n"},5074:e=>{"use strict";e.exports="varying vec4 vColor;\r\nuniform float opacity;\r\n\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main (void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n\r\n    vec4 color = vColor;\r\n    color.a  *= opacity;\r\n\r\n    gl_FragColor = color;\r\n}\r\n"},1885:e=>{"use strict";e.exports="uniform float size;\r\nuniform float scale;\r\n\r\nattribute vec3 color;\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\n#if (USE_PER_POINT_SIZE == 1)\r\nattribute float sizes;\r\n#endif\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    float perPointOpacity = 1.0;\r\n\r\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    #if (USE_PER_POINT_SIZE == 1)\r\n    gl_PointSize = 2.0 * sizes;\r\n    #else\r\n    gl_PointSize = 2.0 * size;\r\n    #endif\r\n\r\n    #include <clipping_planes_vertex>\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n        perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    finalSphereColor.a *= perPointOpacity;\r\n    vColor = finalSphereColor;\r\n    #else\r\n    vColor = vec4(color, perPointOpacity);\r\n    #endif\r\n}"},8640:e=>{"use strict";e.exports="varying vec4 vColor;\r\nuniform float opacity;\r\n\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main (void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n\r\n    vec2 impostorSpaceCoordinate = (gl_PointCoord.xy - vec2(0.5, 0.5));\r\n    float distanceFromCenter = length(impostorSpaceCoordinate);\r\n\r\n    if (distanceFromCenter > 0.5) discard;\r\n\r\n    vec4 color = vColor;\r\n    color.a  *= opacity;\r\n\r\n    gl_FragColor = color;\r\n}\r\n"},6404:e=>{"use strict";e.exports="uniform float size;\r\nuniform float scale;\r\n\r\nattribute vec3 color;\r\n\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\n#if (USE_PER_POINT_SIZE == 1)\r\nattribute float sizes;\r\n#endif\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    float perPointOpacity = 1.0;\r\n\r\n    mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n    #if (USE_PER_POINT_SIZE == 1)\r\n    gl_PointSize = 2.0 * sizes * (scale / - mvPosition.z);\r\n    #else\r\n    gl_PointSize = 2.0 * size * (scale / - mvPosition.z);\r\n    #endif\r\n\r\n    #include <clipping_planes_vertex>\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n    perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    finalSphereColor.a *= perPointOpacity;\r\n    vColor = finalSphereColor;\r\n    #else\r\n    vColor = vec4(color, perPointOpacity);\r\n    #endif\r\n}"},6772:e=>{"use strict";e.exports="#define PHONG\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvarying float perPointOpacity;\r\n\r\nvoid main() {\r\n\r\n    #include <clipping_planes_fragment>\r\n    vec4 diffuseColor = vec4(diffuse, opacity);\r\n\r\n    diffuseColor.a *= perPointOpacity;\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n    vec3 totalEmissiveRadiance = emissive;\r\n\r\n    #include <logdepthbuf_fragment>\r\n    #include <map_fragment>\r\n    #include <color_fragment>\r\n    #include <alphamap_fragment>\r\n    #include <alphatest_fragment>\r\n    #include <specularmap_fragment>\r\n    #include <normal_fragment_begin>\r\n    #include <normal_fragment_maps>\r\n    #include <emissivemap_fragment>\r\n\r\n    // accumulation\r\n    #include <lights_phong_fragment>\r\n    #include <lights_fragment_begin>\r\n    #include <lights_fragment_maps>\r\n    #include <lights_fragment_end>\r\n\r\n    // modulation\r\n    #include <aomap_fragment>\r\n\r\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n    #include <envmap_fragment>\r\n\r\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\r\n\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n    #include <fog_fragment>\r\n    #include <premultiplied_alpha_fragment>\r\n    #include <dithering_fragment>\r\n\r\n}\r\n"},2048:e=>{"use strict";e.exports="attribute vec3 offset;\r\nuniform float opacity;\r\n\r\nvarying vec3 vViewPosition;\r\nvarying vec3 vNormal;\r\n\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\nvarying float perPointOpacity;\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    #include <uv_vertex>\r\n    #include <uv2_vertex>\r\n\r\n    perPointOpacity = 1.0;\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n    perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    perPointOpacity = finalSphereColor.a * perPointOpacity;\r\n    vColor = finalSphereColor.rgb;\r\n    #else\r\n    vColor = color.rgb;\r\n    #endif\r\n\r\n    #include <beginnormal_vertex>\r\n    #include <morphnormal_vertex>\r\n    #include <skinbase_vertex>\r\n    #include <skinnormal_vertex>\r\n    #include <defaultnormal_vertex>\r\n\r\n    vNormal = normalize(transformedNormal);\r\n\r\n    #include <begin_vertex>\r\n    #include <morphtarget_vertex>\r\n    #include <skinning_vertex>\r\n    #include <displacementmap_vertex>\r\n    #include <project_vertex>\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n    vViewPosition = - mvPosition.xyz;\r\n    #include <worldpos_vertex>\r\n    #include <envmap_vertex>\r\n    #include <shadowmap_vertex>\r\n    #include <fog_vertex>\r\n}"},7644:e=>{"use strict";e.exports="#include <clipping_planes_pars_fragment>\r\n\r\nuniform sampler2D map;\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    #include <clipping_planes_fragment>\r\n\r\n    vec4 tcolor = texture2D(map, vUv);\r\n    float value = (tcolor.x - low) / (high - low);\r\n\r\n    vec4 color = texture2D(colormap, vec2(value, 0.5));\r\n\r\n    if (color.a == 0.0) {\r\n        discard;\r\n    }\r\n\r\n    gl_FragColor = color;\r\n}"},3012:e=>{"use strict";e.exports="#include <clipping_planes_pars_vertex>\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\tvUv = uv;\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <clipping_planes_vertex>\r\n}"},7003:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nuniform vec3 lightMapSize;\r\nuniform vec2 lightMapRenderTargetSize;\r\nuniform sampler2D shadowTexture;\r\n\r\nuniform mat4 transform;\r\nuniform sampler3D volumeTexture;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler2D jitterTexture;\r\nuniform float focal_length;\r\nuniform float focal_plane;\r\nuniform float low;\r\nuniform float high;\r\nuniform mat4 modelViewMatrix;\r\nuniform float samples;\r\nuniform float alpha_coef;\r\nuniform float gradient_step;\r\n\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\n\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n\tvec3(-0.5, -0.5, -0.5),\r\n\tvec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n\t\t\t((inv_direction.x < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.y < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.z < 0.0) ? 1 : 0)\r\n\t\t)\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\n    in Ray ray, in vec3 aabb[2],\r\n    out float tmin, out float tmax\r\n){\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1-ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1-ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1-ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nvec3 worldGetNormal(in float px, in vec3 pos)\r\n{\r\n    return normalize(\r\n        vec3(px -  texture(volumeTexture, pos + vec3(gradient_step, 0, 0)).x,\r\n             px -  texture(volumeTexture, pos + vec3(0, gradient_step, 0)).x,\r\n             px -  texture(volumeTexture, pos + vec3(0, 0, gradient_step)).x\r\n         )\r\n    );\r\n}\r\n\r\nfloat getShadow(vec3 textcoord, vec2 sliceCount)\r\n{\r\n    float zidx1 = floor(textcoord.z * lightMapSize.z);\r\n    float zidx2 = ceil(textcoord.z * lightMapSize.z);\r\n\r\n    float shadow1 = texture2D(shadowTexture,\r\n        vec2(\r\n            floor(mod(zidx1, sliceCount.x)) * lightMapSize.x / lightMapRenderTargetSize.x,\r\n            floor(zidx1 / sliceCount.x)* lightMapSize.y / lightMapRenderTargetSize.y\r\n        )\r\n        + vec2(textcoord.x / sliceCount.x, textcoord.y / sliceCount.y)\r\n    ).r;\r\n\r\n    float shadow2 = texture2D(shadowTexture,\r\n        vec2(\r\n            floor(mod(zidx2, sliceCount.x)) * lightMapSize.x / lightMapRenderTargetSize.x,\r\n            floor(zidx2 / sliceCount.x)* lightMapSize.y / lightMapRenderTargetSize.y\r\n        )\r\n        + vec2(textcoord.x / sliceCount.x, textcoord.y / sliceCount.y)\r\n    ).r;\r\n\r\n    return mix(shadow1, shadow2, textcoord.z * lightMapSize.z - zidx1);\r\n}\r\n\r\nvoid main() {\r\n    float jitter = texture2D(jitterTexture, gl_FragCoord.xy/64.0).r;\r\n\tfloat tmin = 0.0;\r\n\tfloat tmax = 0.0;\r\n    float px = 0.0;\r\n    float shadow = 0.0;\r\n    vec4 pxColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n    #if (RAY_SAMPLES_COUNT > 0)\r\n    vec4 accuColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    for(int ray_samples=0; ray_samples < RAY_SAMPLES_COUNT; ray_samples++) {\r\n\r\n        vec4 value = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n        vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n\r\n        // Focal plane correction\r\n        vec3 P = transformedCameraPosition + direction * focal_plane;\r\n\r\n        float r = texture2D(jitterTexture, vec2(0.3) + gl_FragCoord.xy/64.0 * float(ray_samples+3)).r;\r\n        vec3 apertureShift = normalize(vec3(\r\n             1.0 - 2.0 * texture2D(jitterTexture, vec2(0.0) + gl_FragCoord.xy/64.0 * float(ray_samples)).r,\r\n             1.0 - 2.0 * texture2D(jitterTexture, vec2(0.1) + gl_FragCoord.xy/64.0 * float(ray_samples+1)).r,\r\n             1.0 - 2.0 * texture2D(jitterTexture, vec2(0.2) + gl_FragCoord.xy/64.0 * float(ray_samples+2)).r\r\n             )) * r * focal_length;\r\n\r\n        direction = normalize(P - (transformedCameraPosition + apertureShift));\r\n\r\n        vec3 eye = P - direction * 1000000.0;\r\n\r\n        intersect(makeRay(eye, direction), aabb, tmin, tmax);\r\n\r\n        vec3 textcoord_end = ((eye + direction * tmax) - translation.xyz) / scale.xyz + vec3(0.5);\r\n    #else\r\n        vec4 value = vec4(0.0, 0.0, 0.0, 0.0);\r\n        vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n    \tintersect(makeRay(transformedCameraPosition, direction), aabb, tmin, tmax);\r\n\r\n        vec3 textcoord_end = localPosition + vec3(0.5);\r\n    #endif\r\n        vec3 textcoord_start = textcoord_end - (tmax - max(0.0, tmin)) * direction / scale.xyz;\r\n        vec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n        // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n        int sampleCount = min(int(length(textcoord_delta) * samples), int(samples * 1.8));\r\n\r\n        textcoord_delta = textcoord_delta / float(sampleCount);\r\n        textcoord_start = textcoord_start - textcoord_delta * (0.01 + 0.98 * jitter);\r\n\r\n        vec3 textcoord = textcoord_start - textcoord_delta;\r\n\r\n        float step = length(textcoord_delta);\r\n\r\n        #if (USE_SHADOW == 1)\r\n            float sliceSize = lightMapSize.x * lightMapSize.y;\r\n            vec2 sliceCount =  lightMapRenderTargetSize / lightMapSize.xy;\r\n        #endif\r\n\r\n        for(int count = 0; count < sampleCount; count++) {\r\n            textcoord += textcoord_delta;\r\n\r\n            #if NUM_CLIPPING_PLANES > 0\r\n                vec4 plane;\r\n                vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n                #pragma unroll_loop_start\r\n                for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\r\n                    plane = clippingPlanes[ i ];\r\n                    if ( dot( pos, plane.xyz ) > plane.w ) continue;\r\n                }\r\n                #pragma unroll_loop_end\r\n            #endif\r\n\r\n            px = texture(volumeTexture, textcoord).x;\r\n            float scaled_px = (px - low) * inv_range;\r\n\r\n            if(scaled_px > 0.0) {\r\n                #if (USE_SHADOW == 1)\r\n                    shadow =\r\n                        (getShadow(textcoord, sliceCount) +\r\n                         getShadow(textcoord + vec3(1.0/lightMapSize.x, 0, 0), sliceCount) +\r\n                         getShadow(textcoord - vec3(1.0/lightMapSize.x, 0, 0), sliceCount) +\r\n                         getShadow(textcoord + vec3(0, 1.0/lightMapSize.y, 0), sliceCount) +\r\n                         getShadow(textcoord - vec3(0, 1.0/lightMapSize.y, 0), sliceCount) +\r\n                         getShadow(textcoord + vec3(0, 0, 1.0/lightMapSize.z), sliceCount) +\r\n                         getShadow(textcoord - vec3(0, 0, 1.0/lightMapSize.z), sliceCount)) / 7.0;\r\n                #else\r\n                    shadow = 0.0;\r\n                #endif\r\n\r\n                scaled_px = min(scaled_px, 0.99);\r\n\r\n                pxColor = texture(colormap, vec2(scaled_px, 0.5));\r\n\r\n                pxColor.a = 1.0 - pow(1.0 - pxColor.a, step * alpha_coef);\r\n                pxColor.a *= (1.0 - value.a);\r\n\r\n                pxColor.rgb *= pxColor.a;\r\n\r\n                // LIGHT\r\n                #if NUM_DIR_LIGHTS > 0\r\n                    vec4 addedLights = vec4(ambientLightColor, 1.0);\r\n                    vec3 specularColor = vec3(0.0);\r\n\r\n                    vec3 normal = worldGetNormal(px, textcoord);\r\n\r\n                    vec3 lightDirection;\r\n                    float lightingIntensity;\r\n\r\n//                    vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\r\n                    vec3 lightReflect;\r\n                    float specularFactor;\r\n\r\n                    #pragma unroll_loop_start\r\n                    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n                        lightDirection = directionalLights[ i ].direction;\r\n                        lightingIntensity = clamp(dot(lightDirection, normal), 0.0, 1.0);\r\n                        addedLights.rgb += directionalLights[ i ].color * (0.2 + 0.8 * lightingIntensity) * (1.0 - shadow);\r\n\r\n                        lightReflect = normalize(reflect(lightDirection, normal));\r\n                        specularFactor = dot(direction, lightReflect);\r\n\r\n                        if (specularFactor > 0.0)\r\n                            specularColor += 0.002 * scaled_px * (1.0 / step)  *\r\n                                             directionalLights[ i ].color * pow(specularFactor, 250.0) *\r\n                                             pxColor.a * (1.0 - shadow);\r\n                    }\r\n                    #pragma unroll_loop_end\r\n\r\n                    pxColor.rgb = pxColor.rgb * addedLights.xyz + specularColor;\r\n                #endif\r\n\r\n                value += pxColor;\r\n\r\n                if (value.a >= 0.99) {\r\n                    value.a = 1.0;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n    #if (RAY_SAMPLES_COUNT > 0)\r\n\r\n        accuColor += value;\r\n    }\r\n\r\n    gl_FragColor = accuColor / float(RAY_SAMPLES_COUNT);\r\n\r\n    #else\r\n\r\n    gl_FragColor = value;\r\n\r\n    #endif\r\n}"},472:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nvarying vec2 vUv;\r\n\r\nuniform vec3 lightMapSize;\r\nuniform vec2 lightMapRenderTargetSize;\r\nuniform vec3 volumeMapSize;\r\nuniform sampler2D colormap;\r\nuniform sampler3D volumeTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\nuniform float samples;\r\nuniform float alpha_coef;\r\nuniform vec3 lightDirection;\r\nuniform mat4 modelViewMatrix;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n\tvec3(-0.5, -0.5, -0.5),\r\n\tvec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n\t\t\t((inv_direction.x < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.y < 0.0) ? 1 : 0),\r\n\t\t\t((inv_direction.z < 0.0) ? 1 : 0)\r\n\t\t)\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\n    in Ray ray, in vec3 aabb[2],\r\n    out float tmin, out float tmax\r\n){\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1-ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1-ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1-ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nvoid main() {\r\n    vec2 sliceCount =  lightMapRenderTargetSize / lightMapSize.xy;\r\n    float zidx = floor(vUv.x * lightMapRenderTargetSize.x / lightMapSize.x)  +\r\n                 floor(vUv.y * lightMapRenderTargetSize.y / lightMapSize.y) * sliceCount.x;\r\n\r\n    if (zidx > lightMapSize.z) {\r\n        discard;\r\n    }\r\n\r\n    float x = mod(vUv.x * lightMapRenderTargetSize.x, lightMapSize.x) / lightMapSize.x;\r\n    float y = mod(vUv.y * lightMapRenderTargetSize.y, lightMapSize.y) / lightMapSize.y;\r\n    float z = zidx / lightMapSize.z;\r\n\r\n    vec3 localPosition = vec3(x, y, z);\r\n\r\n    // check if inside\r\n    vec3 delta_step = vec3(1.0) / lightMapSize;\r\n    vec3 s = step(delta_step, localPosition) - step(vec3(1.0) - delta_step, localPosition);\r\n\r\n    if (s.x * s.y * s.z < 1.0) {\r\n        discard;\r\n    }\r\n\r\n    // start intersection\r\n\tfloat tmin = 0.0;\r\n\tfloat tmax = 0.0;\r\n    float reducedSamples = samples / 2.0;\r\n    float dist;\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n\tintersect(makeRay((localPosition - vec3(0.5)) * scale.xyz + translation.xyz, -lightDirection), aabb, tmin, tmax);\r\n\r\n    float backoff = length(scale.xyz / volumeMapSize);\r\n\r\n\tif (tmin >= tmax) {\r\n\t    dist = 0.0;\r\n\t} else {\r\n\t    dist = abs(tmax);\r\n\t}\r\n\r\n    dist += backoff;\r\n\tbackoff *= 3.0;\r\n\r\n    if (dist <= backoff) {\r\n        discard;\r\n    }\r\n\tvec3 textcoord_start = localPosition - dist * lightDirection / scale.xyz;\r\n\tvec3 textcoord_end = localPosition - backoff * lightDirection / scale.xyz;\r\n\tvec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n    // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n    int sampleCount = min(int(length(textcoord_delta) * reducedSamples), int(reducedSamples * 1.8));\r\n\r\n    textcoord_delta = textcoord_delta / float(sampleCount);\r\n    vec3 textcoord = textcoord_start - textcoord_delta;\r\n\r\n    float textcoord_delta_step = length(textcoord_delta);\r\n    float sum_density = 0.0;\r\n\r\n    for(int count = 0; count < sampleCount; count++){\r\n        textcoord += textcoord_delta;\r\n\r\n        #if NUM_CLIPPING_PLANES > 0\r\n            vec4 plane;\r\n            vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n            #pragma unroll_loop_start\r\n            for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\r\n                plane = clippingPlanes[ i ];\r\n                if ( dot( pos, plane.xyz ) > plane.w ) continue;\r\n            }\r\n            #pragma unroll_loop_end\r\n        #endif\r\n\r\n        float px = texture(volumeTexture, textcoord).x;\r\n        float scaled_px = (px - low) * inv_range;\r\n\r\n        if(scaled_px > 0.0) {\r\n            scaled_px = min(scaled_px, 0.99);\r\n            float alpha = texture(colormap, vec2(scaled_px, 0.5)).a;\r\n\r\n            float density = 1.0 - pow(1.0 - alpha, textcoord_delta_step * alpha_coef);\r\n            density *= (1.0 - sum_density);\r\n            sum_density += density;\r\n\r\n            if(sum_density >= 0.99){\r\n                sum_density = 1.0;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    gl_FragColor = vec4(sum_density, 0, 0, 1.0);\r\n}"},2085:e=>{"use strict";e.exports="#include <common>\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    gl_Position = projectionMatrix * vec4( position, 1.0 );\r\n    vUv = uv;\r\n}"},2307:e=>{"use strict";e.exports="uniform vec4 rotation;\r\nuniform vec4 translation;\r\n\r\nvarying vec4 worldPosition;\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nvec3 rotate_vertex_position(vec3 pos, vec3 t, vec4 q) {\r\n    vec3 p = pos.xyz - t.xyz;\r\n\r\n    return p.xyz + 2.0 * cross(cross(p.xyz, q.xyz) + q.w * p.xyz, q.xyz) + t.xyz;\r\n}\r\n\r\nvoid main() {\r\n    vec3 p;\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n    localPosition = position;\r\n    worldPosition = modelMatrix * vec4(transformed, 1.0);\r\n\r\n    transformedCameraPosition = rotate_vertex_position(cameraPosition.xyz, translation.xyz, rotation);\r\n    transformedWorldPosition = rotate_vertex_position(worldPosition.xyz, translation.xyz, rotation);\r\n\r\n\t#include <worldpos_vertex>\r\n}"},2497:e=>{"use strict";e.exports="export default \"<div id=\\\"canvasTarget_[ID]\\\" class=\\\"k3d_plot\\\" style=\\\"position: relative;\\\"></div>\\r\\n\\r\\n<script>\\r\\n  var K3DInstance;\\r\\n  var data_[ID] = '[DATA]';\\r\\n\\r\\n  function loadScript(path, cb) {\\r\\n    var script = document.createElement('script');\\r\\n    script.src = path;\\r\\n    script.onload = cb;\\r\\n    script.onerror = cb;\\r\\n    document.head.appendChild(script);\\r\\n  }\\r\\n\\r\\n  function loadK3D() {\\r\\n    loadScript('https://unpkg.com/k3d@[VERSION]/dist/standalone.js', function () {\\r\\n      require(['k3d'], function (lib) {\\r\\n        function _base64ToArrayBuffer(base64) {\\r\\n          var binary_string = window.atob(base64);\\r\\n          var len = binary_string.length;\\r\\n          var bytes = new Uint8Array(len);\\r\\n          for (var i = 0; i < len; i++) {\\r\\n            bytes[i] = binary_string.charCodeAt(i);\\r\\n          }\\r\\n          return bytes;\\r\\n        }\\r\\n\\r\\n        try {\\r\\n          document.getElementById('canvasTarget_[ID]').style.cssText = [\\r\\n              `height:[HEIGHT]px`,\\r\\n              'position: relative',\\r\\n          ].join(';');\\r\\n\\r\\n          K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n            _base64ToArrayBuffer(data_[ID]),\\r\\n            document.getElementById('canvasTarget_[ID]'),\\r\\n          );\\r\\n\\r\\n          K3DInstance.then(function (K3DInstance) {\\r\\n            [ADDITIONAL]\\r\\n          });\\r\\n        } catch (e) {\\r\\n          console.log(e);\\r\\n          return;\\r\\n        }\\r\\n      });\\r\\n    });\\r\\n  }\\r\\n\\r\\n  if (typeof (require) === 'undefined') {\\r\\n    loadScript('https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js', loadK3D);\\r\\n  } else {\\r\\n    loadK3D();\\r\\n  }\\r\\n<\/script>\";"},2656:e=>{"use strict";e.exports='export default "<!doctype html>\\r\\n<html>\\r\\n<head>\\r\\n    <meta charset=\\"utf-8\\">\\r\\n    <title>K3D snapshot viewer - [TIMESTAMP]</title>\\r\\n    <style>\\r\\n        body, html {\\r\\n            background-color: #F5F5F5;\\r\\n            margin: 0;\\r\\n            padding: 0;\\r\\n            overflow: hidden;\\r\\n        }\\r\\n\\r\\n        #canvasTarget {\\r\\n            width: 100%;\\r\\n            height: 100%;\\r\\n            position: absolute;\\r\\n        }\\r\\n    </style>\\r\\n    <script src=\\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\\"><\/script>\\r\\n    <script src=\\"https://unpkg.com/k3d@[VERSION]/dist/standalone.js\\"><\/script>\\r\\n</head>\\r\\n<body>\\r\\n<div id=\\"canvasTarget\\"></div>\\r\\n\\r\\n<script>\\r\\n    var K3DInstance;\\r\\n    var data = \'[DATA]\';\\r\\n\\r\\n    function _base64ToArrayBuffer(base64) {\\r\\n        var binary_string = window.atob(base64);\\r\\n        var len = binary_string.length;\\r\\n        var bytes = new Uint8Array(len);\\r\\n        for (var i = 0; i < len; i++) {\\r\\n            bytes[i] = binary_string.charCodeAt(i);\\r\\n        }\\r\\n        return bytes;\\r\\n    }\\r\\n\\r\\n    require([\'k3d\'], function (lib) {\\r\\n        try {\\r\\n            K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n                _base64ToArrayBuffer(data),\\r\\n                document.getElementById(\'canvasTarget\'),\\r\\n            );\\r\\n\\r\\n            K3DInstance.then(function(K3DInstance) {\\r\\n                [ADDITIONAL]\\r\\n            });\\r\\n        } catch (e) {\\r\\n            console.log(e);\\r\\n            return;\\r\\n        }\\r\\n    });\\r\\n<\/script>\\r\\n</body>\\r\\n</html>\\r\\n";'},7546:e=>{"use strict";e.exports="export default \"<!doctype html>\\r\\n<html>\\r\\n<head>\\r\\n    <meta charset=\\\"utf-8\\\">\\r\\n    <title>K3D snapshot viewer - [TIMESTAMP]</title>\\r\\n    <style>\\r\\n        body, html {\\r\\n            background-color: #F5F5F5;\\r\\n            margin: 0;\\r\\n            padding: 0;\\r\\n            overflow: hidden;\\r\\n        }\\r\\n\\r\\n        #canvasTarget {\\r\\n            width: 100%;\\r\\n            height: 100%;\\r\\n            position: absolute;\\r\\n        }\\r\\n    </style>\\r\\n    <script id='pakojs'>[PAKO_JS]<\/script>\\r\\n    <script>\\r\\n        window.k3dCompressed = '[K3D_SOURCE]';\\r\\n\\r\\n        function _base64ToArrayBuffer(base64) {\\r\\n            var binary_string = window.atob(base64);\\r\\n            var len = binary_string.length;\\r\\n            var bytes = new Uint8Array(len);\\r\\n            for (var i = 0; i < len; i++) {\\r\\n                bytes[i] = binary_string.charCodeAt(i);\\r\\n            }\\r\\n            return bytes;\\r\\n        }\\r\\n\\r\\n        var k3dSource = pako.inflate(_base64ToArrayBuffer(window.k3dCompressed), {'to': 'string'});\\r\\n    <\/script>\\r\\n    <script id='requirejs'>[REQUIRE_JS]<\/script>\\r\\n</head>\\r\\n<body>\\r\\n<div id=\\\"canvasTarget\\\"></div>\\r\\n<script>\\r\\n    var K3DInstance;\\r\\n    var data = '[DATA]';\\r\\n\\r\\n    eval(k3dSource);\\r\\n\\r\\n    require(['k3d'], function (lib) {\\r\\n        try {\\r\\n            K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n                _base64ToArrayBuffer(data),\\r\\n                document.getElementById('canvasTarget'),\\r\\n            );\\r\\n\\r\\n            K3DInstance.then(function(K3DInstance) {\\r\\n                [ADDITIONAL]\\r\\n            });\\r\\n        } catch (e) {\\r\\n            console.log(e);\\r\\n            return;\\r\\n        }\\r\\n    });\\r\\n<\/script>\\r\\n</body>\\r\\n</html>\\r\\n\";"},8008:e=>{"use strict";e.exports=JSON.parse('{"name":"k3d","version":"2.11.0","description":"3D visualization library","author":"k3d team","main":"src/index.js","repository":{"type":"git","url":"https://github.com/K3D-tools/K3D-jupyter.git"},"keywords":["jupyter","widgets","ipython","ipywidgets","jupyterlab","jupyterlab-extension"],"scripts":{"build":"webpack","test":"echo \\"Error: no test specified\\" && exit 1"},"jupyterlab":{"extension":"dist/labplugin"},"devDependencies":{"components-webfontloader":"1.5.2","copy-webpack-plugin":"^9.0.0","cors":"2.8.5","css-loader":"^5.2.5","eslint":"^7.2.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.23.3","eslint-plugin-markdown":"^2.1.0","express":"^4.17.1","grunt":"^1.4.0","grunt-contrib-clean":"2.0.0","grunt-contrib-connect":"^3.0.0","grunt-contrib-jshint":"^3.0.0","grunt-contrib-watch":"^1.1.0","grunt-curl":"^2.5.1","grunt-eslint":"^23.0.0","grunt-express-server":"0.5.4","grunt-jsdoc":"2.4.1","grunt-open":"^0.2.4","grunt-webpack":"^4.0.3","jshint-stylish":"^2.2.1","json-loader":"^0.5.4","load-grunt-tasks":"5.1.0","time-grunt":"2.0.0","webpack":"^5.37.1","webpack-cli":"^4.7.0","webpack-combine-loaders":"^2.0.4","webpack-node-externals":"^3.0.0","webpack-visualizer-plugin2":"^1.0.0"},"dependencies":{"@jupyter-widgets/base":"^4.0.0","dat.gui":"git+https://github.com/K3D-tools/dat.gui.git#b4123f5acf201be4275924ea89c96b9326653f49","es6-promise":"^4.2.8","file-saver":"^2.0.5","katex":"^0.13.11","lodash":"^4.17.21","msgpack-lite":"^0.1.26","pako":"^2.0.3","rasterizehtml":"^1.3.0","requirejs":"^2.3.6","screenfull":"^5.1.0","stats.js":"^0.17.0","style-loader":"^2.0.0","three":"^0.128.0","three-mesh-bvh":"^0.3.7"}}')}}]);